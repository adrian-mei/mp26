(function(){"use strict";var lib$3={},browser$3={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var e=1e3,r=e*60,o=r*60,t=o*24,c=t*7,h=t*365.25;ms=function(d,m){m=m||{};var u=typeof d;if(u==="string"&&d.length>0)return l(d);if(u==="number"&&isFinite(d))return m.long?p(d):i(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function l(d){if(d=String(d),!(d.length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(m){var u=parseFloat(m[1]),a=(m[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return u*h;case"weeks":case"week":case"w":return u*c;case"days":case"day":case"d":return u*t;case"hours":case"hour":case"hrs":case"hr":case"h":return u*o;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function i(d){var m=Math.abs(d);return m>=t?Math.round(d/t)+"d":m>=o?Math.round(d/o)+"h":m>=r?Math.round(d/r)+"m":m>=e?Math.round(d/e)+"s":d+"ms"}function p(d){var m=Math.abs(d);return m>=t?s(d,m,t,"day"):m>=o?s(d,m,o,"hour"):m>=r?s(d,m,r,"minute"):m>=e?s(d,m,e,"second"):d+" ms"}function s(d,m,u,a){var g=m>=u*1.5;return Math.round(d/u)+" "+a+(g?"s":"")}return ms}var common,hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1;function e(r){t.debug=t,t.default=t,t.coerce=s,t.disable=i,t.enable=h,t.enabled=p,t.humanize=requireMs(),t.destroy=d,Object.keys(r).forEach(m=>{t[m]=r[m]}),t.names=[],t.skips=[],t.formatters={};function o(m){let u=0;for(let a=0;a<m.length;a++)u=(u<<5)-u+m.charCodeAt(a),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=o;function t(m){let u,a=null,g,b;function y(...T){if(!y.enabled)return;const E=y,x=Number(new Date),R=x-(u||x);E.diff=R,E.prev=u,E.curr=x,u=x,T[0]=t.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let P=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(w,S)=>{if(w==="%%")return"%";P++;const j=t.formatters[S];if(typeof j=="function"){const M=T[P];w=j.call(E,M),T.splice(P,1),P--}return w}),t.formatArgs.call(E,T),(E.log||t.log).apply(E,T)}return y.namespace=m,y.useColors=t.useColors(),y.color=t.selectColor(m),y.extend=c,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(g!==t.namespaces&&(g=t.namespaces,b=t.enabled(m)),b),set:T=>{a=T}}),typeof t.init=="function"&&t.init(y),y}function c(m,u){const a=t(this.namespace+(typeof u>"u"?":":u)+m);return a.log=this.log,a}function h(m){t.save(m),t.namespaces=m,t.names=[],t.skips=[];const u=(typeof m=="string"?m:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const a of u)a[0]==="-"?t.skips.push(a.slice(1)):t.names.push(a)}function l(m,u){let a=0,g=0,b=-1,y=0;for(;a<m.length;)if(g<u.length&&(u[g]===m[a]||u[g]==="*"))u[g]==="*"?(b=g,y=a,g++):(a++,g++);else if(b!==-1)g=b+1,y++,a=y;else return!1;for(;g<u.length&&u[g]==="*";)g++;return g===u.length}function i(){const m=[...t.names,...t.skips.map(u=>"-"+u)].join(",");return t.enable(""),m}function p(m){for(const u of t.skips)if(l(m,u))return!1;for(const u of t.names)if(l(m,u))return!0;return!1}function s(m){return m instanceof Error?m.stack||m.message:m}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return common=e,common}var hasRequiredBrowser$3;function requireBrowser$3(){return hasRequiredBrowser$3||(hasRequiredBrowser$3=1,(function(e,r){var o={};r.formatArgs=c,r.save=h,r.load=l,r.useColors=t,r.storage=i(),r.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function c(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;s.splice(1,0,d,"color: inherit");let m=0,u=0;s[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(m++,a==="%c"&&(u=m))}),s.splice(u,0,d)}r.log=console.debug||console.log||(()=>{});function h(s){try{s?r.storage.setItem("debug",s):r.storage.removeItem("debug")}catch{}}function l(){let s;try{s=r.storage.getItem("debug")||r.storage.getItem("DEBUG")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=o.DEBUG),s}function i(){try{return localStorage}catch{}}e.exports=requireCommon()(r);const{formatters:p}=e.exports;p.j=function(s){try{return JSON.stringify(s)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(browser$3,browser$3.exports)),browser$3.exports}var core$2={},core$1={},ReadStreamTokenizer={},AbstractTokenizer={},lib$2={},EndOfFileStream={},hasRequiredEndOfFileStream;function requireEndOfFileStream(){return hasRequiredEndOfFileStream||(hasRequiredEndOfFileStream=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOfStreamError=e.defaultMessages=void 0,e.defaultMessages="End-Of-Stream";class r extends Error{constructor(){super(e.defaultMessages)}}e.EndOfStreamError=r})(EndOfFileStream)),EndOfFileStream}var StreamReader={},Deferred={},hasRequiredDeferred;function requireDeferred(){if(hasRequiredDeferred)return Deferred;hasRequiredDeferred=1,Object.defineProperty(Deferred,"__esModule",{value:!0}),Deferred.Deferred=void 0;let e=class{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((o,t)=>{this.reject=t,this.resolve=o})}};return Deferred.Deferred=e,Deferred}var hasRequiredStreamReader;function requireStreamReader(){return hasRequiredStreamReader||(hasRequiredStreamReader=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;const r=requireEndOfFileStream(),o=requireDeferred();var t=requireEndOfFileStream();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});const c=1*1024*1024;class h{constructor(i){if(this.s=i,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!i.read||!i.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new r.EndOfStreamError)),this.s.once("error",p=>this.reject(p)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(i,p,s){const d=await this.read(i,p,s);return this.peekQueue.push(i.subarray(p,p+d)),d}async read(i,p,s){if(s===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new r.EndOfStreamError;let d=s,m=0;for(;this.peekQueue.length>0&&d>0;){const u=this.peekQueue.pop();if(!u)throw new Error("peekData should be defined");const a=Math.min(u.length,d);i.set(u.subarray(0,a),p+m),m+=a,d-=a,a<u.length&&this.peekQueue.push(u.subarray(a))}for(;d>0&&!this.endOfStream;){const u=Math.min(d,c),a=await this.readFromStream(i,p+m,u);if(m+=a,a<u)break;d-=a}return m}async readFromStream(i,p,s){const d=this.s.read(s);if(d)return i.set(d,p),d.length;{const m={buffer:i,offset:p,length:s,deferred:new o.Deferred};return this.deferred=m.deferred,this.s.once("readable",()=>{this.readDeferred(m)}),m.deferred.promise}}readDeferred(i){const p=this.s.read(i.length);p?(i.buffer.set(p,i.offset),i.deferred.resolve(p.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(i)})}reject(i){this.endOfStream=!0,this.deferred&&(this.deferred.reject(i),this.deferred=null)}}e.StreamReader=h})(StreamReader)),StreamReader}var hasRequiredLib$3;function requireLib$3(){return hasRequiredLib$3||(hasRequiredLib$3=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;var r=requireEndOfFileStream();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return r.EndOfStreamError}});var o=requireStreamReader();Object.defineProperty(e,"StreamReader",{enumerable:!0,get:function(){return o.StreamReader}})})(lib$2)),lib$2}var hasRequiredAbstractTokenizer;function requireAbstractTokenizer(){if(hasRequiredAbstractTokenizer)return AbstractTokenizer;hasRequiredAbstractTokenizer=1,Object.defineProperty(AbstractTokenizer,"__esModule",{value:!0}),AbstractTokenizer.AbstractTokenizer=void 0;const e=requireLib$3();let r=class{constructor(t){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=t||{}}async readToken(t,c=this.position){const h=Buffer.alloc(t.len);if(await this.readBuffer(h,{position:c})<t.len)throw new e.EndOfStreamError;return t.get(h,0)}async peekToken(t,c=this.position){const h=Buffer.alloc(t.len);if(await this.peekBuffer(h,{position:c})<t.len)throw new e.EndOfStreamError;return t.get(h,0)}async readNumber(t){if(await this.readBuffer(this.numBuffer,{length:t.len})<t.len)throw new e.EndOfStreamError;return t.get(this.numBuffer,0)}async peekNumber(t){if(await this.peekBuffer(this.numBuffer,{length:t.len})<t.len)throw new e.EndOfStreamError;return t.get(this.numBuffer,0)}async ignore(t){if(this.fileInfo.size!==void 0){const c=this.fileInfo.size-this.position;if(t>c)return this.position+=c,c}return this.position+=t,t}async close(){}normalizeOptions(t,c){if(c&&c.position!==void 0&&c.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return c?{mayBeLess:c.mayBeLess===!0,offset:c.offset?c.offset:0,length:c.length?c.length:t.length-(c.offset?c.offset:0),position:c.position?c.position:this.position}:{mayBeLess:!1,offset:0,length:t.length,position:this.position}}};return AbstractTokenizer.AbstractTokenizer=r,AbstractTokenizer}var hasRequiredReadStreamTokenizer;function requireReadStreamTokenizer(){if(hasRequiredReadStreamTokenizer)return ReadStreamTokenizer;hasRequiredReadStreamTokenizer=1,Object.defineProperty(ReadStreamTokenizer,"__esModule",{value:!0}),ReadStreamTokenizer.ReadStreamTokenizer=void 0;const e=requireAbstractTokenizer(),r=requireLib$3(),o=256e3;let t=class extends e.AbstractTokenizer{constructor(h,l){super(l),this.streamReader=new r.StreamReader(h)}async getFileInfo(){return this.fileInfo}async readBuffer(h,l){const i=this.normalizeOptions(h,l),p=i.position-this.position;if(p>0)return await this.ignore(p),this.readBuffer(h,l);if(p<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(i.length===0)return 0;const s=await this.streamReader.read(h,i.offset,i.length);if(this.position+=s,(!l||!l.mayBeLess)&&s<i.length)throw new r.EndOfStreamError;return s}async peekBuffer(h,l){const i=this.normalizeOptions(h,l);let p=0;if(i.position){const s=i.position-this.position;if(s>0){const d=new Uint8Array(i.length+s);return p=await this.peekBuffer(d,{mayBeLess:i.mayBeLess}),h.set(d.subarray(s),i.offset),p-s}else if(s<0)throw new Error("Cannot peek from a negative offset in a stream")}if(i.length>0){try{p=await this.streamReader.peek(h,i.offset,i.length)}catch(s){if(l&&l.mayBeLess&&s instanceof r.EndOfStreamError)return 0;throw s}if(!i.mayBeLess&&p<i.length)throw new r.EndOfStreamError}return p}async ignore(h){const l=Math.min(o,h),i=new Uint8Array(l);let p=0;for(;p<h;){const s=h-p,d=await this.readBuffer(i,{length:Math.min(l,s)});if(d<0)return d;p+=d}return p}};return ReadStreamTokenizer.ReadStreamTokenizer=t,ReadStreamTokenizer}var BufferTokenizer={},hasRequiredBufferTokenizer;function requireBufferTokenizer(){if(hasRequiredBufferTokenizer)return BufferTokenizer;hasRequiredBufferTokenizer=1,Object.defineProperty(BufferTokenizer,"__esModule",{value:!0}),BufferTokenizer.BufferTokenizer=void 0;const e=requireLib$3(),r=requireAbstractTokenizer();let o=class extends r.AbstractTokenizer{constructor(c,h){super(h),this.uint8Array=c,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:c.length}async readBuffer(c,h){if(h&&h.position){if(h.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=h.position}const l=await this.peekBuffer(c,h);return this.position+=l,l}async peekBuffer(c,h){const l=this.normalizeOptions(c,h),i=Math.min(this.uint8Array.length-l.position,l.length);if(!l.mayBeLess&&i<l.length)throw new e.EndOfStreamError;return c.set(this.uint8Array.subarray(l.position,l.position+i),l.offset),i}async close(){}};return BufferTokenizer.BufferTokenizer=o,BufferTokenizer}var hasRequiredCore$2;function requireCore$2(){return hasRequiredCore$2||(hasRequiredCore$2=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromBuffer=e.fromStream=e.EndOfStreamError=void 0;const r=requireReadStreamTokenizer(),o=requireBufferTokenizer();var t=requireLib$3();Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});function c(l,i){return i=i||{},new r.ReadStreamTokenizer(l,i)}e.fromStream=c;function h(l,i){return new o.BufferTokenizer(l,i)}e.fromBuffer=h})(core$1)),core$1}var ParserFactory={},lib$1={},ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredIeee754;function requireIeee754(){return hasRequiredIeee754||(hasRequiredIeee754=1,ieee754.read=function(e,r,o,t,c){var h,l,i=c*8-t-1,p=(1<<i)-1,s=p>>1,d=-7,m=o?c-1:0,u=o?-1:1,a=e[r+m];for(m+=u,h=a&(1<<-d)-1,a>>=-d,d+=i;d>0;h=h*256+e[r+m],m+=u,d-=8);for(l=h&(1<<-d)-1,h>>=-d,d+=t;d>0;l=l*256+e[r+m],m+=u,d-=8);if(h===0)h=1-s;else{if(h===p)return l?NaN:(a?-1:1)*(1/0);l=l+Math.pow(2,t),h=h-s}return(a?-1:1)*l*Math.pow(2,h-t)},ieee754.write=function(e,r,o,t,c,h){var l,i,p,s=h*8-c-1,d=(1<<s)-1,m=d>>1,u=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,a=t?0:h-1,g=t?1:-1,b=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(i=isNaN(r)?1:0,l=d):(l=Math.floor(Math.log(r)/Math.LN2),r*(p=Math.pow(2,-l))<1&&(l--,p*=2),l+m>=1?r+=u/p:r+=u*Math.pow(2,1-m),r*p>=2&&(l++,p/=2),l+m>=d?(i=0,l=d):l+m>=1?(i=(r*p-1)*Math.pow(2,c),l=l+m):(i=r*Math.pow(2,m-1)*Math.pow(2,c),l=0));c>=8;e[o+a]=i&255,a+=g,i/=256,c-=8);for(l=l<<c|i,s+=c;s>0;e[o+a]=l&255,a+=g,l/=256,s-=8);e[o+a-g]|=b*128}),ieee754}var hasRequiredLib$2;function requireLib$2(){return hasRequiredLib$2||(hasRequiredLib$2=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnsiStringType=e.StringType=e.BufferType=e.Uint8ArrayType=e.IgnoreType=e.Float80_LE=e.Float80_BE=e.Float64_LE=e.Float64_BE=e.Float32_LE=e.Float32_BE=e.Float16_LE=e.Float16_BE=e.INT64_BE=e.UINT64_BE=e.INT64_LE=e.UINT64_LE=e.INT32_LE=e.INT32_BE=e.INT24_BE=e.INT24_LE=e.INT16_LE=e.INT16_BE=e.INT8=e.UINT32_BE=e.UINT32_LE=e.UINT24_BE=e.UINT24_LE=e.UINT16_BE=e.UINT16_LE=e.UINT8=void 0;const r=requireIeee754();function o(p){return new DataView(p.buffer,p.byteOffset)}e.UINT8={len:1,get(p,s){return o(p).getUint8(s)},put(p,s,d){return o(p).setUint8(s,d),s+1}},e.UINT16_LE={len:2,get(p,s){return o(p).getUint16(s,!0)},put(p,s,d){return o(p).setUint16(s,d,!0),s+2}},e.UINT16_BE={len:2,get(p,s){return o(p).getUint16(s)},put(p,s,d){return o(p).setUint16(s,d),s+2}},e.UINT24_LE={len:3,get(p,s){const d=o(p);return d.getUint8(s)+(d.getUint16(s+1,!0)<<8)},put(p,s,d){const m=o(p);return m.setUint8(s,d&255),m.setUint16(s+1,d>>8,!0),s+3}},e.UINT24_BE={len:3,get(p,s){const d=o(p);return(d.getUint16(s)<<8)+d.getUint8(s+2)},put(p,s,d){const m=o(p);return m.setUint16(s,d>>8),m.setUint8(s+2,d&255),s+3}},e.UINT32_LE={len:4,get(p,s){return o(p).getUint32(s,!0)},put(p,s,d){return o(p).setUint32(s,d,!0),s+4}},e.UINT32_BE={len:4,get(p,s){return o(p).getUint32(s)},put(p,s,d){return o(p).setUint32(s,d),s+4}},e.INT8={len:1,get(p,s){return o(p).getInt8(s)},put(p,s,d){return o(p).setInt8(s,d),s+1}},e.INT16_BE={len:2,get(p,s){return o(p).getInt16(s)},put(p,s,d){return o(p).setInt16(s,d),s+2}},e.INT16_LE={len:2,get(p,s){return o(p).getInt16(s,!0)},put(p,s,d){return o(p).setInt16(s,d,!0),s+2}},e.INT24_LE={len:3,get(p,s){const d=e.UINT24_LE.get(p,s);return d>8388607?d-16777216:d},put(p,s,d){const m=o(p);return m.setUint8(s,d&255),m.setUint16(s+1,d>>8,!0),s+3}},e.INT24_BE={len:3,get(p,s){const d=e.UINT24_BE.get(p,s);return d>8388607?d-16777216:d},put(p,s,d){const m=o(p);return m.setUint16(s,d>>8),m.setUint8(s+2,d&255),s+3}},e.INT32_BE={len:4,get(p,s){return o(p).getInt32(s)},put(p,s,d){return o(p).setInt32(s,d),s+4}},e.INT32_LE={len:4,get(p,s){return o(p).getInt32(s,!0)},put(p,s,d){return o(p).setInt32(s,d,!0),s+4}},e.UINT64_LE={len:8,get(p,s){return o(p).getBigUint64(s,!0)},put(p,s,d){return o(p).setBigUint64(s,d,!0),s+8}},e.INT64_LE={len:8,get(p,s){return o(p).getBigInt64(s,!0)},put(p,s,d){return o(p).setBigInt64(s,d,!0),s+8}},e.UINT64_BE={len:8,get(p,s){return o(p).getBigUint64(s)},put(p,s,d){return o(p).setBigUint64(s,d),s+8}},e.INT64_BE={len:8,get(p,s){return o(p).getBigInt64(s)},put(p,s,d){return o(p).setBigInt64(s,d),s+8}},e.Float16_BE={len:2,get(p,s){return r.read(p,s,!1,10,this.len)},put(p,s,d){return r.write(p,d,s,!1,10,this.len),s+this.len}},e.Float16_LE={len:2,get(p,s){return r.read(p,s,!0,10,this.len)},put(p,s,d){return r.write(p,d,s,!0,10,this.len),s+this.len}},e.Float32_BE={len:4,get(p,s){return o(p).getFloat32(s)},put(p,s,d){return o(p).setFloat32(s,d),s+4}},e.Float32_LE={len:4,get(p,s){return o(p).getFloat32(s,!0)},put(p,s,d){return o(p).setFloat32(s,d,!0),s+4}},e.Float64_BE={len:8,get(p,s){return o(p).getFloat64(s)},put(p,s,d){return o(p).setFloat64(s,d),s+8}},e.Float64_LE={len:8,get(p,s){return o(p).getFloat64(s,!0)},put(p,s,d){return o(p).setFloat64(s,d,!0),s+8}},e.Float80_BE={len:10,get(p,s){return r.read(p,s,!1,63,this.len)},put(p,s,d){return r.write(p,d,s,!1,63,this.len),s+this.len}},e.Float80_LE={len:10,get(p,s){return r.read(p,s,!0,63,this.len)},put(p,s,d){return r.write(p,d,s,!0,63,this.len),s+this.len}};class t{constructor(s){this.len=s}get(s,d){}}e.IgnoreType=t;class c{constructor(s){this.len=s}get(s,d){return s.subarray(d,d+this.len)}}e.Uint8ArrayType=c;class h{constructor(s){this.len=s}get(s,d){return Buffer.from(s.subarray(d,d+this.len))}}e.BufferType=h;class l{constructor(s,d){this.len=s,this.encoding=d}get(s,d){return Buffer.from(s).toString(this.encoding,d,d+this.len)}}e.StringType=l;class i{constructor(s){this.len=s}static decode(s,d,m){let u="";for(let a=d;a<m;++a)u+=i.codePointToString(i.singleByteDecoder(s[a]));return u}static inRange(s,d,m){return d<=s&&s<=m}static codePointToString(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}static singleByteDecoder(s){if(i.inRange(s,0,127))return s;const d=i.windows1252[s-128];if(d===null)throw Error("invaliding encoding");return d}get(s,d=0){return i.decode(s,d,d+this.len)}}e.AnsiStringType=i,i.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1)),lib$1}var util$1={},hasRequiredUtil$2;function requireUtil$2(){return hasRequiredUtil$2||(hasRequiredUtil$2=1,util$1.stringToBytes=e=>[...e].map(r=>r.charCodeAt(0)),util$1.tarHeaderChecksumMatches=(e,r=0)=>{const o=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(o))return!1;let t=256;for(let c=r;c<r+148;c++)t+=e[c];for(let c=r+156;c<r+512;c++)t+=e[c];return o===t},util$1.uint32SyncSafeToken={get:(e,r)=>e[r+3]&127|e[r+2]<<7|e[r+1]<<14|e[r]<<21,len:4}),util$1}var supported,hasRequiredSupported;function requireSupported(){return hasRequiredSupported||(hasRequiredSupported=1,supported={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}),supported}var core,hasRequiredCore$1;function requireCore$1(){if(hasRequiredCore$1)return core;hasRequiredCore$1=1;const Token=requireLib$2(),strtok3=requireCore$2(),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=requireUtil$2(),supported=requireSupported(),minimumBytes=4100;async function fromStream(e){const r=await strtok3.fromStream(e);try{return await fromTokenizer(r)}finally{await r.close()}}async function fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const r=e instanceof Buffer?e:Buffer.from(e);if(!(r&&r.length>1))return;const o=strtok3.fromBuffer(r);return fromTokenizer(o)}function _check(e,r,o){o={offset:0,...o};for(const[t,c]of r.entries())if(o.mask){if(c!==(o.mask[t]&e[t+o.offset]))return!1}else if(c!==e[t+o.offset])return!1;return!0}async function fromTokenizer(e){try{return _fromTokenizer(e)}catch(r){if(!(r instanceof strtok3.EndOfStreamError))throw r}}async function _fromTokenizer(e){let r=Buffer.alloc(minimumBytes);const o=12,t=(h,l)=>_check(r,h,l),c=(h,l)=>t(stringToBytes(h),l);if(e.fileInfo.size||(e.fileInfo.size=Number.MAX_SAFE_INTEGER),await e.peekBuffer(r,{length:o,mayBeLess:!0}),t([66,77]))return{ext:"bmp",mime:"image/bmp"};if(t([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(t([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(t([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(t([37,33]))return await e.peekBuffer(r,{length:24,mayBeLess:!0}),c("PS-Adobe-",{offset:2})&&c(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(t([31,160])||t([31,157]))return{ext:"Z",mime:"application/x-compress"};if(t([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(t([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(t([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(t([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(c("ID3")){await e.ignore(6);const h=await e.readToken(uint32SyncSafeToken);return e.position+h>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(h),fromTokenizer(e))}if(c("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((r[0]===67||r[0]===70)&&t([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(t([71,73,70]))return{ext:"gif",mime:"image/gif"};if(c("FLIF"))return{ext:"flif",mime:"image/flif"};if(c("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(c("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(c("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(c("FORM"))return{ext:"aif",mime:"audio/aiff"};if(c("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(t([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(r,{length:30});const h={compressedSize:r.readUInt32LE(18),uncompressedSize:r.readUInt32LE(22),filenameLength:r.readUInt16LE(26),extraFieldLength:r.readUInt16LE(28)};if(h.filename=await e.readToken(new Token.StringType(h.filenameLength,"utf-8")),await e.ignore(h.extraFieldLength),h.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(h.filename.endsWith(".rels")||h.filename.endsWith(".xml"))switch(h.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(h.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(h.filename.startsWith("3D/")&&h.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(h.filename==="mimetype"&&h.compressedSize===h.uncompressedSize)switch(await e.readToken(new Token.StringType(h.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(h.compressedSize===0){let l=-1;for(;l<0&&e.position<e.fileInfo.size;)await e.peekBuffer(r,{mayBeLess:!0}),l=r.indexOf("504B0304",0,"hex"),await e.ignore(l>=0?l:r.length)}else await e.ignore(h.compressedSize)}}catch(h){if(!(h instanceof strtok3.EndOfStreamError))throw h}return{ext:"zip",mime:"application/zip"}}if(c("OggS")){await e.ignore(28);const h=Buffer.alloc(8);return await e.readBuffer(h),_check(h,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(h,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(h,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(h,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(h,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(h,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(t([80,75])&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8))return{ext:"zip",mime:"application/zip"};if(c("ftyp",{offset:4})&&(r[8]&96)!==0){const h=r.toString("binary",8,12).replace("\0"," ").trim();switch(h){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return h.startsWith("3g")?h.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(c("MThd"))return{ext:"mid",mime:"audio/midi"};if(c("wOFF")&&(t([0,1,0,0],{offset:4})||c("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(c("wOF2")&&(t([0,1,0,0],{offset:4})||c("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(t([212,195,178,161])||t([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(c("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(c("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(c("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(t([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(c("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(c("%PDF")){await e.ignore(1350);const h=10*1024*1024,l=Buffer.alloc(Math.min(h,e.fileInfo.size));return await e.readBuffer(l,{mayBeLess:!0}),l.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(t([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(t([73,73,42,0]))return c("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:t([28,0,254,0],{offset:8})||t([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:t([8,0,0,0],{offset:4})&&(t([45,0,254,0],{offset:8})||t([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(r=Buffer.alloc(24),await e.peekBuffer(r),(t([16,251,134,1],{offset:4})||t([8,0,0,0],{offset:4}))&&t([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(t([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(c("MAC "))return{ext:"ape",mime:"audio/ape"};if(t([26,69,223,163])){async function h(){const d=await e.peekNumber(Token.UINT8);let m=128,u=0;for(;(d&m)===0&&m!==0;)++u,m>>=1;const a=Buffer.alloc(u+1);return await e.readBuffer(a),a}async function l(){const d=await h(),m=await h();m[0]^=128>>m.length-1;const u=Math.min(6,m.length);return{id:d.readUIntBE(0,d.length),len:m.readUIntBE(m.length-u,u)}}async function i(d,m){for(;m>0;){const u=await l();if(u.id===17026)return e.readToken(new Token.StringType(u.len,"utf-8"));await e.ignore(u.len),--m}}const p=await l();switch(await i(1,p.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(t([82,73,70,70])){if(t([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(t([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(t([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(c("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(t([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(c("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(c("MSCF")||c("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(t([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(t([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(t([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(t([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(c("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(c("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(t([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(c("IMPM"))return{ext:"it",mime:"audio/x-it"};if(c("-lh0-",{offset:2})||c("-lh1-",{offset:2})||c("-lh2-",{offset:2})||c("-lh3-",{offset:2})||c("-lh4-",{offset:2})||c("-lh5-",{offset:2})||c("-lh6-",{offset:2})||c("-lh7-",{offset:2})||c("-lzs-",{offset:2})||c("-lz4-",{offset:2})||c("-lz5-",{offset:2})||c("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(t([0,0,1,186])){if(t([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(t([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(c("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(t([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(c("<?xml "))return{ext:"xml",mime:"application/xml"};if(t([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(t([82,97,114,33,26,7])&&(r[6]===0||r[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(c("solid "))return{ext:"stl",mime:"model/stl"};if(c("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(c("!<arch>"))return await e.ignore(8),await e.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(t([137,80,78,71,13,10,26,10])){await e.ignore(8);async function h(){return{length:await e.readToken(Token.INT32_BE),type:await e.readToken(new Token.StringType(4,"binary"))}}do{const l=await h();if(l.length<0)return;switch(l.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(l.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(t([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(t([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(t([102,114,101,101],{offset:4})||t([109,100,97,116],{offset:4})||t([109,111,111,118],{offset:4})||t([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(t([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(c("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(t([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(t([48,38,178,117,142,102,207,17,166,217])){async function h(){const l=Buffer.alloc(16);return await e.readBuffer(l),{id:l,size:Number(await e.readToken(Token.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const l=await h();let i=l.size-24;if(_check(l.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const p=Buffer.alloc(16);if(i-=await e.readBuffer(p),_check(p,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(p,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(i)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(t([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((t([126,16,4])||t([126,24,4]))&&t([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(t([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(t([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(t([255,10])||t([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(t([0,0,1,186])||t([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(t([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(t([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(t([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(t([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(r,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),c("BEGIN:")){if(c("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(c("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(c("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(c("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(c("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(t([4,0,0,0])&&r.length>=16){const h=r.readUInt32LE(12);if(h>12&&r.length>=h+16)try{const l=r.slice(16,h+16).toString();if(JSON.parse(l).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(t([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(c("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(t([71],{offset:4})&&(t([71],{offset:192})||t([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(t([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(t([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(t([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(t([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(t([76,80],{offset:34})&&(t([0,0,1],{offset:8})||t([1,0,2],{offset:8})||t([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(t([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(r,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(r))return{ext:"tar",mime:"application/x-tar"};if(t([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(c("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(r.length>=2&&t([255,224],{offset:0,mask:[255,224]})){if(t([16],{offset:1,mask:[22]}))return t([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(t([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(t([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(t([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const e=new stream.PassThrough;let r;stream.pipeline?r=stream.pipeline(readableStream,e,()=>{}):r=readableStream.pipe(e);const o=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const t=await fromBuffer(o);e.fileType=t}catch(t){reject(t)}resolve(r)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};return Object.defineProperty(fileType,"extensions",{get(){return new Set(supported.extensions)}}),Object.defineProperty(fileType,"mimeTypes",{get(){return new Set(supported.mimeTypes)}}),core=fileType,core}var contentType={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var hasRequiredContentType;function requireContentType(){if(hasRequiredContentType)return contentType;hasRequiredContentType=1;var e=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,r=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,t=/\\([\u000b\u0020-\u00ff])/g,c=/([\\"])/g,h=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;contentType.format=l,contentType.parse=i;function l(m){if(!m||typeof m!="object")throw new TypeError("argument obj is required");var u=m.parameters,a=m.type;if(!a||!h.test(a))throw new TypeError("invalid type");var g=a;if(u&&typeof u=="object")for(var b,y=Object.keys(u).sort(),T=0;T<y.length;T++){if(b=y[T],!o.test(b))throw new TypeError("invalid parameter name");g+="; "+b+"="+s(u[b])}return g}function i(m){if(!m)throw new TypeError("argument string is required");var u=typeof m=="object"?p(m):m;if(typeof u!="string")throw new TypeError("argument string is required to be a string");var a=u.indexOf(";"),g=a!==-1?u.slice(0,a).trim():u.trim();if(!h.test(g))throw new TypeError("invalid media type");var b=new d(g.toLowerCase());if(a!==-1){var y,T,E;for(e.lastIndex=a;T=e.exec(u);){if(T.index!==a)throw new TypeError("invalid parameter format");a+=T[0].length,y=T[1].toLowerCase(),E=T[2],E.charCodeAt(0)===34&&(E=E.slice(1,-1),E.indexOf("\\")!==-1&&(E=E.replace(t,"$1"))),b.parameters[y]=E}if(a!==u.length)throw new TypeError("invalid parameter format")}return b}function p(m){var u;if(typeof m.getHeader=="function"?u=m.getHeader("content-type"):typeof m.headers=="object"&&(u=m.headers&&m.headers["content-type"]),typeof u!="string")throw new TypeError("content-type header is missing from object");return u}function s(m){var u=String(m);if(o.test(u))return u;if(u.length>0&&!r.test(u))throw new TypeError("invalid parameter value");return'"'+u.replace(c,"\\$1")+'"'}function d(m){this.parameters=Object.create(null),this.type=m}return contentType}var mediaTyper={};/*!
 * media-typer
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var hasRequiredMediaTyper;function requireMediaTyper(){if(hasRequiredMediaTyper)return mediaTyper;hasRequiredMediaTyper=1;var e=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,r=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,o=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;mediaTyper.format=t,mediaTyper.parse=h,mediaTyper.test=c;function t(i){if(!i||typeof i!="object")throw new TypeError("argument obj is required");var p=i.subtype,s=i.suffix,d=i.type;if(!d||!r.test(d))throw new TypeError("invalid type");if(!p||!e.test(p))throw new TypeError("invalid subtype");var m=d+"/"+p;if(s){if(!r.test(s))throw new TypeError("invalid suffix");m+="+"+s}return m}function c(i){if(!i)throw new TypeError("argument string is required");if(typeof i!="string")throw new TypeError("argument string is required to be a string");return o.test(i.toLowerCase())}function h(i){if(!i)throw new TypeError("argument string is required");if(typeof i!="string")throw new TypeError("argument string is required to be a string");var p=o.exec(i.toLowerCase());if(!p)throw new TypeError("invalid media type");var s=p[1],d=p[2],m,u=d.lastIndexOf("+");return u!==-1&&(m=d.substr(u+1),d=d.substr(0,u)),new l(s,d,m)}function l(i,p,s){this.type=i,this.subtype=p,this.suffix=s}return mediaTyper}var MetadataCollector={},type={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TrackType=e.TargetType=e.DataType=void 0,(function(r){r[r.string=0]="string",r[r.uint=1]="uint",r[r.uid=2]="uid",r[r.bool=3]="bool",r[r.binary=4]="binary",r[r.float=5]="float"})(e.DataType||(e.DataType={})),(function(r){r[r.shot=10]="shot",r[r.scene=20]="scene",r[r.track=30]="track",r[r.part=40]="part",r[r.album=50]="album",r[r.edition=60]="edition",r[r.collection=70]="collection"})(e.TargetType||(e.TargetType={})),(function(r){r[r.video=1]="video",r[r.audio=2]="audio",r[r.complex=3]="complex",r[r.logo=4]="logo",r[r.subtitle=17]="subtitle",r[r.button=18]="button",r[r.control=32]="control"})(e.TrackType||(e.TrackType={}))})(types)),types}var hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TrackType=void 0;var r=requireTypes();Object.defineProperty(e,"TrackType",{enumerable:!0,get:function(){return r.TrackType}})})(type)),type}var GenericTagTypes={},hasRequiredGenericTagTypes;function requireGenericTagTypes(){return hasRequiredGenericTagTypes||(hasRequiredGenericTagTypes=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isUnique=e.isSingleton=e.commonTags=void 0,e.commonTags={year:{multiple:!1},track:{multiple:!1},disk:{multiple:!1},title:{multiple:!1},artist:{multiple:!1},artists:{multiple:!0,unique:!0},albumartist:{multiple:!1},album:{multiple:!1},date:{multiple:!1},originaldate:{multiple:!1},originalyear:{multiple:!1},comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:{multiple:!1},subtitle:{multiple:!0},discsubtitle:{multiple:!1},totaltracks:{multiple:!1},totaldiscs:{multiple:!1},compilation:{multiple:!1},rating:{multiple:!0},bpm:{multiple:!1},mood:{multiple:!1},media:{multiple:!1},catalognumber:{multiple:!0,unique:!0},tvShow:{multiple:!1},tvShowSort:{multiple:!1},tvSeason:{multiple:!1},tvEpisode:{multiple:!1},tvEpisodeId:{multiple:!1},tvNetwork:{multiple:!1},podcast:{multiple:!1},podcasturl:{multiple:!1},releasestatus:{multiple:!1},releasetype:{multiple:!0},releasecountry:{multiple:!1},script:{multiple:!1},language:{multiple:!1},copyright:{multiple:!1},license:{multiple:!1},encodedby:{multiple:!1},encodersettings:{multiple:!1},gapless:{multiple:!1},barcode:{multiple:!1},isrc:{multiple:!0},asin:{multiple:!1},musicbrainz_recordingid:{multiple:!1},musicbrainz_trackid:{multiple:!1},musicbrainz_albumid:{multiple:!1},musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:{multiple:!1},musicbrainz_workid:{multiple:!1},musicbrainz_trmid:{multiple:!1},musicbrainz_discid:{multiple:!1},acoustid_id:{multiple:!1},acoustid_fingerprint:{multiple:!1},musicip_puid:{multiple:!1},musicip_fingerprint:{multiple:!1},website:{multiple:!1},"performer:instrument":{multiple:!0,unique:!0},averageLevel:{multiple:!1},peakLevel:{multiple:!1},notes:{multiple:!0,unique:!1},key:{multiple:!1},originalalbum:{multiple:!1},originalartist:{multiple:!1},discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:{multiple:!1},discogs_label_id:{multiple:!1},discogs_master_release_id:{multiple:!1},discogs_votes:{multiple:!1},discogs_rating:{multiple:!1},replaygain_track_peak:{multiple:!1},replaygain_track_gain:{multiple:!1},replaygain_album_peak:{multiple:!1},replaygain_album_gain:{multiple:!1},replaygain_track_minmax:{multiple:!1},replaygain_album_minmax:{multiple:!1},replaygain_undo:{multiple:!1},description:{multiple:!0},longDescription:{multiple:!1},category:{multiple:!0},hdVideo:{multiple:!1},keywords:{multiple:!0},movement:{multiple:!1},movementIndex:{multiple:!1},movementTotal:{multiple:!1},podcastId:{multiple:!1},showMovement:{multiple:!1},stik:{multiple:!1}};function r(t){return e.commonTags.hasOwnProperty(t)&&!e.commonTags[t].multiple}e.isSingleton=r;function o(t){return!e.commonTags[t].multiple||e.commonTags[t].unique}e.isUnique=o})(GenericTagTypes)),GenericTagTypes}var CombinedTagMapper={},ID3v1TagMap={},GenericTagMapper={},hasRequiredGenericTagMapper;function requireGenericTagMapper(){if(hasRequiredGenericTagMapper)return GenericTagMapper;hasRequiredGenericTagMapper=1,Object.defineProperty(GenericTagMapper,"__esModule",{value:!0}),GenericTagMapper.CommonTagMapper=void 0;class e{static toIntOrNull(o){const t=parseInt(o,10);return isNaN(t)?null:t}static normalizeTrack(o){const t=o.toString().split("/");return{no:parseInt(t[0],10)||null,of:parseInt(t[1],10)||null}}constructor(o,t){this.tagTypes=o,this.tagMap=t}mapGenericTag(o,t){o={id:o.id,value:o.value},this.postMap(o,t);const c=this.getCommonName(o.id);return c?{id:c,value:o.value}:null}getCommonName(o){return this.tagMap[o]}postMap(o,t){}}return e.maxRatingScore=1,GenericTagMapper.CommonTagMapper=e,GenericTagMapper}var hasRequiredID3v1TagMap;function requireID3v1TagMap(){if(hasRequiredID3v1TagMap)return ID3v1TagMap;hasRequiredID3v1TagMap=1,Object.defineProperty(ID3v1TagMap,"__esModule",{value:!0}),ID3v1TagMap.ID3v1TagMapper=void 0;const e=requireGenericTagMapper(),r={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class o extends e.CommonTagMapper{constructor(){super(["ID3v1"],r)}}return ID3v1TagMap.ID3v1TagMapper=o,ID3v1TagMap}var ID3v24TagMapper={},CaseInsensitiveTagMap={},hasRequiredCaseInsensitiveTagMap;function requireCaseInsensitiveTagMap(){if(hasRequiredCaseInsensitiveTagMap)return CaseInsensitiveTagMap;hasRequiredCaseInsensitiveTagMap=1,Object.defineProperty(CaseInsensitiveTagMap,"__esModule",{value:!0}),CaseInsensitiveTagMap.CaseInsensitiveTagMap=void 0;const e=requireGenericTagMapper();let r=class extends e.CommonTagMapper{constructor(t,c){const h={};for(const l of Object.keys(c))h[l.toUpperCase()]=c[l];super(t,h)}getCommonName(t){return this.tagMap[t.toUpperCase()]}};return CaseInsensitiveTagMap.CaseInsensitiveTagMap=r,CaseInsensitiveTagMap}var Util={},hasRequiredUtil$1;function requireUtil$1(){if(hasRequiredUtil$1)return Util;hasRequiredUtil$1=1,Object.defineProperty(Util,"__esModule",{value:!0}),Util.toRatio=Util.dbToRatio=Util.ratioToDb=Util.a2hex=Util.isBitSet=Util.getBitAllignedNumber=Util.stripNulls=Util.decodeString=Util.trimRightNull=Util.findZero=Util.getBit=void 0;function e(u,a,g){return(u[a]&1<<g)!==0}Util.getBit=e;function r(u,a,g,b){let y=a;if(b==="utf16le"){for(;u[y]!==0||u[y+1]!==0;){if(y>=g)return g;y+=2}return y}else{for(;u[y]!==0;){if(y>=g)return g;y++}return y}}Util.findZero=r;function o(u){const a=u.indexOf("\0");return a===-1?u:u.substr(0,a)}Util.trimRightNull=o;function t(u){const a=u.length;if((a&1)!==0)throw new Error("Buffer length must be even");for(let g=0;g<a;g+=2){const b=u[g];u[g]=u[g+1],u[g+1]=b}return u}function c(u,a){if(u[0]===255&&u[1]===254)return c(u.subarray(2),a);if(a==="utf16le"&&u[0]===254&&u[1]===255){if((u.length&1)!==0)throw new Error("Expected even number of octets for 16-bit unicode string");return c(t(u),a)}return Buffer.from(u).toString(a)}Util.decodeString=c;function h(u){return u=u.replace(/^\x00+/g,""),u=u.replace(/\x00+$/g,""),u}Util.stripNulls=h;function l(u,a,g,b){const y=a+~~(g/8),T=g%8;let E=u[y];E&=255>>T;const x=8-T,R=b-x;return R<0?E>>=8-T-b:R>0&&(E<<=R,E|=l(u,a,g+x,R)),E}Util.getBitAllignedNumber=l;function i(u,a,g){return l(u,a,g,1)===1}Util.isBitSet=i;function p(u){const a=[];for(let g=0,b=u.length;g<b;g++){const y=Number(u.charCodeAt(g)).toString(16);a.push(y.length===1?"0"+y:y)}return a.join(" ")}Util.a2hex=p;function s(u){return 10*Math.log10(u)}Util.ratioToDb=s;function d(u){return Math.pow(10,u/10)}Util.dbToRatio=d;function m(u){const a=u.split(" ").map(g=>g.trim().toLowerCase());if(a.length>=1){const g=parseFloat(a[0]);return a.length===2&&a[1]==="db"?{dB:g,ratio:d(g)}:{dB:s(g),ratio:g}}}return Util.toRatio=m,Util}var hasRequiredID3v24TagMapper;function requireID3v24TagMapper(){if(hasRequiredID3v24TagMapper)return ID3v24TagMapper;hasRequiredID3v24TagMapper=1,Object.defineProperty(ID3v24TagMapper,"__esModule",{value:!0}),ID3v24TagMapper.ID3v24TagMapper=void 0;const e=requireGenericTagMapper(),r=requireCaseInsensitiveTagMap(),o=requireUtil$1(),t={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer","USLT:description":"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"date",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl"};let c=class Qe extends r.CaseInsensitiveTagMap{static toRating(l){return{source:l.email,rating:l.rating>0?(l.rating-1)/254*e.CommonTagMapper.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],t)}postMap(l,i){switch(l.id){case"UFID":l.value.owner_identifier==="http://musicbrainz.org"&&(l.id+=":"+l.value.owner_identifier,l.value=o.decodeString(l.value.identifier,"latin1"));break;case"PRIV":switch(l.value.owner_identifier){case"AverageLevel":case"PeakValue":l.id+=":"+l.value.owner_identifier,l.value=l.value.data.length===4?l.value.data.readUInt32LE(0):null,l.value===null&&i.addWarning("Failed to parse PRIV:PeakValue");break;default:i.addWarning(`Unknown PRIV owner-identifier: ${l.value.owner_identifier}`)}break;case"COMM":l.value=l.value?l.value.text:null;break;case"POPM":l.value=Qe.toRating(l.value);break}}};return ID3v24TagMapper.ID3v24TagMapper=c,ID3v24TagMapper}var AsfTagMapper={},hasRequiredAsfTagMapper;function requireAsfTagMapper(){if(hasRequiredAsfTagMapper)return AsfTagMapper;hasRequiredAsfTagMapper=1,Object.defineProperty(AsfTagMapper,"__esModule",{value:!0}),AsfTagMapper.AsfTagMapper=void 0;const e=requireGenericTagMapper(),r={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};let o=class et extends e.CommonTagMapper{static toRating(c){return{rating:parseFloat(c+1)/5}}constructor(){super(["asf"],r)}postMap(c){switch(c.id){case"WM/SharedUserRating":const h=c.id.split(":");c.value=et.toRating(c.value),c.id=h[0];break}}};return AsfTagMapper.AsfTagMapper=o,AsfTagMapper}var ID3v22TagMapper={},hasRequiredID3v22TagMapper;function requireID3v22TagMapper(){return hasRequiredID3v22TagMapper||(hasRequiredID3v22TagMapper=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ID3v22TagMapper=e.id3v22TagMap=void 0;const r=requireCaseInsensitiveTagMap();e.id3v22TagMap={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website","COM:iTunPGAP":"gapless",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class o extends r.CaseInsensitiveTagMap{constructor(){super(["ID3v2.2"],e.id3v22TagMap)}}e.ID3v22TagMapper=o})(ID3v22TagMapper)),ID3v22TagMapper}var APEv2TagMapper={},hasRequiredAPEv2TagMapper;function requireAPEv2TagMapper(){if(hasRequiredAPEv2TagMapper)return APEv2TagMapper;hasRequiredAPEv2TagMapper=1,Object.defineProperty(APEv2TagMapper,"__esModule",{value:!0}),APEv2TagMapper.APEv2TagMapper=void 0;const e=requireCaseInsensitiveTagMap(),r={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};let o=class extends e.CaseInsensitiveTagMap{constructor(){super(["APEv2"],r)}};return APEv2TagMapper.APEv2TagMapper=o,APEv2TagMapper}var MP4TagMapper={},hasRequiredMP4TagMapper;function requireMP4TagMapper(){return hasRequiredMP4TagMapper||(hasRequiredMP4TagMapper=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MP4TagMapper=e.tagType=void 0;const r=requireCaseInsensitiveTagMap(),o={"nam":"title","ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","alb":"album","day":"date","cmt":"comment","com":"comment",trkn:"track",disk:"disk","gen":"genre",covr:"picture","wrt":"composer","lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear",desc:"description",ldes:"longDescription","mvn":"movement","mvi":"movementIndex","mvc":"movementTotal","wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};e.tagType="iTunes";class t extends r.CaseInsensitiveTagMap{constructor(){super([e.tagType],o)}postMap(h,l){switch(h.id){case"rate":h.value={source:void 0,rating:parseFloat(h.value)/100};break}}}e.MP4TagMapper=t})(MP4TagMapper)),MP4TagMapper}var VorbisTagMapper={},hasRequiredVorbisTagMapper;function requireVorbisTagMapper(){if(hasRequiredVorbisTagMapper)return VorbisTagMapper;hasRequiredVorbisTagMapper=1,Object.defineProperty(VorbisTagMapper,"__esModule",{value:!0}),VorbisTagMapper.VorbisTagMapper=void 0;const e=requireGenericTagMapper(),r={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};let o=class je extends e.CommonTagMapper{static toRating(c,h,l){return{source:c&&c.toLowerCase(),rating:parseFloat(h)/l*e.CommonTagMapper.maxRatingScore}}constructor(){super(["vorbis"],r)}postMap(c){if(c.id==="RATING")c.value=je.toRating(void 0,c.value,100);else if(c.id.indexOf("RATING:")===0){const h=c.id.split(":");c.value=je.toRating(h[1],c.value,1),c.id=h[0]}}};return VorbisTagMapper.VorbisTagMapper=o,VorbisTagMapper}var RiffInfoTagMap={},hasRequiredRiffInfoTagMap;function requireRiffInfoTagMap(){return hasRequiredRiffInfoTagMap||(hasRequiredRiffInfoTagMap=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RiffInfoTagMapper=e.riffInfoTagMap=void 0;const r=requireGenericTagMapper();e.riffInfoTagMap={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class o extends r.CommonTagMapper{constructor(){super(["exif"],e.riffInfoTagMap)}}e.RiffInfoTagMapper=o})(RiffInfoTagMap)),RiffInfoTagMap}var MatroskaTagMapper={},hasRequiredMatroskaTagMapper;function requireMatroskaTagMapper(){if(hasRequiredMatroskaTagMapper)return MatroskaTagMapper;hasRequiredMatroskaTagMapper=1,Object.defineProperty(MatroskaTagMapper,"__esModule",{value:!0}),MatroskaTagMapper.MatroskaTagMapper=void 0;const e=requireCaseInsensitiveTagMap(),r={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};let o=class extends e.CaseInsensitiveTagMap{constructor(){super(["matroska"],r)}};return MatroskaTagMapper.MatroskaTagMapper=o,MatroskaTagMapper}var AiffTagMap={},hasRequiredAiffTagMap;function requireAiffTagMap(){if(hasRequiredAiffTagMap)return AiffTagMap;hasRequiredAiffTagMap=1,Object.defineProperty(AiffTagMap,"__esModule",{value:!0}),AiffTagMap.AiffTagMapper=void 0;const e=requireGenericTagMapper(),r={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class o extends e.CommonTagMapper{constructor(){super(["AIFF"],r)}}return AiffTagMap.AiffTagMapper=o,AiffTagMap}var hasRequiredCombinedTagMapper;function requireCombinedTagMapper(){if(hasRequiredCombinedTagMapper)return CombinedTagMapper;hasRequiredCombinedTagMapper=1,Object.defineProperty(CombinedTagMapper,"__esModule",{value:!0}),CombinedTagMapper.CombinedTagMapper=void 0;const e=requireID3v1TagMap(),r=requireID3v24TagMapper(),o=requireAsfTagMapper(),t=requireID3v22TagMapper(),c=requireAPEv2TagMapper(),h=requireMP4TagMapper(),l=requireVorbisTagMapper(),i=requireRiffInfoTagMap(),p=requireMatroskaTagMapper(),s=requireAiffTagMap();let d=class{constructor(){this.tagMappers={},[new e.ID3v1TagMapper,new t.ID3v22TagMapper,new r.ID3v24TagMapper,new h.MP4TagMapper,new h.MP4TagMapper,new l.VorbisTagMapper,new c.APEv2TagMapper,new o.AsfTagMapper,new i.RiffInfoTagMapper,new p.MatroskaTagMapper,new s.AiffTagMapper].forEach(u=>{this.registerTagMapper(u)})}mapTag(u,a,g){if(this.tagMappers[u])return this.tagMappers[u].mapGenericTag(a,g);throw new Error("No generic tag mapper defined for tag-format: "+u)}registerTagMapper(u){for(const a of u.tagTypes)this.tagMappers[a]=u}};return CombinedTagMapper.CombinedTagMapper=d,CombinedTagMapper}var hasRequiredMetadataCollector;function requireMetadataCollector(){if(hasRequiredMetadataCollector)return MetadataCollector;hasRequiredMetadataCollector=1,Object.defineProperty(MetadataCollector,"__esModule",{value:!0}),MetadataCollector.joinArtists=MetadataCollector.MetadataCollector=void 0;const e=requireType(),r=requireBrowser$3(),o=requireGenericTagTypes(),t=requireCombinedTagMapper(),c=requireGenericTagMapper(),h=requireUtil$1(),l=requireCore$1(),i=(0,r.default)("music-metadata:collector"),p=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];let s=class{constructor(u){this.opts=u,this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new t.CombinedTagMapper;let a=1;for(const g of p)this.originPriority[g]=a++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(u){i(`streamInfo: type=${e.TrackType[u.type]}, codec=${u.codecName}`),this.format.trackInfo.push(u)}setFormat(u,a){i(`format: ${u} = ${a}`),this.format[u]=a,this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:u,value:a}})}addTag(u,a,g){i(`tag ${u}.${a} = ${g}`),this.native[u]||(this.format.tagTypes.push(u),this.native[u]=[]),this.native[u].push({id:a,value:g}),this.toCommon(u,a,g)}addWarning(u){this.quality.warnings.push({message:u})}postMap(u,a){switch(a.id){case"artist":if(this.commonOrigin.artist===this.originPriority[u])return this.postMap("artificial",{id:"artists",value:a.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:a.value});break;case"artists":if((!this.common.artist||this.commonOrigin.artist===this.originPriority.artificial)&&(!this.common.artists||this.common.artists.indexOf(a.value)===-1)){const T=(this.common.artists||[]).concat([a.value]),x={id:"artist",value:d(T)};this.setGenericTag("artificial",x)}break;case"picture":this.postFixPicture(a.value).then(T=>{T!==null&&(a.value=T,this.setGenericTag(u,a))});return;case"totaltracks":this.common.track.of=c.CommonTagMapper.toIntOrNull(a.value);return;case"totaldiscs":this.common.disk.of=c.CommonTagMapper.toIntOrNull(a.value);return;case"movementTotal":this.common.movementIndex.of=c.CommonTagMapper.toIntOrNull(a.value);return;case"track":case"disk":case"movementIndex":const g=this.common[a.id].of;this.common[a.id]=c.CommonTagMapper.normalizeTrack(a.value),this.common[a.id].of=g??this.common[a.id].of;return;case"bpm":case"year":case"originalyear":a.value=parseInt(a.value,10);break;case"date":const b=parseInt(a.value.substr(0,4),10);isNaN(b)||(this.common.year=b);break;case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":a.value=typeof a.value=="string"?parseInt(a.value,10):a.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":a.value=(0,h.toRatio)(a.value);break;case"replaygain_track_minmax":a.value=a.value.split(",").map(T=>parseInt(T,10));break;case"replaygain_undo":const y=a.value.split(",").map(T=>parseInt(T,10));a.value={leftChannel:y[0],rightChannel:y[1]};break;case"gapless":case"compilation":case"podcast":case"showMovement":a.value=a.value==="1"||a.value===1;break;case"isrc":if(this.common[a.id]&&this.common[a.id].indexOf(a.value)!==-1)return;break}a.value!==null&&this.setGenericTag(u,a)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(u){if(u.data&&u.data.length>0){if(!u.format){const a=await l.fromBuffer(u.data);if(a)u.format=a.mime;else return null}switch(u.format=u.format.toLocaleLowerCase(),u.format){case"image/jpg":u.format="image/jpeg"}return u}return this.addWarning("Empty picture tag found"),null}toCommon(u,a,g){const b={id:a,value:g},y=this.tagMapper.mapTag(u,b,this);y&&this.postMap(u,y)}setGenericTag(u,a){i(`common.${a.id} = ${a.value}`);const g=this.commonOrigin[a.id]||1e3,b=this.originPriority[u];if((0,o.isSingleton)(a.id))if(b<=g)this.common[a.id]=a.value,this.commonOrigin[a.id]=b;else return i(`Ignore native tag (singleton): ${u}.${a.id} = ${a.value}`);else if(b===g)!(0,o.isUnique)(a.id)||this.common[a.id].indexOf(a.value)===-1?this.common[a.id].push(a.value):i(`Ignore duplicate value: ${u}.${a.id} = ${a.value}`);else if(b<g)this.common[a.id]=[a.value],this.commonOrigin[a.id]=b;else return i(`Ignore native tag (list): ${u}.${a.id} = ${a.value}`);this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:a.id,value:a.value}})}};MetadataCollector.MetadataCollector=s;function d(m){return m.length>2?m.slice(0,m.length-1).join(", ")+" & "+m[m.length-1]:m.join(" & ")}return MetadataCollector.joinArtists=d,MetadataCollector}var AiffParser={},ID3v2Parser={},FrameParser={},ID3v2Token={},hasRequiredID3v2Token;function requireID3v2Token(){return hasRequiredID3v2Token||(hasRequiredID3v2Token=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TextEncodingToken=e.ExtendedHeader=e.ID3v2Header=e.UINT32SYNCSAFE=e.AttachedPictureType=void 0;const r=requireLib$2(),o=requireUtil$1();(function(t){t[t.Other=0]="Other",t[t["32x32 pixels 'file icon' (PNG only)"]=1]="32x32 pixels 'file icon' (PNG only)",t[t["Other file icon"]=2]="Other file icon",t[t["Cover (front)"]=3]="Cover (front)",t[t["Cover (back)"]=4]="Cover (back)",t[t["Leaflet page"]=5]="Leaflet page",t[t["Media (e.g. label side of CD)"]=6]="Media (e.g. label side of CD)",t[t["Lead artist/lead performer/soloist"]=7]="Lead artist/lead performer/soloist",t[t["Artist/performer"]=8]="Artist/performer",t[t.Conductor=9]="Conductor",t[t["Band/Orchestra"]=10]="Band/Orchestra",t[t.Composer=11]="Composer",t[t["Lyricist/text writer"]=12]="Lyricist/text writer",t[t["Recording Location"]=13]="Recording Location",t[t["During recording"]=14]="During recording",t[t["During performance"]=15]="During performance",t[t["Movie/video screen capture"]=16]="Movie/video screen capture",t[t["A bright coloured fish"]=17]="A bright coloured fish",t[t.Illustration=18]="Illustration",t[t["Band/artist logotype"]=19]="Band/artist logotype",t[t["Publisher/Studio logotype"]=20]="Publisher/Studio logotype"})(e.AttachedPictureType||(e.AttachedPictureType={})),e.UINT32SYNCSAFE={get:(t,c)=>t[c+3]&127|t[c+2]<<7|t[c+1]<<14|t[c]<<21,len:4},e.ID3v2Header={len:10,get:(t,c)=>({fileIdentifier:new r.StringType(3,"ascii").get(t,c),version:{major:r.INT8.get(t,c+3),revision:r.INT8.get(t,c+4)},flags:{unsynchronisation:o.getBit(t,c+5,7),isExtendedHeader:o.getBit(t,c+5,6),expIndicator:o.getBit(t,c+5,5),footer:o.getBit(t,c+5,4)},size:e.UINT32SYNCSAFE.get(t,c+6)})},e.ExtendedHeader={len:10,get:(t,c)=>({size:r.UINT32_BE.get(t,c),extendedFlags:r.UINT16_BE.get(t,c+4),sizeOfPadding:r.UINT32_BE.get(t,c+6),crcDataPresent:o.getBit(t,c+4,31)})},e.TextEncodingToken={len:1,get:(t,c)=>{switch(t[c]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf16le",bom:!0};case 2:return{encoding:"utf16le",bom:!1};case 3:return{encoding:"utf8",bom:!1};default:return{encoding:"utf8",bom:!1}}}}})(ID3v2Token)),ID3v2Token}var ID3v1Parser={},BasicParser={},hasRequiredBasicParser;function requireBasicParser(){if(hasRequiredBasicParser)return BasicParser;hasRequiredBasicParser=1,Object.defineProperty(BasicParser,"__esModule",{value:!0}),BasicParser.BasicParser=void 0;let e=class{init(o,t,c){return this.metadata=o,this.tokenizer=t,this.options=c,this}};return BasicParser.BasicParser=e,BasicParser}var APEv2Parser={},APEv2Token={},FourCC={},hasRequiredFourCC;function requireFourCC(){return hasRequiredFourCC||(hasRequiredFourCC=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FourCcToken=void 0;const r=requireUtil$1(),o=/^[\x21-\x7e][\x20-\x7e\x00()]{3}/;e.FourCcToken={len:4,get:(t,c)=>{const h=t.toString("binary",c,c+e.FourCcToken.len);if(!h.match(o))throw new Error(`FourCC contains invalid characters: ${r.a2hex(h)} "${h}"`);return h},put:(t,c,h)=>{const l=Buffer.from(h,"binary");if(l.length!==4)throw new Error("Invalid length");return l.copy(t,c)}}})(FourCC)),FourCC}var hasRequiredAPEv2Token;function requireAPEv2Token(){return hasRequiredAPEv2Token||(hasRequiredAPEv2Token=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isBitSet=e.parseTagFlags=e.TagField=e.TagItemHeader=e.TagFooter=e.Header=e.DescriptorParser=e.DataType=void 0;const r=requireLib$2(),o=requireFourCC();(function(l){l[l.text_utf8=0]="text_utf8",l[l.binary=1]="binary",l[l.external_info=2]="external_info",l[l.reserved=3]="reserved"})(e.DataType||(e.DataType={})),e.DescriptorParser={len:52,get:(l,i)=>({ID:o.FourCcToken.get(l,i),version:r.UINT32_LE.get(l,i+4)/1e3,descriptorBytes:r.UINT32_LE.get(l,i+8),headerBytes:r.UINT32_LE.get(l,i+12),seekTableBytes:r.UINT32_LE.get(l,i+16),headerDataBytes:r.UINT32_LE.get(l,i+20),apeFrameDataBytes:r.UINT32_LE.get(l,i+24),apeFrameDataBytesHigh:r.UINT32_LE.get(l,i+28),terminatingDataBytes:r.UINT32_LE.get(l,i+32),fileMD5:new r.Uint8ArrayType(16).get(l,i+36)})},e.Header={len:24,get:(l,i)=>({compressionLevel:r.UINT16_LE.get(l,i),formatFlags:r.UINT16_LE.get(l,i+2),blocksPerFrame:r.UINT32_LE.get(l,i+4),finalFrameBlocks:r.UINT32_LE.get(l,i+8),totalFrames:r.UINT32_LE.get(l,i+12),bitsPerSample:r.UINT16_LE.get(l,i+16),channel:r.UINT16_LE.get(l,i+18),sampleRate:r.UINT32_LE.get(l,i+20)})},e.TagFooter={len:32,get:(l,i)=>({ID:new r.StringType(8,"ascii").get(l,i),version:r.UINT32_LE.get(l,i+8),size:r.UINT32_LE.get(l,i+12),fields:r.UINT32_LE.get(l,i+16),flags:c(r.UINT32_LE.get(l,i+20))})},e.TagItemHeader={len:8,get:(l,i)=>({size:r.UINT32_LE.get(l,i),flags:c(r.UINT32_LE.get(l,i+4))})};const t=l=>new r.Uint8ArrayType(l.size-e.TagFooter.len);e.TagField=t;function c(l){return{containsHeader:h(l,31),containsFooter:h(l,30),isHeader:h(l,31),readOnly:h(l,0),dataType:(l&6)>>1}}e.parseTagFlags=c;function h(l,i){return(l&1<<i)!==0}e.isBitSet=h})(APEv2Token)),APEv2Token}var hasRequiredAPEv2Parser;function requireAPEv2Parser(){if(hasRequiredAPEv2Parser)return APEv2Parser;hasRequiredAPEv2Parser=1,Object.defineProperty(APEv2Parser,"__esModule",{value:!0}),APEv2Parser.APEv2Parser=void 0;const e=requireBrowser$3(),r=requireCore$2(),o=requireLib$2(),t=requireUtil$1(),c=requireBasicParser(),h=requireAPEv2Token(),l=(0,e.default)("music-metadata:parser:APEv2"),i="APEv2",p="APETAGEX";let s=class Fe extends c.BasicParser{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(m,u,a){const g=new Fe;return g.init(m,u,a),g.tryParseApeHeader()}static calculateDuration(m){let u=m.totalFrames>1?m.blocksPerFrame*(m.totalFrames-1):0;return u+=m.finalFrameBlocks,u/m.sampleRate}static async findApeFooterOffset(m,u){const a=Buffer.alloc(h.TagFooter.len);await m.randomRead(a,0,h.TagFooter.len,u-h.TagFooter.len);const g=h.TagFooter.get(a,0);if(g.ID==="APETAGEX")return l(`APE footer header at offset=${u}`),{footer:g,offset:u-g.size}}static parseTagFooter(m,u,a){const g=h.TagFooter.get(u,u.length-h.TagFooter.len);if(g.ID!==p)throw new Error("Unexpected APEv2 Footer ID preamble value.");r.fromBuffer(u);const b=new Fe;return b.init(m,r.fromBuffer(u),a),b.parseTags(g)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<h.TagFooter.len){l("No APEv2 header found, end-of-file reached");return}const m=await this.tokenizer.peekToken(h.TagFooter);if(m.ID===p)return await this.tokenizer.ignore(h.TagFooter.len),this.parseTags(m);if(l(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const u=this.tokenizer.fileInfo.size-this.tokenizer.position,a=Buffer.alloc(u);return await this.tokenizer.readBuffer(a),Fe.parseTagFooter(this.metadata,a,this.options)}}async parse(){const m=await this.tokenizer.readToken(h.DescriptorParser);if(m.ID!=="MAC ")throw new Error("Unexpected descriptor ID");this.ape.descriptor=m;const u=m.descriptorBytes-h.DescriptorParser.len,a=await(u>0?this.parseDescriptorExpansion(u):this.parseHeader());return await this.tokenizer.ignore(a.forwardBytes),this.tryParseApeHeader()}async parseTags(m){const u=Buffer.alloc(256);let a=m.size-h.TagFooter.len;l(`Parse APE tags at offset=${this.tokenizer.position}, size=${a}`);for(let g=0;g<m.fields;g++){if(a<h.TagItemHeader.len){this.metadata.addWarning(`APEv2 Tag-header: ${m.fields-g} items remaining, but no more tag data to read.`);break}const b=await this.tokenizer.readToken(h.TagItemHeader);a-=h.TagItemHeader.len+b.size,await this.tokenizer.peekBuffer(u,{length:Math.min(u.length,a)});let y=t.findZero(u,0,u.length);const T=await this.tokenizer.readToken(new o.StringType(y,"ascii"));switch(await this.tokenizer.ignore(1),a-=T.length+1,b.flags.dataType){case h.DataType.text_utf8:{const x=(await this.tokenizer.readToken(new o.StringType(b.size,"utf8"))).split(/\x00/g);for(const R of x)this.metadata.addTag(i,T,R);break}case h.DataType.binary:if(this.options.skipCovers)await this.tokenizer.ignore(b.size);else{const E=Buffer.alloc(b.size);await this.tokenizer.readBuffer(E),y=t.findZero(E,0,E.length);const x=E.toString("utf8",0,y),R=Buffer.from(E.slice(y+1));this.metadata.addTag(i,T,{description:x,data:R})}break;case h.DataType.external_info:l(`Ignore external info ${T}`),await this.tokenizer.ignore(b.size);break;case h.DataType.reserved:l(`Ignore external info ${T}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${T}"`),await this.tokenizer.ignore(b.size);break}}}async parseDescriptorExpansion(m){return await this.tokenizer.ignore(m),this.parseHeader()}async parseHeader(){const m=await this.tokenizer.readToken(h.Header);return this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",m.bitsPerSample),this.metadata.setFormat("sampleRate",m.sampleRate),this.metadata.setFormat("numberOfChannels",m.channel),this.metadata.setFormat("duration",Fe.calculateDuration(m)),{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}};return APEv2Parser.APEv2Parser=s,APEv2Parser}var hasRequiredID3v1Parser;function requireID3v1Parser(){return hasRequiredID3v1Parser||(hasRequiredID3v1Parser=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasID3v1Header=e.ID3v1Parser=e.Genres=void 0;const r=requireBrowser$3(),o=requireLib$2(),t=requireUtil$1(),c=requireBasicParser(),h=requireAPEv2Parser(),l=(0,r.default)("music-metadata:parser:ID3v1");e.Genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];const i={len:128,get:(m,u)=>{const a=new p(3).get(m,u);return a==="TAG"?{header:a,title:new p(30).get(m,u+3),artist:new p(30).get(m,u+33),album:new p(30).get(m,u+63),year:new p(4).get(m,u+93),comment:new p(28).get(m,u+97),zeroByte:o.UINT8.get(m,u+127),track:o.UINT8.get(m,u+126),genre:o.UINT8.get(m,u+127)}:null}};class p extends o.StringType{constructor(u){super(u,"binary")}get(u,a){let g=super.get(u,a);return g=t.trimRightNull(g),g=g.trim(),g.length>0?g:void 0}}class s extends c.BasicParser{static getGenre(u){if(u<e.Genres.length)return e.Genres[u]}async parse(){if(!this.tokenizer.fileInfo.size){l("Skip checking for ID3v1 because the file-size is unknown");return}if(this.options.apeHeader){this.tokenizer.ignore(this.options.apeHeader.offset-this.tokenizer.position);const g=new h.APEv2Parser;g.init(this.metadata,this.tokenizer,this.options),await g.parseTags(this.options.apeHeader.footer)}const u=this.tokenizer.fileInfo.size-i.len;if(this.tokenizer.position>u){l("Already consumed the last 128 bytes");return}const a=await this.tokenizer.readToken(i,u);if(a){l("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-i.len);for(const b of["title","artist","album","comment","track","year"])a[b]&&a[b]!==""&&this.addTag(b,a[b]);const g=s.getGenre(a.genre);g&&this.addTag("genre",g)}else l("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-i.len)}addTag(u,a){this.metadata.addTag("ID3v1",u,a)}}e.ID3v1Parser=s;async function d(m){if(m.fileSize>=128){const u=Buffer.alloc(3);return await m.randomRead(u,0,u.length,m.fileSize-128),u.toString("binary")==="TAG"}return!1}e.hasID3v1Header=d})(ID3v1Parser)),ID3v1Parser}var hasRequiredFrameParser;function requireFrameParser(){if(hasRequiredFrameParser)return FrameParser;hasRequiredFrameParser=1,Object.defineProperty(FrameParser,"__esModule",{value:!0}),FrameParser.FrameParser=FrameParser.parseGenre=void 0;const e=requireBrowser$3(),r=requireLib$2(),o=requireUtil$1(),t=requireID3v2Token(),c=requireID3v1Parser(),h=(0,e.default)("music-metadata:id3v2:frame-parser"),l="latin1";function i(d){const m=[];let u,a="";for(const g of d)if(typeof u=="string")if(g==="("&&u==="")a+="(",u=void 0;else if(g===")"){a!==""&&(m.push(a),a="");const b=p(u);b&&m.push(b),u=void 0}else u+=g;else g==="("?u="":a+=g;return a&&(m.length===0&&a.match(/^\d*$/)&&(a=c.Genres[a]),m.push(a)),m}FrameParser.parseGenre=i;function p(d){if(d==="RX")return"Remix";if(d==="CR")return"Cover";if(d.match(/^\d*$/))return c.Genres[d]}let s=class Pe{constructor(m,u){this.major=m,this.warningCollector=u}readData(m,u,a){if(m.length===0){this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${u}`);return}const{encoding:g,bom:b}=t.TextEncodingToken.get(m,0),y=m.length;let T=0,E=[];const x=Pe.getNullTerminatorLength(g);let R;const P={};switch(h(`Parsing tag type=${u}, encoding=${g}, bom=${b}`),u!=="TXXX"&&u[0]==="T"?"T*":u){case"T*":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":let A;try{A=o.decodeString(m.slice(1),g).replace(/\x00+$/,"")}catch(j){this.warningCollector.addWarning(`id3v2.${this.major} type=${u} header has invalid string value: ${j.message}`)}switch(u){case"TMCL":case"TIPL":case"IPLS":E=this.splitValue(u,A),E=Pe.functionList(E);break;case"TRK":case"TRCK":case"TPOS":E=A;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":E=this.splitValue(u,A);break;case"TCO":case"TCON":E=this.splitValue(u,A).map(j=>i(j)).reduce((j,M)=>j.concat(M),[]);break;case"PCS":case"PCST":E=this.major>=4?this.splitValue(u,A):[A],E=Array.isArray(E)&&E[0]===""?1:0;break;default:E=this.major>=4?this.splitValue(u,A):[A]}break;case"TXXX":E=Pe.readIdentifierAndData(m,T+1,y,g),E={description:E.id,text:this.splitValue(u,o.decodeString(E.data,g).replace(/\x00+$/,""))};break;case"PIC":case"APIC":if(a){const j={};switch(T+=1,this.major){case 2:j.format=o.decodeString(m.slice(T,T+3),"latin1"),T+=3;break;case 3:case 4:R=o.findZero(m,T,y,l),j.format=o.decodeString(m.slice(T,R),l),T=R+1;break;default:throw new Error("Warning: unexpected major versionIndex: "+this.major)}j.format=Pe.fixPictureMimeType(j.format),j.type=t.AttachedPictureType[m[T]],T+=1,R=o.findZero(m,T,y,g),j.description=o.decodeString(m.slice(T,R),g),T=R+x,j.data=Buffer.from(m.slice(T,y)),E=j}break;case"CNT":case"PCNT":E=r.UINT32_BE.get(m,0);break;case"SYLT":for(T+=7,E=[];T<y;){const j=m.slice(T,T=o.findZero(m,T,y,g));T+=5,E.push(o.decodeString(j,g))}break;case"ULT":case"USLT":case"COM":case"COMM":T+=1,P.language=o.decodeString(m.slice(T,T+3),l),T+=3,R=o.findZero(m,T,y,g),P.description=o.decodeString(m.slice(T,R),g),T=R+x,P.text=o.decodeString(m.slice(T,y),g).replace(/\x00+$/,""),E=[P];break;case"UFID":E=Pe.readIdentifierAndData(m,T,y,l),E={owner_identifier:E.id,identifier:E.data};break;case"PRIV":E=Pe.readIdentifierAndData(m,T,y,l),E={owner_identifier:E.id,data:E.data};break;case"POPM":R=o.findZero(m,T,y,l);const w=o.decodeString(m.slice(T,R),l);T=R+1;const S=y-T;E={email:w,rating:r.UINT8.get(m,T),counter:S>=5?r.UINT32_BE.get(m,T+1):void 0};break;case"GEOB":{R=o.findZero(m,T+1,y,g);const j=o.decodeString(m.slice(T+1,R),l);T=R+1,R=o.findZero(m,T,y-T,g);const M=o.decodeString(m.slice(T,R),l);T=R+1,R=o.findZero(m,T,y-T,g);const q=o.decodeString(m.slice(T,R),l);E={type:j,filename:M,description:q,data:m.slice(T+1,y)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":E=o.decodeString(m.slice(T,R),l);break;case"WXXX":{R=o.findZero(m,T+1,y,g);const j=o.decodeString(m.slice(T+1,R),g);T=R+(g==="utf16le"?2:1),E={description:j,url:o.decodeString(m.slice(T,y),l)};break}case"WFD":case"WFED":E=o.decodeString(m.slice(T+1,o.findZero(m,T+1,y,g)),g);break;case"MCDI":{E=m.slice(0,y);break}default:h("Warning: unsupported id3v2-tag-type: "+u);break}return E}static fixPictureMimeType(m){switch(m=m.toLocaleLowerCase(),m){case"jpg":return"image/jpeg";case"png":return"image/png"}return m}static functionList(m){const u={};for(let a=0;a+1<m.length;a+=2){const g=m[a+1].split(",");u[m[a]]=u.hasOwnProperty(m[a])?u[m[a]].concat(g):g}return u}splitValue(m,u){let a;return this.major<4?(a=u.split(/\x00/g),a.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${m} uses non standard null-separator.`):a=u.split(/\//g)):a=u.split(/\x00/g),Pe.trimArray(a)}static trimArray(m){return m.map(u=>u.replace(/\x00+$/,"").trim())}static readIdentifierAndData(m,u,a,g){const b=o.findZero(m,u,a,g),y=o.decodeString(m.slice(u,b),g);return u=b+Pe.getNullTerminatorLength(g),{id:y,data:m.slice(u,a)}}static getNullTerminatorLength(m){return m==="utf16le"?2:1}};return FrameParser.FrameParser=s,FrameParser}var hasRequiredID3v2Parser;function requireID3v2Parser(){if(hasRequiredID3v2Parser)return ID3v2Parser;hasRequiredID3v2Parser=1,Object.defineProperty(ID3v2Parser,"__esModule",{value:!0}),ID3v2Parser.ID3v2Parser=void 0;const e=requireLib$2(),r=requireUtil$1(),o=requireFrameParser(),t=requireID3v2Token();let c=class Ce{static removeUnsyncBytes(l){let i=0,p=0;for(;i<l.length-1;)i!==p&&(l[p]=l[i]),i+=l[i]===255&&l[i+1]===0?2:1,p++;return i<l.length&&(l[p++]=l[i]),l.slice(0,p)}static getFrameHeaderLength(l){switch(l){case 2:return 6;case 3:case 4:return 10;default:throw new Error("header versionIndex is incorrect")}}static readFrameFlags(l){return{status:{tag_alter_preservation:r.getBit(l,0,6),file_alter_preservation:r.getBit(l,0,5),read_only:r.getBit(l,0,4)},format:{grouping_identity:r.getBit(l,1,7),compression:r.getBit(l,1,3),encryption:r.getBit(l,1,2),unsynchronisation:r.getBit(l,1,1),data_length_indicator:r.getBit(l,1,0)}}}static readFrameData(l,i,p,s,d){const m=new o.FrameParser(p,d);switch(p){case 2:return m.readData(l,i.id,s);case 3:case 4:return i.flags.format.unsynchronisation&&(l=Ce.removeUnsyncBytes(l)),i.flags.format.data_length_indicator&&(l=l.slice(4,l.length)),m.readData(l,i.id,s);default:throw new Error("Unexpected majorVer: "+p)}}static makeDescriptionTagName(l,i){return l+(i?":"+i:"")}async parse(l,i,p){this.tokenizer=i,this.metadata=l,this.options=p;const s=await this.tokenizer.readToken(t.ID3v2Header);if(s.fileIdentifier!=="ID3")throw new Error("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=s,this.headerType="ID3v2."+s.version.major,s.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(s.size)}async parseExtendedHeader(){const l=await this.tokenizer.readToken(t.ExtendedHeader),i=l.size-t.ExtendedHeader.len;return i>0?this.parseExtendedHeaderData(i,l.size):this.parseId3Data(this.id3Header.size-l.size)}async parseExtendedHeaderData(l,i){return await this.tokenizer.ignore(l),this.parseId3Data(this.id3Header.size-i)}async parseId3Data(l){const i=await this.tokenizer.readToken(new e.Uint8ArrayType(l));for(const p of this.parseMetadata(i))if(p.id==="TXXX"){if(p.value)for(const s of p.value.text)this.addTag(Ce.makeDescriptionTagName(p.id,p.value.description),s)}else if(p.id==="COM")for(const s of p.value)this.addTag(Ce.makeDescriptionTagName(p.id,s.description),s.text);else if(p.id==="COMM")for(const s of p.value)this.addTag(Ce.makeDescriptionTagName(p.id,s.description),s);else if(Array.isArray(p.value))for(const s of p.value)this.addTag(p.id,s);else this.addTag(p.id,p.value)}addTag(l,i){this.metadata.addTag(this.headerType,l,i)}parseMetadata(l){let i=0;const p=[];for(;i!==l.length;){const s=Ce.getFrameHeaderLength(this.id3Header.version.major);if(i+s>l.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const d=l.slice(i,i+=s),m=this.readFrameHeader(d,this.id3Header.version.major),u=l.slice(i,i+=m.length),a=Ce.readFrameData(u,m,this.id3Header.version.major,!this.options.skipCovers,this.metadata);a&&p.push({id:m.id,value:a})}return p}readFrameHeader(l,i){let p;switch(i){case 2:p={id:Buffer.from(l.slice(0,3)).toString("ascii"),length:e.UINT24_BE.get(l,3)},p.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${p.id}`);break;case 3:case 4:p={id:Buffer.from(l.slice(0,4)).toString("ascii"),length:(i===4?t.UINT32SYNCSAFE:e.UINT32_BE).get(l,4),flags:Ce.readFrameFlags(l.slice(8,10))},p.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${p.id}`);break;default:throw new Error("Unexpected majorVer: "+i)}return p}};return ID3v2Parser.ID3v2Parser=c,ID3v2Parser}var AiffToken={},hasRequiredAiffToken;function requireAiffToken(){if(hasRequiredAiffToken)return AiffToken;hasRequiredAiffToken=1,Object.defineProperty(AiffToken,"__esModule",{value:!0}),AiffToken.Common=void 0;const e=requireLib$2(),r=requireFourCC();class o{constructor(c,h){this.isAifc=h;const l=h?22:18;if(c.chunkSize<l)throw new Error(`COMMON CHUNK size should always be at least ${l}`);this.len=c.chunkSize}get(c,h){const l=c.readUInt16BE(h+8)-16398,i=c.readUInt16BE(h+8+2),p={numChannels:c.readUInt16BE(h),numSampleFrames:c.readUInt32BE(h+2),sampleSize:c.readUInt16BE(h+6),sampleRate:l<0?i>>Math.abs(l):i<<l};if(this.isAifc){if(p.compressionType=r.FourCcToken.get(c,h+18),this.len>22){const s=c.readInt8(h+22);if(s>0){const d=(s+1)%2;if(23+s+d===this.len)p.compressionName=new e.StringType(s,"binary").get(c,h+23);else throw new Error("Illegal pstring length")}else p.compressionName=void 0}}else p.compressionName="PCM";return p}}return AiffToken.Common=o,AiffToken}var iff={},hasRequiredIff;function requireIff(){if(hasRequiredIff)return iff;hasRequiredIff=1,Object.defineProperty(iff,"__esModule",{value:!0}),iff.Header=void 0;const e=requireLib$2(),r=requireFourCC();return iff.Header={len:8,get:(o,t)=>({chunkID:r.FourCcToken.get(o,t),chunkSize:Number(BigInt(e.UINT32_BE.get(o,t+4)))})},iff}var hasRequiredAiffParser;function requireAiffParser(){if(hasRequiredAiffParser)return AiffParser;hasRequiredAiffParser=1,Object.defineProperty(AiffParser,"__esModule",{value:!0}),AiffParser.AIFFParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireCore$2(),t=requireID3v2Parser(),c=requireFourCC(),h=requireBasicParser(),l=requireAiffToken(),i=requireIff(),p=(0,r.default)("music-metadata:parser:aiff"),s={NONE:"not compressed	PCM	Apple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float	Apple Computer",alaw:"ALaw 2:1	8-bit ITU-T G.711 A-law",ulaw:"Law 2:1	8-bit ITU-T G.711 -law	Apple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 -law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32	IEEE 32-bit float "};class d extends h.BasicParser{async parse(){if((await this.tokenizer.readToken(i.Header)).chunkID!=="FORM")throw new Error("Invalid Chunk-ID, expected 'FORM'");const a=await this.tokenizer.readToken(c.FourCcToken);switch(a){case"AIFF":this.metadata.setFormat("container",a),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw Error("Unsupported AIFF type: "+a)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=i.Header.len;){p("Reading AIFF chunk at offset="+this.tokenizer.position);const g=await this.tokenizer.readToken(i.Header),b=2*Math.round(g.chunkSize/2),y=await this.readData(g);await this.tokenizer.ignore(b-y)}}catch(g){if(g instanceof o.EndOfStreamError)p("End-of-stream");else throw g}}async readData(u){var a;switch(u.chunkID){case"COMM":const g=await this.tokenizer.readToken(new l.Common(u,this.isCompressed));return this.metadata.setFormat("bitsPerSample",g.sampleSize),this.metadata.setFormat("sampleRate",g.sampleRate),this.metadata.setFormat("numberOfChannels",g.numChannels),this.metadata.setFormat("numberOfSamples",g.numSampleFrames),this.metadata.setFormat("duration",g.numSampleFrames/g.sampleRate),this.metadata.setFormat("codec",(a=g.compressionName)!==null&&a!==void 0?a:s[g.compressionType]),u.chunkSize;case"ID3 ":const b=await this.tokenizer.readToken(new e.Uint8ArrayType(u.chunkSize)),y=o.fromBuffer(b);return await new t.ID3v2Parser().parse(this.metadata,y,this.options),u.chunkSize;case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*u.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(u);default:return p(`Ignore chunk id=${u.chunkID}, size=${u.chunkSize}`),0}}async readTextChunk(u){return(await this.tokenizer.readToken(new e.StringType(u.chunkSize,"ascii"))).split("\0").map(g=>g.trim()).filter(g=>g&&g.length>0).forEach(g=>{this.metadata.addTag("AIFF",u.chunkID,g.trim())}),u.chunkSize}}return AiffParser.AIFFParser=d,AiffParser}var AsfParser={},GUID={},hasRequiredGUID;function requireGUID(){if(hasRequiredGUID)return GUID;hasRequiredGUID=1,Object.defineProperty(GUID,"__esModule",{value:!0});let e=class Re{static fromBin(o,t=0){return new Re(this.decode(o,t))}static decode(o,t=0){return(o.readUInt32LE(t).toString(16)+"-"+o.readUInt16LE(t+4).toString(16)+"-"+o.readUInt16LE(t+6).toString(16)+"-"+o.readUInt16BE(t+8).toString(16)+"-"+o.slice(t+10,t+16).toString("hex")).toUpperCase()}static decodeMediaType(o){switch(o.str){case Re.AudioMedia.str:return"audio";case Re.VideoMedia.str:return"video";case Re.CommandMedia.str:return"command";case Re.Degradable_JPEG_Media.str:return"degradable-jpeg";case Re.FileTransferMedia.str:return"file-transfer";case Re.BinaryMedia.str:return"binary"}}static encode(o){const t=Buffer.alloc(16);return t.writeUInt32LE(parseInt(o.slice(0,8),16),0),t.writeUInt16LE(parseInt(o.slice(9,13),16),4),t.writeUInt16LE(parseInt(o.slice(14,18),16),6),Buffer.from(o.slice(19,23),"hex").copy(t,8),Buffer.from(o.slice(24),"hex").copy(t,10),t}constructor(o){this.str=o}equals(o){return this.str===o.str}toBin(){return Re.encode(this.str)}};return e.HeaderObject=new e("75B22630-668E-11CF-A6D9-00AA0062CE6C"),e.DataObject=new e("75B22636-668E-11CF-A6D9-00AA0062CE6C"),e.SimpleIndexObject=new e("33000890-E5B1-11CF-89F4-00A0C90349CB"),e.IndexObject=new e("D6E229D3-35DA-11D1-9034-00A0C90349BE"),e.MediaObjectIndexObject=new e("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),e.TimecodeIndexObject=new e("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),e.FilePropertiesObject=new e("8CABDCA1-A947-11CF-8EE4-00C00C205365"),e.StreamPropertiesObject=new e("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),e.HeaderExtensionObject=new e("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),e.CodecListObject=new e("86D15240-311D-11D0-A3A4-00A0C90348F6"),e.ScriptCommandObject=new e("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),e.MarkerObject=new e("F487CD01-A951-11CF-8EE6-00C00C205365"),e.BitrateMutualExclusionObject=new e("D6E229DC-35DA-11D1-9034-00A0C90349BE"),e.ErrorCorrectionObject=new e("75B22635-668E-11CF-A6D9-00AA0062CE6C"),e.ContentDescriptionObject=new e("75B22633-668E-11CF-A6D9-00AA0062CE6C"),e.ExtendedContentDescriptionObject=new e("D2D0A440-E307-11D2-97F0-00A0C95EA850"),e.ContentBrandingObject=new e("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),e.StreamBitratePropertiesObject=new e("7BF875CE-468D-11D1-8D82-006097C9A2B2"),e.ContentEncryptionObject=new e("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),e.ExtendedContentEncryptionObject=new e("298AE614-2622-4C17-B935-DAE07EE9289C"),e.DigitalSignatureObject=new e("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),e.PaddingObject=new e("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),e.ExtendedStreamPropertiesObject=new e("14E6A5CB-C672-4332-8399-A96952065B5A"),e.AdvancedMutualExclusionObject=new e("A08649CF-4775-4670-8A16-6E35357566CD"),e.GroupMutualExclusionObject=new e("D1465A40-5A79-4338-B71B-E36B8FD6C249"),e.StreamPrioritizationObject=new e("D4FED15B-88D3-454F-81F0-ED5C45999E24"),e.BandwidthSharingObject=new e("A69609E6-517B-11D2-B6AF-00C04FD908E9"),e.LanguageListObject=new e("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),e.MetadataObject=new e("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),e.MetadataLibraryObject=new e("44231C94-9498-49D1-A141-1D134E457054"),e.IndexParametersObject=new e("D6E229DF-35DA-11D1-9034-00A0C90349BE"),e.MediaObjectIndexParametersObject=new e("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),e.TimecodeIndexParametersObject=new e("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),e.CompatibilityObject=new e("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),e.AdvancedContentEncryptionObject=new e("43058533-6981-49E6-9B74-AD12CB86D58C"),e.AudioMedia=new e("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),e.VideoMedia=new e("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),e.CommandMedia=new e("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),e.JFIF_Media=new e("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),e.Degradable_JPEG_Media=new e("35907DE0-E415-11CF-A917-00805F5C442B"),e.FileTransferMedia=new e("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),e.BinaryMedia=new e("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),e.ASF_Index_Placeholder_Object=new e("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2"),GUID.default=e,GUID}var AsfObject={},AsfUtil={},hasRequiredAsfUtil;function requireAsfUtil(){if(hasRequiredAsfUtil)return AsfUtil;hasRequiredAsfUtil=1,Object.defineProperty(AsfUtil,"__esModule",{value:!0}),AsfUtil.AsfUtil=void 0;const e=requireLib$2(),r=requireUtil$1();let o=class We{static getParserForAttr(c){return We.attributeParsers[c]}static parseUnicodeAttr(c){return r.stripNulls(r.decodeString(c,"utf16le"))}static parseByteArrayAttr(c){return Buffer.from(c)}static parseBoolAttr(c,h=0){return We.parseWordAttr(c,h)===1}static parseDWordAttr(c,h=0){return c.readUInt32LE(h)}static parseQWordAttr(c,h=0){return e.UINT64_LE.get(c,h)}static parseWordAttr(c,h=0){return c.readUInt16LE(h)}};return o.attributeParsers=[o.parseUnicodeAttr,o.parseByteArrayAttr,o.parseBoolAttr,o.parseDWordAttr,o.parseQWordAttr,o.parseWordAttr,o.parseByteArrayAttr],AsfUtil.AsfUtil=o,AsfUtil}var hasRequiredAsfObject;function requireAsfObject(){return hasRequiredAsfObject||(hasRequiredAsfObject=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WmPictureToken=e.MetadataLibraryObjectState=e.MetadataObjectState=e.ExtendedStreamPropertiesObjectState=e.ExtendedContentDescriptionObjectState=e.ContentDescriptionObjectState=e.readCodecEntries=e.HeaderExtensionObject=e.StreamPropertiesObject=e.FilePropertiesObject=e.IgnoreObjectState=e.State=e.HeaderObjectToken=e.TopLevelHeaderObjectToken=e.DataType=void 0;const r=requireUtil$1(),o=requireLib$2(),t=requireGUID(),c=requireAsfUtil(),h=requireID3v2Token();(function(A){A[A.UnicodeString=0]="UnicodeString",A[A.ByteArray=1]="ByteArray",A[A.Bool=2]="Bool",A[A.DWord=3]="DWord",A[A.QWord=4]="QWord",A[A.Word=5]="Word"})(e.DataType||(e.DataType={})),e.TopLevelHeaderObjectToken={len:30,get:(A,w)=>({objectId:t.default.fromBin(new o.BufferType(16).get(A,w)),objectSize:Number(o.UINT64_LE.get(A,w+16)),numberOfHeaderObjects:o.UINT32_LE.get(A,w+24)})},e.HeaderObjectToken={len:24,get:(A,w)=>({objectId:t.default.fromBin(new o.BufferType(16).get(A,w)),objectSize:Number(o.UINT64_LE.get(A,w+16))})};class l{constructor(w){this.len=Number(w.objectSize)-e.HeaderObjectToken.len}postProcessTag(w,S,j,M){if(S==="WM/Picture")w.push({id:S,value:P.fromBuffer(M)});else{const q=c.AsfUtil.getParserForAttr(j);if(!q)throw new Error("unexpected value headerType: "+j);w.push({id:S,value:q(M)})}}}e.State=l;class i extends l{constructor(w){super(w)}get(w,S){return null}}e.IgnoreObjectState=i;class p extends l{constructor(w){super(w)}get(w,S){return{fileId:t.default.fromBin(w,S),fileSize:o.UINT64_LE.get(w,S+16),creationDate:o.UINT64_LE.get(w,S+24),dataPacketsCount:o.UINT64_LE.get(w,S+32),playDuration:o.UINT64_LE.get(w,S+40),sendDuration:o.UINT64_LE.get(w,S+48),preroll:o.UINT64_LE.get(w,S+56),flags:{broadcast:r.getBit(w,S+64,24),seekable:r.getBit(w,S+64,25)},minimumDataPacketSize:o.UINT32_LE.get(w,S+68),maximumDataPacketSize:o.UINT32_LE.get(w,S+72),maximumBitrate:o.UINT32_LE.get(w,S+76)}}}p.guid=t.default.FilePropertiesObject,e.FilePropertiesObject=p;class s extends l{constructor(w){super(w)}get(w,S){return{streamType:t.default.decodeMediaType(t.default.fromBin(w,S)),errorCorrectionType:t.default.fromBin(w,S+8)}}}s.guid=t.default.StreamPropertiesObject,e.StreamPropertiesObject=s;class d{constructor(){this.len=22}get(w,S){return{reserved1:t.default.fromBin(w,S),reserved2:w.readUInt16LE(S+16),extensionDataSize:w.readUInt32LE(S+18)}}}d.guid=t.default.HeaderExtensionObject,e.HeaderExtensionObject=d;const m={len:20,get:(A,w)=>({entryCount:A.readUInt16LE(w+16)})};async function u(A){const w=await A.readNumber(o.UINT16_LE);return(await A.readToken(new o.StringType(w*2,"utf16le"))).replace("\0","")}async function a(A){const w=await A.readToken(m),S=[];for(let j=0;j<w.entryCount;++j)S.push(await b(A));return S}e.readCodecEntries=a;async function g(A){const w=await A.readNumber(o.UINT16_LE),S=Buffer.alloc(w);return await A.readBuffer(S),S}async function b(A){const w=await A.readNumber(o.UINT16_LE);return{type:{videoCodec:(w&1)===1,audioCodec:(w&2)===2},codecName:await u(A),description:await u(A),information:await g(A)}}class y extends l{constructor(w){super(w)}get(w,S){const j=[];let M=S+10;for(let q=0;q<y.contentDescTags.length;++q){const U=w.readUInt16LE(S+q*2);if(U>0){const O=y.contentDescTags[q],te=M+U;j.push({id:O,value:c.AsfUtil.parseUnicodeAttr(w.slice(M,te))}),M=te}}return j}}y.guid=t.default.ContentDescriptionObject,y.contentDescTags=["Title","Author","Copyright","Description","Rating"],e.ContentDescriptionObjectState=y;class T extends l{constructor(w){super(w)}get(w,S){const j=[],M=w.readUInt16LE(S);let q=S+2;for(let U=0;U<M;U+=1){const O=w.readUInt16LE(q);q+=2;const te=c.AsfUtil.parseUnicodeAttr(w.slice(q,q+O));q+=O;const se=w.readUInt16LE(q);q+=2;const oe=w.readUInt16LE(q);q+=2;const me=w.slice(q,q+oe);q+=oe,this.postProcessTag(j,te,se,me)}return j}}T.guid=t.default.ExtendedContentDescriptionObject,e.ExtendedContentDescriptionObjectState=T;class E extends l{constructor(w){super(w)}get(w,S){return{startTime:o.UINT64_LE.get(w,S),endTime:o.UINT64_LE.get(w,S+8),dataBitrate:w.readInt32LE(S+12),bufferSize:w.readInt32LE(S+16),initialBufferFullness:w.readInt32LE(S+20),alternateDataBitrate:w.readInt32LE(S+24),alternateBufferSize:w.readInt32LE(S+28),alternateInitialBufferFullness:w.readInt32LE(S+32),maximumObjectSize:w.readInt32LE(S+36),flags:{reliableFlag:r.getBit(w,S+40,0),seekableFlag:r.getBit(w,S+40,1),resendLiveCleanpointsFlag:r.getBit(w,S+40,2)},streamNumber:w.readInt16LE(S+42),streamLanguageId:w.readInt16LE(S+44),averageTimePerFrame:w.readInt32LE(S+52),streamNameCount:w.readInt32LE(S+54),payloadExtensionSystems:w.readInt32LE(S+56),streamNames:[],streamPropertiesObject:null}}}E.guid=t.default.ExtendedStreamPropertiesObject,e.ExtendedStreamPropertiesObjectState=E;class x extends l{constructor(w){super(w)}get(w,S){const j=[],M=Buffer.from(w),q=M.readUInt16LE(S);let U=S+2;for(let O=0;O<q;O+=1){U+=4;const te=M.readUInt16LE(U);U+=2;const se=M.readUInt16LE(U);U+=2;const oe=M.readUInt32LE(U);U+=4;const me=c.AsfUtil.parseUnicodeAttr(M.slice(U,U+te));U+=te;const $=M.slice(U,U+oe);U+=oe,this.postProcessTag(j,me,se,$)}return j}}x.guid=t.default.MetadataObject,e.MetadataObjectState=x;class R extends x{constructor(w){super(w)}}R.guid=t.default.MetadataLibraryObject,e.MetadataLibraryObjectState=R;class P{static fromBase64(w){return this.fromBuffer(Buffer.from(w,"base64"))}static fromBuffer(w){return new P(w.length).get(w,0)}constructor(w){this.len=w}get(w,S){const j=w.readUInt8(S++),M=w.readInt32LE(S);let q=5;for(;w.readUInt16BE(q)!==0;)q+=2;const U=w.slice(5,q).toString("utf16le");for(;w.readUInt16BE(q)!==0;)q+=2;const O=w.slice(5,q).toString("utf16le");return{type:h.AttachedPictureType[j],format:U,description:O,size:M,data:w.slice(q+4)}}}e.WmPictureToken=P})(AsfObject)),AsfObject}var hasRequiredAsfParser;function requireAsfParser(){if(hasRequiredAsfParser)return AsfParser;hasRequiredAsfParser=1,Object.defineProperty(AsfParser,"__esModule",{value:!0}),AsfParser.AsfParser=void 0;const e=requireBrowser$3(),r=requireType(),o=requireGUID(),t=requireAsfObject(),c=requireBasicParser(),h=(0,e.default)("music-metadata:parser:ASF"),l="asf";let i=class extends c.BasicParser{async parse(){const s=await this.tokenizer.readToken(t.TopLevelHeaderObjectToken);if(!s.objectId.equals(o.default.HeaderObject))throw new Error("expected asf header; but was not found; got: "+s.objectId.str);try{await this.parseObjectHeader(s.numberOfHeaderObjects)}catch(d){h("Error while parsing ASF: %s",d)}}async parseObjectHeader(s){let d;do{const m=await this.tokenizer.readToken(t.HeaderObjectToken);switch(h("header GUID=%s",m.objectId.str),m.objectId.str){case t.FilePropertiesObject.guid.str:const u=await this.tokenizer.readToken(new t.FilePropertiesObject(m));this.metadata.setFormat("duration",Number(u.playDuration/BigInt(1e3))/1e4-Number(u.preroll)/1e3),this.metadata.setFormat("bitrate",u.maximumBitrate);break;case t.StreamPropertiesObject.guid.str:const a=await this.tokenizer.readToken(new t.StreamPropertiesObject(m));this.metadata.setFormat("container","ASF/"+a.streamType);break;case t.HeaderExtensionObject.guid.str:const g=await this.tokenizer.readToken(new t.HeaderExtensionObject);await this.parseExtensionObject(g.extensionDataSize);break;case t.ContentDescriptionObjectState.guid.str:d=await this.tokenizer.readToken(new t.ContentDescriptionObjectState(m)),this.addTags(d);break;case t.ExtendedContentDescriptionObjectState.guid.str:d=await this.tokenizer.readToken(new t.ExtendedContentDescriptionObjectState(m)),this.addTags(d);break;case o.default.CodecListObject.str:const b=await t.readCodecEntries(this.tokenizer);b.forEach(T=>{this.metadata.addStreamInfo({type:T.type.videoCodec?r.TrackType.video:r.TrackType.audio,codecName:T.codecName})});const y=b.filter(T=>T.type.audioCodec).map(T=>T.codecName).join("/");this.metadata.setFormat("codec",y);break;case o.default.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(m.objectSize-t.HeaderObjectToken.len);break;case o.default.PaddingObject.str:h("Padding: %s bytes",m.objectSize-t.HeaderObjectToken.len),await this.tokenizer.ignore(m.objectSize-t.HeaderObjectToken.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+m.objectId.str),h("Ignore ASF-Object-GUID: %s",m.objectId.str),await this.tokenizer.readToken(new t.IgnoreObjectState(m))}}while(--s)}addTags(s){s.forEach(d=>{this.metadata.addTag(l,d.id,d.value)})}async parseExtensionObject(s){do{const d=await this.tokenizer.readToken(t.HeaderObjectToken),m=d.objectSize-t.HeaderObjectToken.len;switch(d.objectId.str){case t.ExtendedStreamPropertiesObjectState.guid.str:await this.tokenizer.readToken(new t.ExtendedStreamPropertiesObjectState(d));break;case t.MetadataObjectState.guid.str:const u=await this.tokenizer.readToken(new t.MetadataObjectState(d));this.addTags(u);break;case t.MetadataLibraryObjectState.guid.str:const a=await this.tokenizer.readToken(new t.MetadataLibraryObjectState(d));this.addTags(a);break;case o.default.PaddingObject.str:await this.tokenizer.ignore(m);break;case o.default.CompatibilityObject.str:this.tokenizer.ignore(m);break;case o.default.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(m);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+d.objectId.str),await this.tokenizer.readToken(new t.IgnoreObjectState(d));break}s-=d.objectSize}while(s>0)}};return AsfParser.AsfParser=i,AsfParser}var FlacParser={},Vorbis={},hasRequiredVorbis;function requireVorbis(){if(hasRequiredVorbis)return Vorbis;hasRequiredVorbis=1,Object.defineProperty(Vorbis,"__esModule",{value:!0}),Vorbis.IdentificationHeader=Vorbis.CommonHeader=Vorbis.VorbisPictureToken=void 0;const e=requireLib$2(),r=requireID3v2Token();class o{static fromBase64(c){return this.fromBuffer(Buffer.from(c,"base64"))}static fromBuffer(c){return new o(c.length).get(c,0)}constructor(c){this.len=c}get(c,h){const l=r.AttachedPictureType[e.UINT32_BE.get(c,h)],i=e.UINT32_BE.get(c,h+=4),p=c.toString("utf-8",h+=4,h+i),s=e.UINT32_BE.get(c,h+=i),d=c.toString("utf-8",h+=4,h+s),m=e.UINT32_BE.get(c,h+=s),u=e.UINT32_BE.get(c,h+=4),a=e.UINT32_BE.get(c,h+=4),g=e.UINT32_BE.get(c,h+=4),b=e.UINT32_BE.get(c,h+=4),y=Buffer.from(c.slice(h+=4,h+b));return{type:l,format:p,description:d,width:m,height:u,colour_depth:a,indexed_color:g,data:y}}}return Vorbis.VorbisPictureToken=o,Vorbis.CommonHeader={len:7,get:(t,c)=>({packetType:t.readUInt8(c),vorbis:new e.StringType(6,"ascii").get(t,c+1)})},Vorbis.IdentificationHeader={len:23,get:(t,c)=>{const h=new DataView(t.buffer,t.byteOffset);return{version:h.getUint32(c+0,!0),channelMode:h.getUint8(c+4),sampleRate:h.getUint32(c+5,!0),bitrateMax:h.getUint32(c+9,!0),bitrateNominal:h.getUint32(c+13,!0),bitrateMin:h.getUint32(c+17,!0)}}},Vorbis}var AbstractID3Parser={},hasRequiredAbstractID3Parser;function requireAbstractID3Parser(){if(hasRequiredAbstractID3Parser)return AbstractID3Parser;hasRequiredAbstractID3Parser=1,Object.defineProperty(AbstractID3Parser,"__esModule",{value:!0}),AbstractID3Parser.AbstractID3Parser=void 0;const e=requireCore$2(),r=requireBrowser$3(),o=requireID3v2Token(),t=requireID3v2Parser(),c=requireID3v1Parser(),h=requireBasicParser(),l=(0,r.default)("music-metadata:parser:ID3");let i=class extends h.BasicParser{constructor(){super(...arguments),this.id3parser=new t.ID3v2Parser}static async startsWithID3v2Header(s){return(await s.peekToken(o.ID3v2Header)).fileIdentifier==="ID3"}async parse(){try{await this.parseID3v2()}catch(s){if(s instanceof e.EndOfStreamError)l("End-of-stream");else throw s}}finalize(){}async parseID3v2(){await this.tryReadId3v2Headers(),l("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny()?this.finalize():(await new c.ID3v1Parser().init(this.metadata,this.tokenizer,this.options).parse(),this.finalize())}async tryReadId3v2Headers(){if((await this.tokenizer.peekToken(o.ID3v2Header)).fileIdentifier==="ID3")return l("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}};return AbstractID3Parser.AbstractID3Parser=i,AbstractID3Parser}var VorbisParser={},VorbisDecoder={},hasRequiredVorbisDecoder;function requireVorbisDecoder(){if(hasRequiredVorbisDecoder)return VorbisDecoder;hasRequiredVorbisDecoder=1,Object.defineProperty(VorbisDecoder,"__esModule",{value:!0}),VorbisDecoder.VorbisDecoder=void 0;const e=requireLib$2();let r=class{constructor(t,c){this.data=t,this.offset=c}readInt32(){const t=e.UINT32_LE.get(this.data,this.offset);return this.offset+=4,t}readStringUtf8(){const t=this.readInt32(),c=Buffer.from(this.data).toString("utf-8",this.offset,this.offset+t);return this.offset+=t,c}parseUserComment(){const t=this.offset,c=this.readStringUtf8(),h=c.indexOf("=");return{key:c.slice(0,h).toUpperCase(),value:c.slice(h+1),len:this.offset-t}}};return VorbisDecoder.VorbisDecoder=r,VorbisDecoder}var hasRequiredVorbisParser;function requireVorbisParser(){if(hasRequiredVorbisParser)return VorbisParser;hasRequiredVorbisParser=1,Object.defineProperty(VorbisParser,"__esModule",{value:!0}),VorbisParser.VorbisParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireVorbisDecoder(),t=requireVorbis(),c=(0,r.default)("music-metadata:parser:ogg:vorbis1");let h=class{constructor(i,p){this.metadata=i,this.options=p,this.pageSegments=[]}parsePage(i,p){if(i.headerType.firstPage)this.parseFirstPage(i,p);else{if(i.headerType.continued){if(this.pageSegments.length===0)throw new Error("Cannot continue on previous page");this.pageSegments.push(p)}if(i.headerType.lastPage||!i.headerType.continued){if(this.pageSegments.length>0){const s=Buffer.concat(this.pageSegments);this.parseFullPage(s)}this.pageSegments=i.headerType.lastPage?[]:[p]}}i.headerType.lastPage&&this.calculateDuration(i)}flush(){this.parseFullPage(Buffer.concat(this.pageSegments))}parseUserComment(i,p){const d=new o.VorbisDecoder(i,p).parseUserComment();return this.addTag(d.key,d.value),d.len}addTag(i,p){if(i==="METADATA_BLOCK_PICTURE"&&typeof p=="string"){if(this.options.skipCovers){c("Ignore picture");return}p=t.VorbisPictureToken.fromBase64(p),c(`Push picture: id=${i}, format=${p.format}`)}else c(`Push tag: id=${i}, value=${p}`);this.metadata.addTag("vorbis",i,p)}calculateDuration(i){this.metadata.format.sampleRate&&i.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",i.absoluteGranulePosition),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate))}parseFirstPage(i,p){this.metadata.setFormat("codec","Vorbis I"),c("Parse first page");const s=t.CommonHeader.get(p,0);if(s.vorbis!=="vorbis")throw new Error("Metadata does not look like Vorbis");if(s.packetType===1){const d=t.IdentificationHeader.get(p,t.CommonHeader.len);this.metadata.setFormat("sampleRate",d.sampleRate),this.metadata.setFormat("bitrate",d.bitrateNominal),this.metadata.setFormat("numberOfChannels",d.channelMode),c("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",d.sampleRate,d.bitrateNominal,d.channelMode)}else throw new Error("First Ogg page should be type 1: the identification header")}parseFullPage(i){const p=t.CommonHeader.get(i,0);switch(c("Parse full page: type=%s, byteLength=%s",p.packetType,i.byteLength),p.packetType){case 3:return this.parseUserCommentList(i,t.CommonHeader.len)}}parseUserCommentList(i,p){const s=e.UINT32_LE.get(i,p);p+=4,p+=s;let d=e.UINT32_LE.get(i,p);for(p+=4;d-- >0;)p+=this.parseUserComment(i,p)}};return VorbisParser.VorbisParser=h,VorbisParser}var hasRequiredFlacParser;function requireFlacParser(){if(hasRequiredFlacParser)return FlacParser;hasRequiredFlacParser=1,Object.defineProperty(FlacParser,"__esModule",{value:!0}),FlacParser.FlacParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireUtil$1(),t=requireVorbis(),c=requireAbstractID3Parser(),h=requireFourCC(),l=requireVorbisParser(),i=requireVorbisDecoder(),p=(0,r.default)("music-metadata:parser:FLAC");var s;(function(u){u[u.STREAMINFO=0]="STREAMINFO",u[u.PADDING=1]="PADDING",u[u.APPLICATION=2]="APPLICATION",u[u.SEEKTABLE=3]="SEEKTABLE",u[u.VORBIS_COMMENT=4]="VORBIS_COMMENT",u[u.CUESHEET=5]="CUESHEET",u[u.PICTURE=6]="PICTURE"})(s||(s={}));let d=class extends c.AbstractID3Parser{constructor(){super(...arguments),this.padding=0}init(a,g,b){return super.init(a,g,b),this.vorbisParser=new l.VorbisParser(a,b),this}async postId3v2Parse(){if((await this.tokenizer.readToken(h.FourCcToken)).toString()!=="fLaC")throw new Error("Invalid FLAC preamble");let g;do g=await this.tokenizer.readToken(m.BlockHeader),await this.parseDataBlock(g);while(!g.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const b=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*b/this.metadata.format.duration)}}parseDataBlock(a){switch(p(`blockHeader type=${a.type}, length=${a.length}`),a.type){case s.STREAMINFO:return this.parseBlockStreamInfo(a.length);case s.PADDING:this.padding+=a.length;break;case s.APPLICATION:break;case s.SEEKTABLE:break;case s.VORBIS_COMMENT:return this.parseComment(a.length);case s.CUESHEET:break;case s.PICTURE:return this.parsePicture(a.length).then();default:this.metadata.addWarning("Unknown block type: "+a.type)}return this.tokenizer.ignore(a.length).then()}async parseBlockStreamInfo(a){if(a!==m.BlockStreamInfo.len)throw new Error("Unexpected block-stream-info length");const g=await this.tokenizer.readToken(m.BlockStreamInfo);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",g.channels),this.metadata.setFormat("bitsPerSample",g.bitsPerSample),this.metadata.setFormat("sampleRate",g.sampleRate),g.totalSamples>0&&this.metadata.setFormat("duration",g.totalSamples/g.sampleRate)}async parseComment(a){const g=await this.tokenizer.readToken(new e.Uint8ArrayType(a)),b=new i.VorbisDecoder(g,0);b.readStringUtf8();const y=b.readInt32();for(let T=0;T<y;T++){const E=b.parseUserComment();this.vorbisParser.addTag(E.key,E.value)}}async parsePicture(a){if(this.options.skipCovers)return this.tokenizer.ignore(a);{const g=await this.tokenizer.readToken(new t.VorbisPictureToken(a));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",g)}}};FlacParser.FlacParser=d;class m{}return m.BlockHeader={len:4,get:(u,a)=>({lastBlock:o.getBit(u,a,7),type:o.getBitAllignedNumber(u,a,1,7),length:e.UINT24_BE.get(u,a+1)})},m.BlockStreamInfo={len:34,get:(u,a)=>({minimumBlockSize:e.UINT16_BE.get(u,a),maximumBlockSize:e.UINT16_BE.get(u,a+2)/1e3,minimumFrameSize:e.UINT24_BE.get(u,a+4),maximumFrameSize:e.UINT24_BE.get(u,a+7),sampleRate:e.UINT24_BE.get(u,a+10)>>4,channels:o.getBitAllignedNumber(u,a+12,4,3)+1,bitsPerSample:o.getBitAllignedNumber(u,a+12,7,5)+1,totalSamples:o.getBitAllignedNumber(u,a+13,4,36),fileMD5:new e.Uint8ArrayType(16).get(u,a+18)})},FlacParser}var MP4Parser={},Atom={},AtomToken={},hasRequiredAtomToken;function requireAtomToken(){return hasRequiredAtomToken||(hasRequiredAtomToken=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ChapterText=e.StcoAtom=e.StszAtom=e.StscAtom=e.SampleToChunkToken=e.SttsAtom=e.TimeToSampleToken=e.SoundSampleDescriptionV0=e.SoundSampleDescriptionVersion=e.StsdAtom=e.TrackHeaderAtom=e.NameAtom=e.DataAtom=e.MvhdAtom=e.MdhdAtom=e.FixedLengthAtom=e.mhdr=e.tkhd=e.ftyp=e.ExtendedSize=e.Header=void 0;const r=requireLib$2(),o=requireBrowser$3(),t=requireFourCC(),c=(0,o.default)("music-metadata:parser:MP4:atom");e.Header={len:8,get:(A,w)=>{const S=r.UINT32_BE.get(A,w);if(S<0)throw new Error("Invalid atom header length");return{length:BigInt(S),name:new r.StringType(4,"binary").get(A,w+4)}},put:(A,w,S)=>(r.UINT32_BE.put(A,w,Number(S.length)),t.FourCcToken.put(A,w+4,S.name))},e.ExtendedSize=r.UINT64_BE,e.ftyp={len:4,get:(A,w)=>({type:new r.StringType(4,"ascii").get(A,w)})},e.tkhd={len:4,get:(A,w)=>({type:new r.StringType(4,"ascii").get(A,w)})},e.mhdr={len:8,get:(A,w)=>({version:r.UINT8.get(A,w),flags:r.UINT24_BE.get(A,w+1),nextItemID:r.UINT32_BE.get(A,w+4)})};class h{constructor(w,S,j){if(this.len=w,w<S)throw new Error(`Atom ${j} expected to be ${S}, but specifies ${w} bytes long.`);w>S&&c(`Warning: atom ${j} expected to be ${S}, but was actually ${w} bytes long.`)}}e.FixedLengthAtom=h;const l={len:4,get:(A,w)=>{const S=r.UINT32_BE.get(A,w)-2082844800;return new Date(S*1e3)}};class i extends h{constructor(w){super(w,24,"mdhd"),this.len=w}get(w,S){return{version:r.UINT8.get(w,S+0),flags:r.UINT24_BE.get(w,S+1),creationTime:l.get(w,S+4),modificationTime:l.get(w,S+8),timeScale:r.UINT32_BE.get(w,S+12),duration:r.UINT32_BE.get(w,S+16),language:r.UINT16_BE.get(w,S+20),quality:r.UINT16_BE.get(w,S+22)}}}e.MdhdAtom=i;class p extends h{constructor(w){super(w,100,"mvhd"),this.len=w}get(w,S){return{version:r.UINT8.get(w,S),flags:r.UINT24_BE.get(w,S+1),creationTime:l.get(w,S+4),modificationTime:l.get(w,S+8),timeScale:r.UINT32_BE.get(w,S+12),duration:r.UINT32_BE.get(w,S+16),preferredRate:r.UINT32_BE.get(w,S+20),preferredVolume:r.UINT16_BE.get(w,S+24),previewTime:r.UINT32_BE.get(w,S+72),previewDuration:r.UINT32_BE.get(w,S+76),posterTime:r.UINT32_BE.get(w,S+80),selectionTime:r.UINT32_BE.get(w,S+84),selectionDuration:r.UINT32_BE.get(w,S+88),currentTime:r.UINT32_BE.get(w,S+92),nextTrackID:r.UINT32_BE.get(w,S+96)}}}e.MvhdAtom=p;class s{constructor(w){this.len=w}get(w,S){return{type:{set:r.UINT8.get(w,S+0),type:r.UINT24_BE.get(w,S+1)},locale:r.UINT24_BE.get(w,S+4),value:Buffer.from(new r.Uint8ArrayType(this.len-8).get(w,S+8))}}}e.DataAtom=s;class d{constructor(w){this.len=w}get(w,S){return{version:r.UINT8.get(w,S),flags:r.UINT24_BE.get(w,S+1),name:new r.StringType(this.len-4,"utf-8").get(w,S+4)}}}e.NameAtom=d;class m{constructor(w){this.len=w}get(w,S){return{version:r.UINT8.get(w,S),flags:r.UINT24_BE.get(w,S+1),creationTime:l.get(w,S+4),modificationTime:l.get(w,S+8),trackId:r.UINT32_BE.get(w,S+12),duration:r.UINT32_BE.get(w,S+20),layer:r.UINT16_BE.get(w,S+24),alternateGroup:r.UINT16_BE.get(w,S+26),volume:r.UINT16_BE.get(w,S+28)}}}e.TrackHeaderAtom=m;const u={len:8,get:(A,w)=>({version:r.UINT8.get(A,w),flags:r.UINT24_BE.get(A,w+1),numberOfEntries:r.UINT32_BE.get(A,w+4)})};class a{constructor(w){this.len=w}get(w,S){return{dataFormat:t.FourCcToken.get(w,S),dataReferenceIndex:r.UINT16_BE.get(w,S+10),description:new r.Uint8ArrayType(this.len-12).get(w,S+12)}}}class g{constructor(w){this.len=w}get(w,S){const j=u.get(w,S);S+=u.len;const M=[];for(let q=0;q<j.numberOfEntries;++q){const U=r.UINT32_BE.get(w,S);S+=r.UINT32_BE.len,M.push(new a(U).get(w,S)),S+=U}return{header:j,table:M}}}e.StsdAtom=g,e.SoundSampleDescriptionVersion={len:8,get(A,w){return{version:r.INT16_BE.get(A,w),revision:r.INT16_BE.get(A,w+2),vendor:r.INT32_BE.get(A,w+4)}}},e.SoundSampleDescriptionV0={len:12,get(A,w){return{numAudioChannels:r.INT16_BE.get(A,w+0),sampleSize:r.INT16_BE.get(A,w+2),compressionId:r.INT16_BE.get(A,w+4),packetSize:r.INT16_BE.get(A,w+6),sampleRate:r.UINT16_BE.get(A,w+8)+r.UINT16_BE.get(A,w+10)/1e4}}};class b{constructor(w,S){this.len=w,this.token=S}get(w,S){const j=r.INT32_BE.get(w,S+4);return{version:r.INT8.get(w,S+0),flags:r.INT24_BE.get(w,S+1),numberOfEntries:j,entries:P(w,this.token,S+8,this.len-8,j)}}}e.TimeToSampleToken={len:8,get(A,w){return{count:r.INT32_BE.get(A,w+0),duration:r.INT32_BE.get(A,w+4)}}};class y extends b{constructor(w){super(w,e.TimeToSampleToken),this.len=w}}e.SttsAtom=y,e.SampleToChunkToken={len:12,get(A,w){return{firstChunk:r.INT32_BE.get(A,w),samplesPerChunk:r.INT32_BE.get(A,w+4),sampleDescriptionId:r.INT32_BE.get(A,w+8)}}};class T extends b{constructor(w){super(w,e.SampleToChunkToken),this.len=w}}e.StscAtom=T;class E{constructor(w){this.len=w}get(w,S){const j=r.INT32_BE.get(w,S+8);return{version:r.INT8.get(w,S),flags:r.INT24_BE.get(w,S+1),sampleSize:r.INT32_BE.get(w,S+4),numberOfEntries:j,entries:P(w,r.INT32_BE,S+12,this.len-12,j)}}}e.StszAtom=E;class x extends b{constructor(w){super(w,r.INT32_BE),this.len=w}}e.StcoAtom=x;class R{constructor(w){this.len=w}get(w,S){const j=r.INT16_BE.get(w,S+0);return new r.StringType(j,"utf-8").get(w,S+2)}}e.ChapterText=R;function P(A,w,S,j,M){if(c(`remainingLen=${j}, numberOfEntries=${M} * token-len=${w.len}`),j===0)return[];if(j!==M*w.len)throw new Error("mismatch number-of-entries with remaining atom-length");const q=[];for(let U=0;U<M;++U)q.push(w.get(A,S)),S+=w.len;return q}})(AtomToken)),AtomToken}var hasRequiredAtom;function requireAtom(){if(hasRequiredAtom)return Atom;hasRequiredAtom=1,Object.defineProperty(Atom,"__esModule",{value:!0}),Atom.Atom=void 0;const e=requireBrowser$3(),r=requireAtomToken(),o=(0,e.default)("music-metadata:parser:MP4:Atom");let t=class He{static async readAtom(h,l,i,p){const s=h.position,d=await h.readToken(r.Header);d.length===BigInt(1)&&(d.length=await h.readToken(r.ExtendedSize));const u=new He(d,d.length===BigInt(1),i),a=u.getPayloadLength(p);return o(`parse atom name=${u.atomPath}, extended=${u.extended}, offset=${s}, len=${u.header.length}`),await u.readData(h,l,a),u}constructor(h,l,i){this.header=h,this.extended=l,this.parent=i,this.children=[],this.atomPath=(this.parent?this.parent.atomPath+".":"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(h){return(this.header.length===BigInt(0)?h:Number(this.header.length))-this.getHeaderLength()}async readAtoms(h,l,i){for(;i>0;){const p=await He.readAtom(h,l,this,i);this.children.push(p),i-=p.header.length===BigInt(0)?i:Number(p.header.length)}}async readData(h,l,i){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(h,l,this.getPayloadLength(i));case"meta":const s=(await h.peekToken(r.Header)).name==="hdlr"?0:4;return await h.ignore(s),this.readAtoms(h,l,this.getPayloadLength(i)-s);case"mdhd":case"mvhd":case"tkhd":case"stsz":case"mdat":default:return l(this,i)}}};return Atom.Atom=t,Atom}var hasRequiredMP4Parser;function requireMP4Parser(){if(hasRequiredMP4Parser)return MP4Parser;hasRequiredMP4Parser=1,Object.defineProperty(MP4Parser,"__esModule",{value:!0}),MP4Parser.MP4Parser=void 0;const e=requireBrowser$3(),r=requireLib$2(),o=requireBasicParser(),t=requireID3v1Parser(),c=requireType(),h=requireAtom(),l=requireAtomToken(),i=(0,e.default)("music-metadata:parser:MP4"),p="iTunes",s={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function d(u,a,g){return g.indexOf(u)===a}let m=class Ge extends o.BasicParser{constructor(){super(...arguments),this.atomParsers={mvhd:async a=>{const g=await this.tokenizer.readToken(new l.MvhdAtom(a));this.metadata.setFormat("creationTime",g.creationTime),this.metadata.setFormat("modificationTime",g.modificationTime)},mdhd:async a=>{const g=await this.tokenizer.readToken(new l.MdhdAtom(a)),b=this.getTrackDescription();b.creationTime=g.creationTime,b.modificationTime=g.modificationTime,b.timeScale=g.timeScale,b.duration=g.duration},chap:async a=>{const g=this.getTrackDescription(),b=[];for(;a>=r.UINT32_BE.len;)b.push(await this.tokenizer.readNumber(r.UINT32_BE)),a-=r.UINT32_BE.len;g.chapterList=b},tkhd:async a=>{const g=await this.tokenizer.readToken(new l.TrackHeaderAtom(a));this.tracks.push(g)},mdat:async a=>{if(this.audioLengthInBytes=a,this.calculateBitRate(),this.options.includeChapters){const g=this.tracks.filter(b=>b.chapterList);if(g.length===1){const b=g[0].chapterList,y=this.tracks.filter(T=>b.indexOf(T.trackId)!==-1);if(y.length===1)return this.parseChapterTrack(y[0],g[0],a)}}await this.tokenizer.ignore(a)},ftyp:async a=>{const g=[];for(;a>0;){const y=await this.tokenizer.readToken(l.ftyp);a-=l.ftyp.len;const T=y.type.replace(/\W/g,"");T.length>0&&g.push(T)}i(`ftyp: ${g.join("/")}`);const b=g.filter(d).join("/");this.metadata.setFormat("container",b)},stsd:async a=>{const g=await this.tokenizer.readToken(new l.StsdAtom(a)),b=this.getTrackDescription();b.soundSampleDescription=g.table.map(y=>this.parseSoundSampleDescription(y))},stsc:async a=>{const g=await this.tokenizer.readToken(new l.StscAtom(a));this.getTrackDescription().sampleToChunkTable=g.entries},stts:async a=>{const g=await this.tokenizer.readToken(new l.SttsAtom(a));this.getTrackDescription().timeToSampleTable=g.entries},stsz:async a=>{const g=await this.tokenizer.readToken(new l.StszAtom(a)),b=this.getTrackDescription();b.sampleSize=g.sampleSize,b.sampleSizeTable=g.entries},stco:async a=>{const g=await this.tokenizer.readToken(new l.StcoAtom(a));this.getTrackDescription().chunkOffsetTable=g.entries},date:async a=>{const g=await this.tokenizer.readToken(new r.StringType(a,"utf-8"));this.addTag("date",g)}}}static read_BE_Integer(a,g){const b=(g?"INT":"UINT")+a.length*8+(a.length>1?"_BE":""),y=r[b];if(!y)throw new Error('Token for integer type not found: "'+b+'"');return Number(y.get(a,0))}async parse(){this.tracks=[];let a=this.tokenizer.fileInfo.size;for(;!this.tokenizer.fileInfo.size||a>0;){try{if((await this.tokenizer.peekToken(l.Header)).name==="\0\0\0\0"){const E=`Error at offset=${this.tokenizer.position}: box.id=0`;i(E),this.addWarning(E);break}}catch(T){const E=`Error at offset=${this.tokenizer.position}: ${T.message}`;i(E),this.addWarning(E);break}const y=await h.Atom.readAtom(this.tokenizer,(T,E)=>this.handleAtom(T,E),null,a);a-=y.header.length===BigInt(0)?a:Number(y.header.length)}const g=[];this.tracks.forEach(y=>{const T=[];y.soundSampleDescription.forEach(E=>{const x={},R=s[E.dataFormat];if(R?(T.push(R.format),x.codecName=R.format):x.codecName=`<${E.dataFormat}>`,E.description){const{description:P}=E;P.sampleRate>0&&(x.type=c.TrackType.audio,x.audio={samplingFrequency:P.sampleRate,bitDepth:P.sampleSize,channels:P.numAudioChannels})}this.metadata.addStreamInfo(x)}),T.length>=1&&g.push(T.join("/"))}),g.length>0&&this.metadata.setFormat("codec",g.filter(d).join("+"));const b=this.tracks.filter(y=>y.soundSampleDescription.length>=1&&y.soundSampleDescription[0].description&&y.soundSampleDescription[0].description.numAudioChannels>0);if(b.length>=1){const y=b[0];if(y.timeScale>0){const x=y.duration/y.timeScale;this.metadata.setFormat("duration",x)}const T=y.soundSampleDescription[0];if(T.description&&(this.metadata.setFormat("sampleRate",T.description.sampleRate),this.metadata.setFormat("bitsPerSample",T.description.sampleSize),this.metadata.setFormat("numberOfChannels",T.description.numAudioChannels),y.timeScale===0&&y.timeToSampleTable.length>0)){const R=y.timeToSampleTable.map(P=>P.count*P.duration).reduce((P,A)=>P+A)/T.description.sampleRate;this.metadata.setFormat("duration",R)}const E=s[T.dataFormat];E&&this.metadata.setFormat("lossless",!E.lossy),this.calculateBitRate()}}async handleAtom(a,g){if(a.parent)switch(a.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(a)}if(this.atomParsers[a.header.name])return this.atomParsers[a.header.name](g);i(`No parser for atom path=${a.atomPath}, payload-len=${g}, ignoring atom`),await this.tokenizer.ignore(g)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}addTag(a,g){this.metadata.addTag(p,a,g)}addWarning(a){i("Warning: "+a),this.metadata.addWarning(a)}parseMetadataItemData(a){let g=a.header.name;return a.readAtoms(this.tokenizer,async(b,y)=>{const T=b.getPayloadLength(y);switch(b.header.name){case"data":return this.parseValueAtom(g,b);case"name":case"mean":case"rate":const E=await this.tokenizer.readToken(new l.NameAtom(T));g+=":"+E.name;break;default:const x=await this.tokenizer.readToken(new r.BufferType(T));this.addWarning("Unsupported meta-item: "+g+"["+b.header.name+"] => value="+x.toString("hex")+" ascii="+x.toString("ascii"))}},a.getPayloadLength(0))}async parseValueAtom(a,g){const b=await this.tokenizer.readToken(new l.DataAtom(Number(g.header.length)-l.Header.len));if(b.type.set!==0)throw new Error("Unsupported type-set != 0: "+b.type.set);switch(b.type.type){case 0:switch(a){case"trkn":case"disk":const y=r.UINT8.get(b.value,3),T=r.UINT8.get(b.value,5);this.addTag(a,y+"/"+T);break;case"gnre":const E=r.UINT8.get(b.value,1),x=t.Genres[E-1];this.addTag(a,x);break;case"rate":const R=b.value.toString("ascii");this.addTag(a,R);break;default:i("unknown proprietary value type for: "+g.atomPath)}break;case 1:case 18:this.addTag(a,b.value.toString("utf-8"));break;case 13:if(this.options.skipCovers)break;this.addTag(a,{format:"image/jpeg",data:Buffer.from(b.value)});break;case 14:if(this.options.skipCovers)break;this.addTag(a,{format:"image/png",data:Buffer.from(b.value)});break;case 21:this.addTag(a,Ge.read_BE_Integer(b.value,!0));break;case 22:this.addTag(a,Ge.read_BE_Integer(b.value,!1));break;case 65:this.addTag(a,b.value.readInt8(0));break;case 66:this.addTag(a,b.value.readInt16BE(0));break;case 67:this.addTag(a,b.value.readInt32BE(0));break;default:this.addWarning(`atom key=${a}, has unknown well-known-type (data-type): ${b.type.type}`)}}parseSoundSampleDescription(a){const g={dataFormat:a.dataFormat,dataReferenceIndex:a.dataReferenceIndex};let b=0;const y=l.SoundSampleDescriptionVersion.get(a.description,b);return b+=l.SoundSampleDescriptionVersion.len,y.version===0||y.version===1?g.description=l.SoundSampleDescriptionV0.get(a.description,b):i(`Warning: sound-sample-description ${y} not implemented`),g}async parseChapterTrack(a,g,b){if(!a.sampleSize&&a.chunkOffsetTable.length!==a.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const y=[];for(let T=0;T<a.chunkOffsetTable.length&&b>0;++T){const x=a.chunkOffsetTable[T]-this.tokenizer.position,R=a.sampleSize>0?a.sampleSize:a.sampleSizeTable[T];if(b-=x+R,b<0)throw new Error("Chapter chunk exceeding token length");await this.tokenizer.ignore(x);const P=await this.tokenizer.readToken(new l.ChapterText(R));i(`Chapter ${T+1}: ${P}`);const A={title:P,sampleOffset:this.findSampleOffset(g,this.tokenizer.position)};i(`Chapter title=${A.title}, offset=${A.sampleOffset}/${this.tracks[0].duration}`),y.push(A)}this.metadata.setFormat("chapters",y),await this.tokenizer.ignore(b)}findSampleOffset(a,g){let b=0;a.timeToSampleTable.forEach(T=>{b+=T.count*T.duration}),i(`Total duration=${b}`);let y=0;for(;y<a.chunkOffsetTable.length&&a.chunkOffsetTable[y]<g;)++y;return this.getChunkDuration(y+1,a)}getChunkDuration(a,g){let b=0,y=g.timeToSampleTable[b].count,T=g.timeToSampleTable[b].duration,E=1,x=this.getSamplesPerChunk(E,g.sampleToChunkTable),R=0;for(;E<a;){const P=Math.min(y,x);R+=P*T,y-=P,x-=P,x===0?(++E,x=this.getSamplesPerChunk(E,g.sampleToChunkTable)):(++b,y=g.timeToSampleTable[b].count,T=g.timeToSampleTable[b].duration)}return R}getSamplesPerChunk(a,g){for(let b=0;b<g.length-1;++b)if(a>=g[b].firstChunk&&a<g[b+1].firstChunk)return g[b].samplesPerChunk;return g[g.length-1].samplesPerChunk}};return MP4Parser.MP4Parser=m,MP4Parser}var MpegParser={},XingTag={},ExtendedLameHeader={},ReplayGainDataFormat={},hasRequiredReplayGainDataFormat;function requireReplayGainDataFormat(){if(hasRequiredReplayGainDataFormat)return ReplayGainDataFormat;hasRequiredReplayGainDataFormat=1,Object.defineProperty(ReplayGainDataFormat,"__esModule",{value:!0}),ReplayGainDataFormat.ReplayGain=void 0;const e=requireUtil$1();var r;(function(t){t[t.not_set=0]="not_set",t[t.radio=1]="radio",t[t.audiophile=2]="audiophile"})(r||(r={}));var o;return(function(t){t[t.unspecified=0]="unspecified",t[t.engineer=1]="engineer",t[t.user=2]="user",t[t.automatic=3]="automatic",t[t.rms_average=4]="rms_average"})(o||(o={})),ReplayGainDataFormat.ReplayGain={len:2,get:(t,c)=>{const h=e.getBitAllignedNumber(t,c,0,3),l=e.getBitAllignedNumber(t,c,6,1),i=e.getBitAllignedNumber(t,c,7,9)/10;if(h>0)return{type:e.getBitAllignedNumber(t,c,0,3),origin:e.getBitAllignedNumber(t,c,3,3),adjustment:l?-i:i}}},ReplayGainDataFormat}var hasRequiredExtendedLameHeader;function requireExtendedLameHeader(){if(hasRequiredExtendedLameHeader)return ExtendedLameHeader;hasRequiredExtendedLameHeader=1,Object.defineProperty(ExtendedLameHeader,"__esModule",{value:!0}),ExtendedLameHeader.ExtendedLameHeader=void 0;const e=requireLib$2(),r=requireUtil$1(),o=requireReplayGainDataFormat();return ExtendedLameHeader.ExtendedLameHeader={len:27,get:(t,c)=>{const h=e.UINT32_BE.get(t,c+2);return{revision:r.getBitAllignedNumber(t,c,0,4),vbr_method:r.getBitAllignedNumber(t,c,4,4),lowpass_filter:100*e.UINT8.get(t,c+1),track_peak:h===0?void 0:h/Math.pow(2,23),track_gain:o.ReplayGain.get(t,6),album_gain:o.ReplayGain.get(t,8),music_length:e.UINT32_BE.get(t,c+20),music_crc:e.UINT8.get(t,c+24),header_crc:e.UINT16_BE.get(t,c+24)}}},ExtendedLameHeader}var hasRequiredXingTag;function requireXingTag(){return hasRequiredXingTag||(hasRequiredXingTag=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.readXingHeader=e.XingHeaderFlags=e.LameEncoderVersion=e.InfoTagHeaderTag=void 0;const r=requireLib$2(),o=requireUtil$1(),t=requireExtendedLameHeader();e.InfoTagHeaderTag=new r.StringType(4,"ascii"),e.LameEncoderVersion=new r.StringType(6,"ascii"),e.XingHeaderFlags={len:4,get:(h,l)=>({frames:o.isBitSet(h,l,31),bytes:o.isBitSet(h,l,30),toc:o.isBitSet(h,l,29),vbrScale:o.isBitSet(h,l,28)})};async function c(h){const l=await h.readToken(e.XingHeaderFlags),i={};if(l.frames&&(i.numFrames=await h.readToken(r.UINT32_BE)),l.bytes&&(i.streamSize=await h.readToken(r.UINT32_BE)),l.toc&&(i.toc=Buffer.alloc(100),await h.readBuffer(i.toc)),l.vbrScale&&(i.vbrScale=await h.readToken(r.UINT32_BE)),await h.peekToken(new r.StringType(4,"ascii"))==="LAME"&&(await h.ignore(4),i.lame={version:await h.readToken(new r.StringType(5,"ascii"))},i.lame.version.match(/\d+.\d+/g))){const m=i.lame.version.match(/\d+.\d+/g)[0].split(".").map(u=>parseInt(u,10));m[0]>=3&&m[1]>=90&&(i.lame.extended=await h.readToken(t.ExtendedLameHeader))}return i}e.readXingHeader=c})(XingTag)),XingTag}var hasRequiredMpegParser;function requireMpegParser(){if(hasRequiredMpegParser)return MpegParser;hasRequiredMpegParser=1,Object.defineProperty(MpegParser,"__esModule",{value:!0}),MpegParser.MpegParser=void 0;const e=requireLib$2(),r=requireCore$2(),o=requireBrowser$3(),t=requireUtil$1(),c=requireAbstractID3Parser(),h=requireXingTag(),l=(0,o.default)("music-metadata:parser:mpeg"),i=1024,p={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,void 0,void 0,-1]},s=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class d{constructor(b,y){this.versionIndex=t.getBitAllignedNumber(b,y+1,3,2),this.layer=d.LayerDescription[t.getBitAllignedNumber(b,y+1,5,2)],this.versionIndex>1&&this.layer===0?this.parseAdtsHeader(b,y):this.parseMpegHeader(b,y),this.isProtectedByCRC=!t.isBitSet(b,y+1,7)}calcDuration(b){return b*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return d.samplesInFrameTable[this.version===1?0:1][this.layer]}calculateSideInfoLength(){if(this.layer!==3)return 2;if(this.channelModeIndex===3){if(this.version===1)return 17;if(this.version===2||this.version===2.5)return 9}else{if(this.version===1)return 32;if(this.version===2||this.version===2.5)return 17}}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(b,y){this.container="MPEG",this.bitrateIndex=t.getBitAllignedNumber(b,y+2,0,4),this.sampRateFreqIndex=t.getBitAllignedNumber(b,y+2,4,2),this.padding=t.isBitSet(b,y+2,6),this.privateBit=t.isBitSet(b,y+2,7),this.channelModeIndex=t.getBitAllignedNumber(b,y+3,0,2),this.modeExtension=t.getBitAllignedNumber(b,y+3,2,2),this.isCopyrighted=t.isBitSet(b,y+3,4),this.isOriginalMedia=t.isBitSet(b,y+3,5),this.emphasis=t.getBitAllignedNumber(b,y+3,7,2),this.version=d.VersionID[this.versionIndex],this.channelMode=d.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const T=this.calcBitrate();if(!T)throw new Error("Cannot determine bit-rate");if(this.bitrate=T*1e3,this.samplingRate=this.calcSamplingRate(),this.samplingRate==null)throw new Error("Cannot determine sampling-rate")}parseAdtsHeader(b,y){l("layer=0 => ADTS"),this.version=this.versionIndex===2?4:2,this.container="ADTS/MPEG-"+this.version;const T=t.getBitAllignedNumber(b,y+2,0,2);this.codec="AAC",this.codecProfile=p.AudioObjectTypes[T],l(`MPEG-4 audio-codec=${this.codec}`);const E=t.getBitAllignedNumber(b,y+2,2,4);this.samplingRate=p.SamplingFrequencies[E],l(`sampling-rate=${this.samplingRate}`);const x=t.getBitAllignedNumber(b,y+2,7,3);this.mp4ChannelConfig=s[x],l(`channel-config=${this.mp4ChannelConfig.join("+")}`),this.frameLength=t.getBitAllignedNumber(b,y+3,6,2)<<11}calcBitrate(){if(this.bitrateIndex===0||this.bitrateIndex===15)return;const b=`${Math.floor(this.version)}${this.layer}`;return d.bitrate_index[this.bitrateIndex][b]}calcSamplingRate(){return this.sampRateFreqIndex===3?null:d.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}d.SyncByte1=255,d.SyncByte2=224,d.VersionID=[2.5,null,2,1],d.LayerDescription=[0,3,2,1],d.ChannelMode=["stereo","joint_stereo","dual_channel","mono"],d.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}},d.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}},d.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];const m={len:4,get:(g,b)=>new d(g,b)};function u(g){return"V"+Math.floor((100-g)/10)}let a=class extends c.AbstractID3Parser{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.calculateEofDuration=!1,this.buf_frame_header=Buffer.alloc(4),this.syncPeek={buf:Buffer.alloc(i),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let b=!1;for(;!b;)await this.sync(),b=await this.parseCommonMpegHeader()}catch(b){if(b instanceof r.EndOfStreamError){if(l("End-of-stream"),this.calculateEofDuration){const y=this.frameCount*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",y);const T=y/this.metadata.format.sampleRate;l(`Calculate duration at EOF: ${T} sec.`,T),this.metadata.setFormat("duration",T)}}else throw b}}finalize(){const b=this.metadata.format,y=this.metadata.native.hasOwnProperty("ID3v1");if(b.duration&&this.tokenizer.fileInfo.size){const T=this.tokenizer.fileInfo.size-this.mpegOffset-(y?128:0);b.codecProfile&&b.codecProfile[0]==="V"&&this.metadata.setFormat("bitrate",T*8/b.duration)}else if(this.tokenizer.fileInfo.size&&b.codecProfile==="CBR"){const T=this.tokenizer.fileInfo.size-this.mpegOffset-(y?128:0),E=Math.round(T/this.frame_size)*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",E);const x=E/b.sampleRate;l("Calculate CBR duration based on file size: %s",x),this.metadata.setFormat("duration",x)}}async sync(){let b=!1;for(;;){let y=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:i,mayBeLess:!0}),this.syncPeek.len<=163)throw new r.EndOfStreamError;for(;;)if(b&&(this.syncPeek.buf[y]&224)===224){this.buf_frame_header[0]=d.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[y],await this.tokenizer.ignore(y),l(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(l(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),this.syncFrameCount=this.frameCount;return}else if(b=!1,y=this.syncPeek.buf.indexOf(d.SyncByte1,y),y===-1){if(this.syncPeek.len<this.syncPeek.buf.length)throw new r.EndOfStreamError;await this.tokenizer.ignore(this.syncPeek.len);break}else++y,b=!0}}async parseCommonMpegHeader(){this.frameCount===0&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header,{offset:1,length:3});let b;try{b=m.get(this.buf_frame_header,0)}catch(y){return await this.tokenizer.ignore(1),this.metadata.addWarning("Parse error: "+y.message),!1}return await this.tokenizer.ignore(3),this.metadata.setFormat("container",b.container),this.metadata.setFormat("codec",b.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",b.samplingRate),this.frameCount++,b.version>=2&&b.layer===0?this.parseAdts(b):this.parseAudioFrameHeader(b)}async parseAudioFrameHeader(b){this.metadata.setFormat("numberOfChannels",b.channelMode==="mono"?1:2),this.metadata.setFormat("bitrate",b.bitrate),this.frameCount<20*1e4&&l("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,b.layer,b.bitrate,b.samplingRate);const y=b.calcSlotSize();if(y===null)throw new Error("invalid slot_size");const T=b.calcSamplesPerFrame();l(`samples_per_frame=${T}`);const x=T/8*b.bitrate/b.samplingRate+(b.padding?y:0);if(this.frame_size=Math.floor(x),this.audioFrameHeader=b,this.bitrates.push(b.bitrate),this.frameCount===1)return this.offset=m.len,await this.skipSideInformation(),!1;if(this.frameCount===3){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=T,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&this.frameCount===4&&(this.samplesPerFrame=T,this.calculateEofDuration=!0),this.offset=4,b.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(b){const y=Buffer.alloc(3);await this.tokenizer.readBuffer(y),b.frameLength+=t.getBitAllignedNumber(y,0,0,11),this.totalDataLength+=b.frameLength,this.samplesPerFrame=1024;const T=b.samplingRate/this.samplesPerFrame,x=8*(this.frameCount===0?0:this.totalDataLength/this.frameCount)*T+.5;if(this.metadata.setFormat("bitrate",x),l(`frame-count=${this.frameCount}, size=${b.frameLength} bytes, bit-rate=${x}`),await this.tokenizer.ignore(b.frameLength>7?b.frameLength-7:1),this.frameCount===3)if(this.metadata.setFormat("codecProfile",b.codecProfile),b.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",b.mp4ChannelConfig.length),this.options.duration)this.calculateEofDuration=!0;else return!0;return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(e.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){const b=this.audioFrameHeader.calculateSideInfoLength();await this.tokenizer.readToken(new e.Uint8ArrayType(b)),this.offset+=b,await this.readXtraInfoHeader()}async readXtraInfoHeader(){const b=await this.tokenizer.readToken(h.InfoTagHeaderTag);switch(this.offset+=h.InfoTagHeaderTag.len,b){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":const T=await this.readXingInfoHeader(),E=u(T.vbrScale);return this.metadata.setFormat("codecProfile",E),null;case"Xtra":break;case"LAME":const x=await this.tokenizer.readToken(h.LameEncoderVersion);if(this.frame_size>=this.offset+h.LameEncoderVersion.len)return this.offset+=h.LameEncoderVersion.len,this.metadata.setFormat("tool","LAME "+x),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}const y=this.frame_size-this.offset;return y<0?this.metadata.addWarning("Frame "+this.frameCount+"corrupt: negative frameDataLeft"):await this.skipFrameData(y),null}async readXingInfoHeader(){const b=this.tokenizer.position,y=await(0,h.readXingHeader)(this.tokenizer);if(this.offset+=this.tokenizer.position-b,y.lame&&(this.metadata.setFormat("tool","LAME "+t.stripNulls(y.lame.version)),y.lame.extended&&(this.metadata.setFormat("trackPeakLevel",y.lame.extended.track_peak),y.lame.extended.track_gain&&this.metadata.setFormat("trackGain",y.lame.extended.track_gain.adjustment),y.lame.extended.album_gain&&this.metadata.setFormat("albumGain",y.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",y.lame.extended.music_length/1e3))),y.streamSize){const E=this.audioFrameHeader.calcDuration(y.numFrames);return this.metadata.setFormat("duration",E),l("Get duration from Xing header: %s",this.metadata.format.duration),y}const T=this.frame_size-this.offset;return await this.skipFrameData(T),y}async skipFrameData(b){if(b<0)throw new Error("frame-data-left cannot be negative");await this.tokenizer.ignore(b),this.countSkipFrameData+=b}areAllSame(b){const y=b[0];return b.every(T=>T===y)}};return MpegParser.MpegParser=a,MpegParser}var musepack={},MpcSv8Parser={},StreamVersion8={},hasRequiredStreamVersion8;function requireStreamVersion8(){if(hasRequiredStreamVersion8)return StreamVersion8;hasRequiredStreamVersion8=1,Object.defineProperty(StreamVersion8,"__esModule",{value:!0}),StreamVersion8.StreamReader=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireUtil$1(),t=(0,r.default)("music-metadata:parser:musepack:sv8"),c=new e.StringType(2,"binary"),h={len:5,get:(p,s)=>({crc:e.UINT32_LE.get(p,s),streamVersion:e.UINT8.get(p,s+4)})},l={len:2,get:(p,s)=>({sampleFrequency:[44100,48e3,37800,32e3][o.getBitAllignedNumber(p,s,0,3)],maxUsedBands:o.getBitAllignedNumber(p,s,3,5),channelCount:o.getBitAllignedNumber(p,s+1,0,4)+1,msUsed:o.isBitSet(p,s+1,4),audioBlockFrames:o.getBitAllignedNumber(p,s+1,5,3)})};class i{constructor(s){this.tokenizer=s}async readPacketHeader(){const s=await this.tokenizer.readToken(c),d=await this.readVariableSizeField();return{key:s,payloadLength:d.value-2-d.len}}async readStreamHeader(s){const d={};t(`Reading SH at offset=${this.tokenizer.position}`);const m=await this.tokenizer.readToken(h);s-=h.len,Object.assign(d,m),t(`SH.streamVersion = ${m.streamVersion}`);const u=await this.readVariableSizeField();s-=u.len,d.sampleCount=u.value;const a=await this.readVariableSizeField();s-=a.len,d.beginningOfSilence=a.value;const g=await this.tokenizer.readToken(l);return s-=l.len,Object.assign(d,g),await this.tokenizer.ignore(s),d}async readVariableSizeField(s=1,d=0){let m=await this.tokenizer.readNumber(e.UINT8);return(m&128)===0?{len:s,value:d+m}:(m&=127,m+=d,this.readVariableSizeField(s+1,m<<7))}}return StreamVersion8.StreamReader=i,StreamVersion8}var hasRequiredMpcSv8Parser;function requireMpcSv8Parser(){if(hasRequiredMpcSv8Parser)return MpcSv8Parser;hasRequiredMpcSv8Parser=1,Object.defineProperty(MpcSv8Parser,"__esModule",{value:!0}),MpcSv8Parser.MpcSv8Parser=void 0;const e=requireBrowser$3(),r=requireBasicParser(),o=requireAPEv2Parser(),t=requireFourCC(),c=requireStreamVersion8(),h=(0,e.default)("music-metadata:parser:musepack");let l=class extends r.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){if(await this.tokenizer.readToken(t.FourCcToken)!=="MPCK")throw new Error("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const p=new c.StreamReader(this.tokenizer);do{const s=await p.readPacketHeader();switch(h(`packet-header key=${s.key}, payloadLength=${s.payloadLength}`),s.key){case"SH":const d=await p.readStreamHeader(s.payloadLength);this.metadata.setFormat("numberOfSamples",d.sampleCount),this.metadata.setFormat("sampleRate",d.sampleFrequency),this.metadata.setFormat("duration",d.sampleCount/d.sampleFrequency),this.metadata.setFormat("numberOfChannels",d.channelCount);break;case"AP":this.audioLength+=s.payloadLength,await this.tokenizer.ignore(s.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(s.payloadLength);break;case"SE":return this.metadata.setFormat("bitrate",this.audioLength*8/this.metadata.format.duration),o.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new Error(`Unexpected header: ${s.key}`)}}while(!0)}};return MpcSv8Parser.MpcSv8Parser=l,MpcSv8Parser}var MpcSv7Parser={},BitReader={},hasRequiredBitReader;function requireBitReader(){if(hasRequiredBitReader)return BitReader;hasRequiredBitReader=1,Object.defineProperty(BitReader,"__esModule",{value:!0}),BitReader.BitReader=void 0;const e=requireLib$2();let r=class{constructor(t){this.tokenizer=t,this.pos=0,this.dword=void 0}async read(t){for(;this.dword===void 0;)this.dword=await this.tokenizer.readToken(e.UINT32_LE);let c=this.dword;return this.pos+=t,this.pos<32?(c>>>=32-this.pos,c&(1<<t)-1):(this.pos-=32,this.pos===0?(this.dword=void 0,c&(1<<t)-1):(this.dword=await this.tokenizer.readToken(e.UINT32_LE),this.pos&&(c<<=this.pos,c|=this.dword>>>32-this.pos),c&(1<<t)-1))}async ignore(t){if(this.pos>0){const l=32-this.pos;this.dword=void 0,t-=l,this.pos=0}const c=t%32,h=(t-c)/32;return await this.tokenizer.ignore(h*4),this.read(c)}};return BitReader.BitReader=r,BitReader}var StreamVersion7={},hasRequiredStreamVersion7;function requireStreamVersion7(){if(hasRequiredStreamVersion7)return StreamVersion7;hasRequiredStreamVersion7=1,Object.defineProperty(StreamVersion7,"__esModule",{value:!0}),StreamVersion7.Header=void 0;const e=requireLib$2(),r=requireUtil$1();return StreamVersion7.Header={len:24,get:(o,t)=>{const c={signature:Buffer.from(o).toString("latin1",t,t+3),streamMinorVersion:r.getBitAllignedNumber(o,t+3,0,4),streamMajorVersion:r.getBitAllignedNumber(o,t+3,4,4),frameCount:e.UINT32_LE.get(o,t+4),maxLevel:e.UINT16_LE.get(o,t+8),sampleFrequency:[44100,48e3,37800,32e3][r.getBitAllignedNumber(o,t+10,0,2)],link:r.getBitAllignedNumber(o,t+10,2,2),profile:r.getBitAllignedNumber(o,t+10,4,4),maxBand:r.getBitAllignedNumber(o,t+11,0,6),intensityStereo:r.isBitSet(o,t+11,6),midSideStereo:r.isBitSet(o,t+11,7),titlePeak:e.UINT16_LE.get(o,t+12),titleGain:e.UINT16_LE.get(o,t+14),albumPeak:e.UINT16_LE.get(o,t+16),albumGain:e.UINT16_LE.get(o,t+18),lastFrameLength:e.UINT32_LE.get(o,t+20)>>>20&2047,trueGapless:r.isBitSet(o,t+23,0)};return c.lastFrameLength=c.trueGapless?e.UINT32_LE.get(o,20)>>>20&2047:0,c}},StreamVersion7}var hasRequiredMpcSv7Parser;function requireMpcSv7Parser(){if(hasRequiredMpcSv7Parser)return MpcSv7Parser;hasRequiredMpcSv7Parser=1,Object.defineProperty(MpcSv7Parser,"__esModule",{value:!0}),MpcSv7Parser.MpcSv7Parser=void 0;const e=requireBrowser$3(),r=requireBasicParser(),o=requireAPEv2Parser(),t=requireBitReader(),c=requireStreamVersion7(),h=(0,e.default)("music-metadata:parser:musepack");let l=class extends r.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){const p=await this.tokenizer.readToken(c.Header);if(p.signature!=="MP+")throw new Error("Unexpected magic number");h(`stream-version=${p.streamMajorVersion}.${p.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",p.sampleFrequency);const s=1152*(p.frameCount-1)+p.lastFrameLength;this.metadata.setFormat("numberOfSamples",s),this.duration=s/p.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new t.BitReader(this.tokenizer),this.metadata.setFormat("numberOfChannels",p.midSideStereo||p.intensityStereo?2:1);const d=await this.bitreader.read(8);return this.metadata.setFormat("codec",(d/100).toFixed(2)),await this.skipAudioData(p.frameCount),h(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),o.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(p){for(;p-- >0;){const d=await this.bitreader.read(20);this.audioLength+=20+d,await this.bitreader.ignore(d)}const s=await this.bitreader.read(11);this.audioLength+=s,this.metadata.setFormat("bitrate",this.audioLength/this.duration)}};return MpcSv7Parser.MpcSv7Parser=l,MpcSv7Parser}var hasRequiredMusepack;function requireMusepack(){if(hasRequiredMusepack)return musepack;hasRequiredMusepack=1,Object.defineProperty(musepack,"__esModule",{value:!0});const e=requireBrowser$3(),r=requireLib$2(),o=requireAbstractID3Parser(),t=requireMpcSv8Parser(),c=requireMpcSv7Parser(),h=(0,e.default)("music-metadata:parser:musepack");class l extends o.AbstractID3Parser{async postId3v2Parse(){const p=await this.tokenizer.peekToken(new r.StringType(3,"binary"));let s;switch(p){case"MP+":{h("Musepack stream-version 7"),s=new c.MpcSv7Parser;break}case"MPC":{h("Musepack stream-version 8"),s=new t.MpcSv8Parser;break}default:throw new Error("Invalid Musepack signature prefix")}return s.init(this.metadata,this.tokenizer,this.options),s.parse()}}return musepack.default=l,musepack}var OggParser={},OpusParser={},Opus={},hasRequiredOpus;function requireOpus(){if(hasRequiredOpus)return Opus;hasRequiredOpus=1,Object.defineProperty(Opus,"__esModule",{value:!0}),Opus.IdHeader=void 0;const e=requireLib$2();class r{constructor(t){if(this.len=t,t<19)throw new Error("ID-header-page 0 should be at least 19 bytes long")}get(t,c){return{magicSignature:new e.StringType(8,"ascii").get(t,c+0),version:t.readUInt8(c+8),channelCount:t.readUInt8(c+9),preSkip:t.readInt16LE(c+10),inputSampleRate:t.readInt32LE(c+12),outputGain:t.readInt16LE(c+16),channelMapping:t.readUInt8(c+18)}}}return Opus.IdHeader=r,Opus}var hasRequiredOpusParser;function requireOpusParser(){if(hasRequiredOpusParser)return OpusParser;hasRequiredOpusParser=1,Object.defineProperty(OpusParser,"__esModule",{value:!0}),OpusParser.OpusParser=void 0;const e=requireLib$2(),r=requireVorbisParser(),o=requireOpus();let t=class extends r.VorbisParser{constructor(h,l,i){super(h,l),this.tokenizer=i,this.lastPos=-1}parseFirstPage(h,l){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new o.IdHeader(l.length).get(l,0),this.idHeader.magicSignature!=="OpusHead")throw new Error("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}parseFullPage(h){switch(new e.StringType(8,"ascii").get(h,0)){case"OpusTags":this.parseUserCommentList(h,8),this.lastPos=this.tokenizer.position-h.length;break}}calculateDuration(h){if(this.metadata.format.sampleRate&&h.absoluteGranulePosition>=0){const l=h.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",l),this.metadata.setFormat("duration",l/48e3),this.lastPos!==-1&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const i=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*i/this.metadata.format.duration)}}}};return OpusParser.OpusParser=t,OpusParser}var SpeexParser={},Speex={},hasRequiredSpeex;function requireSpeex(){if(hasRequiredSpeex)return Speex;hasRequiredSpeex=1,Object.defineProperty(Speex,"__esModule",{value:!0}),Speex.Header=void 0;const e=requireLib$2(),r=requireUtil$1();return Speex.Header={len:80,get:(o,t)=>({speex:new e.StringType(8,"ascii").get(o,t+0),version:r.trimRightNull(new e.StringType(20,"ascii").get(o,t+8)),version_id:o.readInt32LE(t+28),header_size:o.readInt32LE(t+32),rate:o.readInt32LE(t+36),mode:o.readInt32LE(t+40),mode_bitstream_version:o.readInt32LE(t+44),nb_channels:o.readInt32LE(t+48),bitrate:o.readInt32LE(t+52),frame_size:o.readInt32LE(t+56),vbr:o.readInt32LE(t+60),frames_per_packet:o.readInt32LE(t+64),extra_headers:o.readInt32LE(t+68),reserved1:o.readInt32LE(t+72),reserved2:o.readInt32LE(t+76)})},Speex}var hasRequiredSpeexParser;function requireSpeexParser(){if(hasRequiredSpeexParser)return SpeexParser;hasRequiredSpeexParser=1,Object.defineProperty(SpeexParser,"__esModule",{value:!0}),SpeexParser.SpeexParser=void 0;const e=requireBrowser$3(),r=requireVorbisParser(),o=requireSpeex(),t=(0,e.default)("music-metadata:parser:ogg:speex");let c=class extends r.VorbisParser{constructor(l,i,p){super(l,i),this.tokenizer=p}parseFirstPage(l,i){t("First Ogg/Speex page");const p=o.Header.get(i,0);this.metadata.setFormat("codec",`Speex ${p.version}`),this.metadata.setFormat("numberOfChannels",p.nb_channels),this.metadata.setFormat("sampleRate",p.rate),p.bitrate!==-1&&this.metadata.setFormat("bitrate",p.bitrate)}};return SpeexParser.SpeexParser=c,SpeexParser}var TheoraParser={},Theora={},hasRequiredTheora;function requireTheora(){if(hasRequiredTheora)return Theora;hasRequiredTheora=1,Object.defineProperty(Theora,"__esModule",{value:!0}),Theora.IdentificationHeader=void 0;const e=requireLib$2();return Theora.IdentificationHeader={len:42,get:(r,o)=>({id:new e.StringType(7,"ascii").get(r,o),vmaj:r.readUInt8(o+7),vmin:r.readUInt8(o+8),vrev:r.readUInt8(o+9),vmbw:r.readUInt16BE(o+10),vmbh:r.readUInt16BE(o+17),nombr:e.UINT24_BE.get(r,o+37),nqual:r.readUInt8(o+40)})},Theora}var hasRequiredTheoraParser;function requireTheoraParser(){if(hasRequiredTheoraParser)return TheoraParser;hasRequiredTheoraParser=1,Object.defineProperty(TheoraParser,"__esModule",{value:!0}),TheoraParser.TheoraParser=void 0;const e=requireBrowser$3(),r=requireTheora(),o=(0,e.default)("music-metadata:parser:ogg:theora");let t=class{constructor(h,l,i){this.metadata=h,this.tokenizer=i}parsePage(h,l){h.headerType.firstPage&&this.parseFirstPage(h,l)}flush(){o("flush")}calculateDuration(h){o("duration calculation not implemented")}parseFirstPage(h,l){o("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const i=r.IdentificationHeader.get(l,0);this.metadata.setFormat("bitrate",i.nombr)}};return TheoraParser.TheoraParser=t,TheoraParser}var hasRequiredOggParser;function requireOggParser(){if(hasRequiredOggParser)return OggParser;hasRequiredOggParser=1,Object.defineProperty(OggParser,"__esModule",{value:!0}),OggParser.OggParser=OggParser.SegmentTable=void 0;const e=requireLib$2(),r=requireCore$2(),o=requireBrowser$3(),t=requireUtil$1(),c=requireFourCC(),h=requireBasicParser(),l=requireVorbisParser(),i=requireOpusParser(),p=requireSpeexParser(),s=requireTheoraParser(),d=(0,o.default)("music-metadata:parser:ogg");class m{static sum(g,b,y){let T=0;for(let E=b;E<b+y;++E)T+=g[E];return T}constructor(g){this.len=g.page_segments}get(g,b){return{totalPageSize:m.sum(g,b,this.len)}}}OggParser.SegmentTable=m;let u=class tt extends h.BasicParser{async parse(){d("pos=%s, parsePage()",this.tokenizer.position);try{let g;do{if(g=await this.tokenizer.readToken(tt.Header),g.capturePattern!=="OggS")throw new Error("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=g,this.pageNumber=g.pageSequenceNo,d("page#=%s, Ogg.id=%s",g.pageSequenceNo,g.capturePattern);const b=await this.tokenizer.readToken(new m(g));d("totalPageSize=%s",b.totalPageSize);const y=await this.tokenizer.readToken(new e.Uint8ArrayType(b.totalPageSize));if(d("firstPage=%s, lastPage=%s, continued=%s",g.headerType.firstPage,g.headerType.lastPage,g.headerType.continued),g.headerType.firstPage){const T=new e.StringType(7,"ascii").get(Buffer.from(y),0);switch(T){case"vorbis":d("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new l.VorbisParser(this.metadata,this.options);break;case"OpusHea":d("Set page consumer to Ogg/Opus"),this.pageConsumer=new i.OpusParser(this.metadata,this.options,this.tokenizer);break;case"Speex  ":d("Set page consumer to Ogg/Speex"),this.pageConsumer=new p.SpeexParser(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":d("Set page consumer to Ogg/Theora"),this.pageConsumer=new s.TheoraParser(this.metadata,this.options,this.tokenizer);break;default:throw new Error("gg audio-codec not recognized (id="+T+")")}}this.pageConsumer.parsePage(g,y)}while(!g.headerType.lastPage)}catch(g){if(g instanceof r.EndOfStreamError)this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),d("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header);else if(g.message.startsWith("FourCC"))this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),this.pageConsumer.flush());else throw g}}};return u.Header={len:27,get:(a,g)=>({capturePattern:c.FourCcToken.get(a,g),version:e.UINT8.get(a,g+4),headerType:{continued:t.getBit(a,g+5,0),firstPage:t.getBit(a,g+5,1),lastPage:t.getBit(a,g+5,2)},absoluteGranulePosition:Number(e.UINT64_LE.get(a,g+6)),streamSerialNumber:e.UINT32_LE.get(a,g+14),pageSequenceNo:e.UINT32_LE.get(a,g+18),pageChecksum:e.UINT32_LE.get(a,g+22),page_segments:e.UINT8.get(a,g+26)})},OggParser.OggParser=u,OggParser}var WaveParser={},RiffChunk={},hasRequiredRiffChunk;function requireRiffChunk(){if(hasRequiredRiffChunk)return RiffChunk;hasRequiredRiffChunk=1,Object.defineProperty(RiffChunk,"__esModule",{value:!0}),RiffChunk.ListInfoTagValue=RiffChunk.Header=void 0;const e=requireLib$2();RiffChunk.Header={len:8,get:(o,t)=>({chunkID:o.toString("binary",t,t+4),chunkSize:e.UINT32_LE.get(o,4)})};class r{constructor(t){this.tagHeader=t,this.len=t.chunkSize,this.len+=this.len&1}get(t,c){return new e.StringType(this.tagHeader.chunkSize,"ascii").get(t,c)}}return RiffChunk.ListInfoTagValue=r,RiffChunk}var WaveChunk={},hasRequiredWaveChunk;function requireWaveChunk(){return hasRequiredWaveChunk||(hasRequiredWaveChunk=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FactChunk=e.Format=e.WaveFormat=void 0,(function(t){t[t.PCM=1]="PCM",t[t.ADPCM=2]="ADPCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.MPEG_ADTS_AAC=5632]="MPEG_ADTS_AAC",t[t.MPEG_LOAS=5634]="MPEG_LOAS",t[t.RAW_AAC1=255]="RAW_AAC1",t[t.DOLBY_AC3_SPDIF=146]="DOLBY_AC3_SPDIF",t[t.DVM=8192]="DVM",t[t.RAW_SPORT=576]="RAW_SPORT",t[t.ESST_AC3=577]="ESST_AC3",t[t.DRM=9]="DRM",t[t.DTS2=8193]="DTS2",t[t.MPEG=80]="MPEG"})(e.WaveFormat||(e.WaveFormat={}));class r{constructor(c){if(c.chunkSize<16)throw new Error("Invalid chunk size");this.len=c.chunkSize}get(c,h){return{wFormatTag:c.readUInt16LE(h),nChannels:c.readUInt16LE(h+2),nSamplesPerSec:c.readUInt32LE(h+4),nAvgBytesPerSec:c.readUInt32LE(h+8),nBlockAlign:c.readUInt16LE(h+12),wBitsPerSample:c.readUInt16LE(h+14)}}}e.Format=r;class o{constructor(c){if(c.chunkSize<4)throw new Error("Invalid fact chunk size.");this.len=c.chunkSize}get(c,h){return{dwSampleLength:c.readUInt32LE(h)}}}e.FactChunk=o})(WaveChunk)),WaveChunk}var BwfChunk={},hasRequiredBwfChunk;function requireBwfChunk(){if(hasRequiredBwfChunk)return BwfChunk;hasRequiredBwfChunk=1,Object.defineProperty(BwfChunk,"__esModule",{value:!0}),BwfChunk.BroadcastAudioExtensionChunk=void 0;const e=requireLib$2(),r=requireUtil$1();return BwfChunk.BroadcastAudioExtensionChunk={len:420,get:(o,t)=>({description:(0,r.stripNulls)(new e.StringType(256,"ascii").get(o,t)).trim(),originator:(0,r.stripNulls)(new e.StringType(32,"ascii").get(o,t+256)).trim(),originatorReference:(0,r.stripNulls)(new e.StringType(32,"ascii").get(o,t+288)).trim(),originationDate:(0,r.stripNulls)(new e.StringType(10,"ascii").get(o,t+320)).trim(),originationTime:(0,r.stripNulls)(new e.StringType(8,"ascii").get(o,t+330)).trim(),timeReferenceLow:e.UINT32_LE.get(o,t+338),timeReferenceHigh:e.UINT32_LE.get(o,t+342),version:e.UINT16_LE.get(o,t+346),umid:new e.Uint8ArrayType(64).get(o,t+348),loudnessValue:e.UINT16_LE.get(o,t+412),maxTruePeakLevel:e.UINT16_LE.get(o,t+414),maxMomentaryLoudness:e.UINT16_LE.get(o,t+416),maxShortTermLoudness:e.UINT16_LE.get(o,t+418)})},BwfChunk}var hasRequiredWaveParser;function requireWaveParser(){if(hasRequiredWaveParser)return WaveParser;hasRequiredWaveParser=1,Object.defineProperty(WaveParser,"__esModule",{value:!0}),WaveParser.WaveParser=void 0;const e=requireCore$2(),r=requireLib$2(),o=requireBrowser$3(),t=requireRiffChunk(),c=requireWaveChunk(),h=requireID3v2Parser(),l=requireUtil$1(),i=requireFourCC(),p=requireBasicParser(),s=requireBwfChunk(),d=(0,o.default)("music-metadata:parser:RIFF");let m=class extends p.BasicParser{async parse(){const a=await this.tokenizer.readToken(t.Header);if(d(`pos=${this.tokenizer.position}, parse: chunkID=${a.chunkID}`),a.chunkID==="RIFF")return this.parseRiffChunk(a.chunkSize).catch(g=>{if(!(g instanceof e.EndOfStreamError))throw g})}async parseRiffChunk(a){const g=await this.tokenizer.readToken(i.FourCcToken);switch(this.metadata.setFormat("container",g),g){case"WAVE":return this.readWaveChunk(a-i.FourCcToken.len);default:throw new Error(`Unsupported RIFF format: RIFF/${g}`)}}async readWaveChunk(a){for(;a>=t.Header.len;){const g=await this.tokenizer.readToken(t.Header);switch(a-=t.Header.len+g.chunkSize,g.chunkSize>a&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=g,d(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${g.chunkID}`),g.chunkID){case"LIST":await this.parseListTag(g);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new c.FactChunk(g));break;case"fmt ":const b=await this.tokenizer.readToken(new c.Format(g));let y=c.WaveFormat[b.wFormatTag];y||(d("WAVE/non-PCM format="+b.wFormatTag),y="non-PCM ("+b.wFormatTag+")"),this.metadata.setFormat("codec",y),this.metadata.setFormat("bitsPerSample",b.wBitsPerSample),this.metadata.setFormat("sampleRate",b.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",b.nChannels),this.metadata.setFormat("bitrate",b.nBlockAlign*b.nSamplesPerSec*8),this.blockAlign=b.nBlockAlign;break;case"id3 ":case"ID3 ":const T=await this.tokenizer.readToken(new r.Uint8ArrayType(g.chunkSize)),E=e.fromBuffer(T);await new h.ID3v2Parser().parse(this.metadata,E,this.options);break;case"data":this.metadata.format.lossless!==!1&&this.metadata.setFormat("lossless",!0);let x=g.chunkSize;if(this.tokenizer.fileInfo.size){const w=this.tokenizer.fileInfo.size-this.tokenizer.position;w<x&&(this.metadata.addWarning("data chunk length exceeding file length"),x=w)}const R=this.fact?this.fact.dwSampleLength:x===4294967295?void 0:x/this.blockAlign;R&&(this.metadata.setFormat("numberOfSamples",R),this.metadata.setFormat("duration",R/this.metadata.format.sampleRate)),this.metadata.format.codec==="ADPCM"?this.metadata.setFormat("bitrate",352e3):this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(g.chunkSize);break;case"bext":const P=await this.tokenizer.readToken(s.BroadcastAudioExtensionChunk);Object.keys(P).forEach(w=>{this.metadata.addTag("exif","bext."+w,P[w])});const A=g.chunkSize-s.BroadcastAudioExtensionChunk.len;await this.tokenizer.ignore(A);break;case"\0\0\0\0":d(`Ignore padding chunk: RIFF/${g.chunkID} of ${g.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+g.chunkID),await this.tokenizer.ignore(g.chunkSize);break;default:d(`Ignore chunk: RIFF/${g.chunkID} of ${g.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+g.chunkID),await this.tokenizer.ignore(g.chunkSize)}this.header.chunkSize%2===1&&(d("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(a){const g=await this.tokenizer.readToken(new r.StringType(4,"binary"));switch(d("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,g),g){case"INFO":return this.parseRiffInfoTags(a.chunkSize-4);case"adtl":default:return this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/"+g),d("Ignoring chunkID=RIFF/WAVE/LIST/"+g),this.tokenizer.ignore(a.chunkSize-4).then()}}async parseRiffInfoTags(a){for(;a>=8;){const g=await this.tokenizer.readToken(t.Header),b=new t.ListInfoTagValue(g),y=await this.tokenizer.readToken(b);this.addTag(g.chunkID,l.stripNulls(y)),a-=8+b.len}if(a!==0)throw Error("Illegal remaining size: "+a)}addTag(a,g){this.metadata.addTag("exif",a,g)}};return WaveParser.WaveParser=m,WaveParser}var WavPackParser={},WavPackToken={},hasRequiredWavPackToken;function requireWavPackToken(){if(hasRequiredWavPackToken)return WavPackToken;hasRequiredWavPackToken=1,Object.defineProperty(WavPackToken,"__esModule",{value:!0}),WavPackToken.WavPack=void 0;const e=requireLib$2(),r=requireFourCC(),o=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1];class t{static isBitSet(h,l){return t.getBitAllignedNumber(h,l,1)===1}static getBitAllignedNumber(h,l,i){return h>>>l&4294967295>>>32-i}}return t.BlockHeaderToken={len:32,get:(c,h)=>{const l=e.UINT32_LE.get(c,h+24),i={BlockID:r.FourCcToken.get(c,h),blockSize:e.UINT32_LE.get(c,h+4),version:e.UINT16_LE.get(c,h+8),totalSamples:e.UINT32_LE.get(c,h+12),blockIndex:e.UINT32_LE.get(c,h+16),blockSamples:e.UINT32_LE.get(c,h+20),flags:{bitsPerSample:(1+t.getBitAllignedNumber(l,0,2))*8,isMono:t.isBitSet(l,2),isHybrid:t.isBitSet(l,3),isJointStereo:t.isBitSet(l,4),crossChannel:t.isBitSet(l,5),hybridNoiseShaping:t.isBitSet(l,6),floatingPoint:t.isBitSet(l,7),samplingRate:o[t.getBitAllignedNumber(l,23,4)],isDSD:t.isBitSet(l,31)},crc:new e.Uint8ArrayType(4).get(c,h+28)};return i.flags.isDSD&&(i.totalSamples*=8),i}},t.MetadataIdToken={len:1,get:(c,h)=>({functionId:t.getBitAllignedNumber(c[h],0,6),isOptional:t.isBitSet(c[h],5),isOddSize:t.isBitSet(c[h],6),largeBlock:t.isBitSet(c[h],7)})},WavPackToken.WavPack=t,WavPackToken}var hasRequiredWavPackParser;function requireWavPackParser(){if(hasRequiredWavPackParser)return WavPackParser;hasRequiredWavPackParser=1,Object.defineProperty(WavPackParser,"__esModule",{value:!0}),WavPackParser.WavPackParser=void 0;const e=requireLib$2(),r=requireAPEv2Parser(),o=requireFourCC(),t=requireBasicParser(),c=requireWavPackToken(),l=(0,requireBrowser$3().default)("music-metadata:parser:WavPack");let i=class extends t.BasicParser{async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),r.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if(await this.tokenizer.peekToken(o.FourCcToken)!=="wvpk")break;const d=await this.tokenizer.readToken(c.WavPack.BlockHeaderToken);if(d.BlockID!=="wvpk")throw new Error("Invalid WavPack Block-ID");l(`WavPack header blockIndex=${d.blockIndex}, len=${c.WavPack.BlockHeaderToken.len}`),d.blockIndex===0&&!this.metadata.format.container&&(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!d.flags.isHybrid),this.metadata.setFormat("bitsPerSample",d.flags.bitsPerSample),d.flags.isDSD||(this.metadata.setFormat("sampleRate",d.flags.samplingRate),this.metadata.setFormat("duration",d.totalSamples/d.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",d.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",d.totalSamples),this.metadata.setFormat("codec",d.flags.isDSD?"DSD":"PCM"));const m=d.blockSize-(c.WavPack.BlockHeaderToken.len-8);await(d.blockIndex===0?this.parseMetadataSubBlock(d,m):this.tokenizer.ignore(m)),d.blockSamples>0&&(this.audioDataSize+=d.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=c.WavPack.BlockHeaderToken.len);this.metadata.setFormat("bitrate",this.audioDataSize*8/this.metadata.format.duration)}async parseMetadataSubBlock(s,d){for(;d>c.WavPack.MetadataIdToken.len;){const m=await this.tokenizer.readToken(c.WavPack.MetadataIdToken),u=await this.tokenizer.readNumber(m.largeBlock?e.UINT24_LE:e.UINT8),a=Buffer.alloc(u*2-(m.isOddSize?1:0));switch(await this.tokenizer.readBuffer(a),l(`Metadata Sub-Blocks functionId=0x${m.functionId.toString(16)}, id.largeBlock=${m.largeBlock},data-size=${a.length}`),m.functionId){case 0:break;case 14:l("ID_DSD_BLOCK");const g=1<<a.readUInt8(0),b=s.flags.samplingRate*g*8;if(!s.flags.isDSD)throw new Error("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",b),this.metadata.setFormat("duration",s.totalSamples/b);break;case 36:l("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",a);break;case 47:l(`ID_BLOCK_CHECKSUM: checksum=${a.toString("hex")}`);break;default:l(`Ignore unsupported meta-sub-block-id functionId=0x${m.functionId.toString(16)}`);break}d-=c.WavPack.MetadataIdToken.len+(m.largeBlock?e.UINT24_LE.len:e.UINT8.len)+u*2,l(`remainingLength=${d}`),m.isOddSize&&this.tokenizer.ignore(1)}if(d!==0)throw new Error("metadata-sub-block should fit it remaining length")}};return WavPackParser.WavPackParser=i,WavPackParser}var DsfParser={},DsfChunk={},hasRequiredDsfChunk;function requireDsfChunk(){return hasRequiredDsfChunk||(hasRequiredDsfChunk=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FormatChunk=e.ChannelType=e.DsdChunk=e.ChunkHeader=void 0;const r=requireLib$2(),o=requireFourCC();e.ChunkHeader={len:12,get:(t,c)=>({id:o.FourCcToken.get(t,c),size:r.UINT64_LE.get(t,c+4)})},e.DsdChunk={len:16,get:(t,c)=>({fileSize:r.INT64_LE.get(t,c),metadataPointer:r.INT64_LE.get(t,c+8)})},(function(t){t[t.mono=1]="mono",t[t.stereo=2]="stereo",t[t.channels=3]="channels",t[t.quad=4]="quad",t[t["4 channels"]=5]="4 channels",t[t["5 channels"]=6]="5 channels",t[t["5.1 channels"]=7]="5.1 channels"})(e.ChannelType||(e.ChannelType={})),e.FormatChunk={len:40,get:(t,c)=>({formatVersion:r.INT32_LE.get(t,c),formatID:r.INT32_LE.get(t,c+4),channelType:r.INT32_LE.get(t,c+8),channelNum:r.INT32_LE.get(t,c+12),samplingFrequency:r.INT32_LE.get(t,c+16),bitsPerSample:r.INT32_LE.get(t,c+20),sampleCount:r.INT64_LE.get(t,c+24),blockSizePerChannel:r.INT32_LE.get(t,c+32)})}})(DsfChunk)),DsfChunk}var hasRequiredDsfParser;function requireDsfParser(){if(hasRequiredDsfParser)return DsfParser;hasRequiredDsfParser=1,Object.defineProperty(DsfParser,"__esModule",{value:!0}),DsfParser.DsfParser=void 0;const e=requireBrowser$3(),r=requireAbstractID3Parser(),o=requireDsfChunk(),t=requireID3v2Parser(),c=(0,e.default)("music-metadata:parser:DSF");let h=class extends r.AbstractID3Parser{async postId3v2Parse(){const i=this.tokenizer.position,p=await this.tokenizer.readToken(o.ChunkHeader);if(p.id!=="DSD ")throw new Error("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const s=await this.tokenizer.readToken(o.DsdChunk);if(s.metadataPointer===BigInt(0))c("No ID3v2 tag present");else return c(`expect ID3v2 at offset=${s.metadataPointer}`),await this.parseChunks(s.fileSize-p.size),await this.tokenizer.ignore(Number(s.metadataPointer)-this.tokenizer.position-i),new t.ID3v2Parser().parse(this.metadata,this.tokenizer,this.options)}async parseChunks(i){for(;i>=o.ChunkHeader.len;){const p=await this.tokenizer.readToken(o.ChunkHeader);switch(c(`Parsing chunk name=${p.id} size=${p.size}`),p.id){case"fmt ":const s=await this.tokenizer.readToken(o.FormatChunk);this.metadata.setFormat("numberOfChannels",s.channelNum),this.metadata.setFormat("sampleRate",s.samplingFrequency),this.metadata.setFormat("bitsPerSample",s.bitsPerSample),this.metadata.setFormat("numberOfSamples",s.sampleCount),this.metadata.setFormat("duration",Number(s.sampleCount)/s.samplingFrequency);const d=s.bitsPerSample*s.samplingFrequency*s.channelNum;this.metadata.setFormat("bitrate",d);return;default:this.tokenizer.ignore(Number(p.size)-o.ChunkHeader.len);break}i-=p.size}}};return DsfParser.DsfParser=h,DsfParser}var DsdiffParser={},DsdiffToken={},hasRequiredDsdiffToken;function requireDsdiffToken(){if(hasRequiredDsdiffToken)return DsdiffToken;hasRequiredDsdiffToken=1,Object.defineProperty(DsdiffToken,"__esModule",{value:!0}),DsdiffToken.ChunkHeader64=void 0;const e=requireLib$2(),r=requireFourCC();return DsdiffToken.ChunkHeader64={len:12,get:(o,t)=>({chunkID:r.FourCcToken.get(o,t),chunkSize:e.INT64_BE.get(o,t+4)})},DsdiffToken}var hasRequiredDsdiffParser;function requireDsdiffParser(){if(hasRequiredDsdiffParser)return DsdiffParser;hasRequiredDsdiffParser=1,Object.defineProperty(DsdiffParser,"__esModule",{value:!0}),DsdiffParser.DsdiffParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireCore$2(),t=requireFourCC(),c=requireBasicParser(),h=requireID3v2Parser(),l=requireDsdiffToken(),i=(0,r.default)("music-metadata:parser:aiff");let p=class extends c.BasicParser{async parse(){const d=await this.tokenizer.readToken(l.ChunkHeader64);if(d.chunkID!=="FRM8")throw new Error("Unexpected chunk-ID");const m=(await this.tokenizer.readToken(t.FourCcToken)).trim();switch(m){case"DSD":return this.metadata.setFormat("container",`DSDIFF/${m}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(d.chunkSize-BigInt(t.FourCcToken.len));default:throw Error(`Unsupported DSDIFF type: ${m}`)}}async readFmt8Chunks(d){for(;d>=l.ChunkHeader64.len;){const m=await this.tokenizer.readToken(l.ChunkHeader64);i(`Chunk id=${m.chunkID}`),await this.readData(m),d-=BigInt(l.ChunkHeader64.len)+m.chunkSize}}async readData(d){i(`Reading data of chunk[ID=${d.chunkID}, size=${d.chunkSize}]`);const m=this.tokenizer.position;switch(d.chunkID.trim()){case"FVER":const a=await this.tokenizer.readToken(e.UINT32_LE);i(`DSDIFF version=${a}`);break;case"PROP":if(await this.tokenizer.readToken(t.FourCcToken)!=="SND ")throw new Error("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(d.chunkSize-BigInt(t.FourCcToken.len));break;case"ID3":const b=await this.tokenizer.readToken(new e.Uint8ArrayType(Number(d.chunkSize))),y=o.fromBuffer(b);await new h.ID3v2Parser().parse(this.metadata,y,this.options);break;default:i(`Ignore chunk[ID=${d.chunkID}, size=${d.chunkSize}]`);break;case"DSD":this.metadata.setFormat("numberOfSamples",Number(d.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break}const u=d.chunkSize-BigInt(this.tokenizer.position-m);u>0&&(i(`After Parsing chunk, remaining ${u} bytes`),await this.tokenizer.ignore(Number(u)))}async handleSoundPropertyChunks(d){for(i(`Parsing sound-property-chunks, remainingSize=${d}`);d>0;){const m=await this.tokenizer.readToken(l.ChunkHeader64);i(`Sound-property-chunk[ID=${m.chunkID}, size=${m.chunkSize}]`);const u=this.tokenizer.position;switch(m.chunkID.trim()){case"FS":const g=await this.tokenizer.readToken(e.UINT32_BE);this.metadata.setFormat("sampleRate",g);break;case"CHNL":const b=await this.tokenizer.readToken(e.UINT16_BE);this.metadata.setFormat("numberOfChannels",b),await this.handleChannelChunks(m.chunkSize-BigInt(e.UINT16_BE.len));break;case"CMPR":const y=(await this.tokenizer.readToken(t.FourCcToken)).trim(),T=await this.tokenizer.readToken(e.UINT8),E=await this.tokenizer.readToken(new e.StringType(T,"ascii"));y==="DSD"&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${y} (${E})`);break;case"ABSS":const x=await this.tokenizer.readToken(e.UINT16_BE),R=await this.tokenizer.readToken(e.UINT8),P=await this.tokenizer.readToken(e.UINT8),A=await this.tokenizer.readToken(e.UINT32_BE);i(`ABSS ${x}:${R}:${P}.${A}`);break;case"LSCO":const w=await this.tokenizer.readToken(e.UINT16_BE);i(`LSCO lsConfig=${w}`);break;case"COMT":default:i(`Unknown sound-property-chunk[ID=${m.chunkID}, size=${m.chunkSize}]`),await this.tokenizer.ignore(Number(m.chunkSize))}const a=m.chunkSize-BigInt(this.tokenizer.position-u);a>0&&(i(`After Parsing sound-property-chunk ${m.chunkSize}, remaining ${a} bytes`),await this.tokenizer.ignore(Number(a))),d-=BigInt(l.ChunkHeader64.len)+m.chunkSize,i(`Parsing sound-property-chunks, remainingSize=${d}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const m=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",m)}}async handleChannelChunks(d){i(`Parsing channel-chunks, remainingSize=${d}`);const m=[];for(;d>=t.FourCcToken.len;){const u=await this.tokenizer.readToken(t.FourCcToken);i(`Channel[ID=${u}]`),m.push(u),d-=BigInt(t.FourCcToken.len)}return i(`Channels: ${m.join(", ")}`),m}};return DsdiffParser.DsdiffParser=p,DsdiffParser}var MatroskaParser={},MatroskaDtd={},hasRequiredMatroskaDtd;function requireMatroskaDtd(){if(hasRequiredMatroskaDtd)return MatroskaDtd;hasRequiredMatroskaDtd=1,Object.defineProperty(MatroskaDtd,"__esModule",{value:!0}),MatroskaDtd.elements=void 0;const e=requireTypes();return MatroskaDtd.elements={440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:e.DataType.uint},17143:{name:"ebmlReadVersion",value:e.DataType.uint},17138:{name:"ebmlMaxIDWidth",value:e.DataType.uint},17139:{name:"ebmlMaxSizeWidth",value:e.DataType.uint},17026:{name:"docType",value:e.DataType.string},17031:{name:"docTypeVersion",value:e.DataType.uint},17029:{name:"docTypeReadVersion",value:e.DataType.uint}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",container:{21419:{name:"seekId",value:e.DataType.binary},21420:{name:"seekPosition",value:e.DataType.uint}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:e.DataType.uid},29572:{name:"filename",value:e.DataType.string},3979555:{name:"prevUID",value:e.DataType.uid},3965867:{name:"prevFilename",value:e.DataType.string},4110627:{name:"nextUID",value:e.DataType.uid},4096955:{name:"nextFilename",value:e.DataType.string},2807729:{name:"timecodeScale",value:e.DataType.uint},17545:{name:"duration",value:e.DataType.float},17505:{name:"dateUTC",value:e.DataType.uint},31657:{name:"title",value:e.DataType.string},19840:{name:"muxingApp",value:e.DataType.string},22337:{name:"writingApp",value:e.DataType.string}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:e.DataType.uid},163:{name:"unknown",value:e.DataType.binary},167:{name:"position",value:e.DataType.uid},171:{name:"prevSize",value:e.DataType.uid}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:e.DataType.uint},29637:{name:"uid",value:e.DataType.uid},131:{name:"trackType",value:e.DataType.uint},185:{name:"flagEnabled",value:e.DataType.bool},136:{name:"flagDefault",value:e.DataType.bool},21930:{name:"flagForced",value:e.DataType.bool},156:{name:"flagLacing",value:e.DataType.bool},28135:{name:"minCache",value:e.DataType.uint},28136:{name:"maxCache",value:e.DataType.uint},2352003:{name:"defaultDuration",value:e.DataType.uint},2306383:{name:"timecodeScale",value:e.DataType.float},21358:{name:"name",value:e.DataType.string},2274716:{name:"language",value:e.DataType.string},134:{name:"codecID",value:e.DataType.string},25506:{name:"codecPrivate",value:e.DataType.binary},2459272:{name:"codecName",value:e.DataType.string},3839639:{name:"codecSettings",value:e.DataType.string},3883072:{name:"codecInfoUrl",value:e.DataType.string},2536e3:{name:"codecDownloadUrl",value:e.DataType.string},170:{name:"codecDecodeAll",value:e.DataType.bool},28587:{name:"trackOverlay",value:e.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:e.DataType.bool},21432:{name:"stereoMode",value:e.DataType.uint},176:{name:"pixelWidth",value:e.DataType.uint},186:{name:"pixelHeight",value:e.DataType.uint},21680:{name:"displayWidth",value:e.DataType.uint},21690:{name:"displayHeight",value:e.DataType.uint},21683:{name:"aspectRatioType",value:e.DataType.uint},3061028:{name:"colourSpace",value:e.DataType.uint},3126563:{name:"gammaValue",value:e.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:e.DataType.float},30901:{name:"outputSamplingFrequency",value:e.DataType.float},159:{name:"channels",value:e.DataType.uint},148:{name:"channels",value:e.DataType.uint},32123:{name:"channelPositions",value:e.DataType.binary},25188:{name:"bitDepth",value:e.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:e.DataType.uint},20530:{name:"scope",value:e.DataType.bool},20531:{name:"type",value:e.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:e.DataType.uint},16981:{name:"contentCompSettings",value:e.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:e.DataType.uint},18402:{name:"contentEncKeyID",value:e.DataType.binary},18403:{name:"contentSignature ",value:e.DataType.binary},18404:{name:"ContentSigKeyID  ",value:e.DataType.binary},18405:{name:"contentSigAlgo ",value:e.DataType.uint},18406:{name:"contentSigHashAlgo ",value:e.DataType.uint}}},25188:{name:"bitDepth",value:e.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:e.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:e.DataType.uint},241:{name:"clusterPosition",value:e.DataType.uint},21368:{name:"blockNumber",value:e.DataType.uint},234:{name:"codecState",value:e.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:e.DataType.uint},151:{name:"cluster",value:e.DataType.uint},21343:{name:"number",value:e.DataType.uint},235:{name:"codecState",value:e.DataType.uint}}},240:{name:"relativePosition",value:e.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:e.DataType.string},18030:{name:"name",value:e.DataType.string},18016:{name:"mimeType",value:e.DataType.string},18012:{name:"data",value:e.DataType.binary},18094:{name:"uid",value:e.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:e.DataType.uid},145:{name:"timeStart",value:e.DataType.uint},146:{name:"timeEnd",value:e.DataType.uid},152:{name:"hidden",value:e.DataType.bool},17816:{name:"enabled",value:e.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:e.DataType.uid},128:{name:"display",container:{133:{name:"string",value:e.DataType.string},17276:{name:"language ",value:e.DataType.string},17278:{name:"country ",value:e.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:e.DataType.uid},25540:{name:"tagChapterUID",value:e.DataType.uint},25542:{name:"tagAttachmentUID",value:e.DataType.uid},25546:{name:"targetType",value:e.DataType.string},26826:{name:"targetTypeValue",value:e.DataType.uint},25545:{name:"tagEditionUID",value:e.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:e.DataType.string},17543:{name:"string",value:e.DataType.string},17541:{name:"binary",value:e.DataType.binary},17530:{name:"language",value:e.DataType.string},17531:{name:"languageIETF",value:e.DataType.string},17540:{name:"default",value:e.DataType.bool}}}}}}}}}},MatroskaDtd}var hasRequiredMatroskaParser;function requireMatroskaParser(){if(hasRequiredMatroskaParser)return MatroskaParser;hasRequiredMatroskaParser=1,Object.defineProperty(MatroskaParser,"__esModule",{value:!0}),MatroskaParser.MatroskaParser=void 0;const e=requireLib$2(),r=requireBrowser$3(),o=requireBasicParser(),t=requireTypes(),c=requireMatroskaDtd(),h=(0,r.default)("music-metadata:parser:matroska");let l=class extends o.BasicParser{constructor(){super(),this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.parserMap.set(t.DataType.uint,p=>this.readUint(p)),this.parserMap.set(t.DataType.string,p=>this.readString(p)),this.parserMap.set(t.DataType.binary,p=>this.readBuffer(p)),this.parserMap.set(t.DataType.uid,async p=>await this.readUint(p)===1),this.parserMap.set(t.DataType.bool,p=>this.readFlag(p)),this.parserMap.set(t.DataType.float,p=>this.readFloat(p))}init(p,s,d){return super.init(p,s,d),this}async parse(){const p=await this.parseContainer(c.elements,this.tokenizer.fileInfo.size,[]);if(this.metadata.setFormat("container",`EBML/${p.ebml.docType}`),p.segment){const s=p.segment.info;if(s){const m=s.timecodeScale?s.timecodeScale:1e6;if(typeof s.duration=="number"){const u=s.duration*m/1e9;this.addTag("segment:title",s.title),this.metadata.setFormat("duration",u)}}const d=p.segment.tracks;if(d&&d.entries){d.entries.forEach(u=>{const a={codecName:u.codecID.replace("A_","").replace("V_",""),codecSettings:u.codecSettings,flagDefault:u.flagDefault,flagLacing:u.flagLacing,flagEnabled:u.flagEnabled,language:u.language,name:u.name,type:u.trackType,audio:u.audio,video:u.video};this.metadata.addStreamInfo(a)});const m=d.entries.filter(u=>u.trackType===t.TrackType.audio.valueOf()).reduce((u,a)=>!u||!u.flagDefault&&a.flagDefault||a.trackNumber&&a.trackNumber<u.trackNumber?a:u,null);m&&(this.metadata.setFormat("codec",m.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",m.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",m.audio.channels)),p.segment.tags&&p.segment.tags.tag.forEach(u=>{const a=u.target,g=a!=null&&a.targetTypeValue?t.TargetType[a.targetTypeValue]:a!=null&&a.targetType?a.targetType:"track";u.simpleTags.forEach(b=>{const y=b.string?b.string:b.binary;this.addTag(`${g}:${b.name}`,y)})}),p.segment.attachments&&p.segment.attachments.attachedFiles.filter(u=>u.mimeType.startsWith("image/")).map(u=>({data:u.data,format:u.mimeType,description:u.description,name:u.name})).forEach(u=>{this.addTag("picture",u)})}}}async parseContainer(p,s,d){const m={};for(;this.tokenizer.position<s;){let u;try{u=await this.readElement()}catch(g){if(g.message==="End-Of-Stream")break;throw g}const a=p[u.id];if(a)if(h(`Element: name=${a.name}, container=${!!a.container}`),a.container){const g=await this.parseContainer(a.container,u.len>=0?this.tokenizer.position+u.len:-1,d.concat([a.name]));a.multiple?(m[a.name]||(m[a.name]=[]),m[a.name].push(g)):m[a.name]=g}else m[a.name]=await this.parserMap.get(a.value)(u);else switch(u.id){case 236:this.padding+=u.len,await this.tokenizer.ignore(u.len);break;default:h(`parseEbml: path=${d.join("/")}, unknown element: id=${u.id.toString(16)}`),this.padding+=u.len,await this.tokenizer.ignore(u.len)}}return m}async readVintData(p){const s=await this.tokenizer.peekNumber(e.UINT8);let d=128,m=1;for(;(s&d)===0;){if(m>p)throw new Error("VINT value exceeding maximum size");++m,d>>=1}const u=Buffer.alloc(m);return await this.tokenizer.readBuffer(u),u}async readElement(){const p=await this.readVintData(this.ebmlMaxIDLength),s=await this.readVintData(this.ebmlMaxSizeLength);s[0]^=128>>s.length-1;const d=Math.min(6,s.length);return{id:p.readUIntBE(0,p.length),len:s.readUIntBE(s.length-d,d)}}isMaxValue(p){if(p.length===this.ebmlMaxSizeLength){for(let s=1;s<this.ebmlMaxSizeLength;++s)if(p[s]!==255)return!1;return!0}return!1}async readFloat(p){switch(p.len){case 0:return 0;case 4:return this.tokenizer.readNumber(e.Float32_BE);case 8:return this.tokenizer.readNumber(e.Float64_BE);case 10:return this.tokenizer.readNumber(e.Float64_BE);default:throw new Error(`Invalid IEEE-754 float length: ${p.len}`)}}async readFlag(p){return await this.readUint(p)===1}async readUint(p){const s=await this.readBuffer(p),d=Math.min(6,p.len);return s.readUIntBE(p.len-d,d)}async readString(p){return(await this.tokenizer.readToken(new e.StringType(p.len,"utf-8"))).replace(/\00.*$/g,"")}async readBuffer(p){const s=Buffer.alloc(p.len);return await this.tokenizer.readBuffer(s),s}addTag(p,s){this.metadata.addTag("matroska",p,s)}};return MatroskaParser.MatroskaParser=l,MatroskaParser}var hasRequiredParserFactory;function requireParserFactory(){if(hasRequiredParserFactory)return ParserFactory;hasRequiredParserFactory=1,Object.defineProperty(ParserFactory,"__esModule",{value:!0}),ParserFactory.ParserFactory=ParserFactory.parseHttpContentType=void 0;const e=requireCore$1(),r=requireContentType(),o=requireMediaTyper(),t=requireBrowser$3(),c=requireMetadataCollector(),h=requireAiffParser(),l=requireAPEv2Parser(),i=requireAsfParser(),p=requireFlacParser(),s=requireMP4Parser(),d=requireMpegParser(),m=requireMusepack(),u=requireOggParser(),a=requireWaveParser(),g=requireWavPackParser(),b=requireDsfParser(),y=requireDsdiffParser(),T=requireMatroskaParser(),E=(0,t.default)("music-metadata:parser:factory");function x(A){const w=r.parse(A),S=o.parse(w.type);return{type:S.type,subtype:S.subtype,suffix:S.suffix,parameters:w.parameters}}ParserFactory.parseHttpContentType=x;async function R(A,w,S={}){const j=await P.loadParser(w),M=new c.MetadataCollector(S);return await j.init(M,A,S).parse(),M.toCommonMetadata()}let P=class qe{static async parseOnContentType(w,S){const{mimeType:j,path:M,url:q}=await w.fileInfo,U=qe.getParserIdForMimeType(j)||qe.getParserIdForExtension(M)||qe.getParserIdForExtension(q);return U||E("No parser found for MIME-type / extension: "+j),this.parse(w,U,S)}static async parse(w,S,j){if(!S){E("Guess parser on content...");const M=Buffer.alloc(4100);if(await w.peekBuffer(M,{mayBeLess:!0}),w.fileInfo.path&&(S=this.getParserIdForExtension(w.fileInfo.path)),!S){const q=await e.fromBuffer(M);if(!q)throw new Error("Failed to determine audio format");if(E(`Guessed file type is mime=${q.mime}, extension=${q.ext}`),S=qe.getParserIdForMimeType(q.mime),!S)throw new Error("Guessed MIME-type not supported: "+q.mime)}}return R(w,S,j)}static getParserIdForExtension(w){if(!w)return;switch(this.getExtension(w).toLocaleLowerCase()||w){case".mp2":case".mp3":case".m2a":case".aac":return"mpeg";case".ape":return"apev2";case".mp4":case".m4a":case".m4b":case".m4pa":case".m4v":case".m4r":case".3gp":return"mp4";case".wma":case".wmv":case".asf":return"asf";case".flac":return"flac";case".ogg":case".ogv":case".oga":case".ogm":case".ogx":case".opus":case".spx":return"ogg";case".aif":case".aiff":case".aifc":return"aiff";case".wav":case".bwf":return"riff";case".wv":case".wvp":return"wavpack";case".mpc":return"musepack";case".dsf":return"dsf";case".dff":return"dsdiff";case".mka":case".mkv":case".mk3d":case".mks":case".webm":return"matroska"}}static async loadParser(w){switch(w){case"aiff":return new h.AIFFParser;case"adts":case"mpeg":return new d.MpegParser;case"apev2":return new l.APEv2Parser;case"asf":return new i.AsfParser;case"dsf":return new b.DsfParser;case"dsdiff":return new y.DsdiffParser;case"flac":return new p.FlacParser;case"mp4":return new s.MP4Parser;case"musepack":return new m.default;case"ogg":return new u.OggParser;case"riff":return new a.WaveParser;case"wavpack":return new g.WavPackParser;case"matroska":return new T.MatroskaParser;default:throw new Error(`Unknown parser type: ${w}`)}}static getExtension(w){const S=w.lastIndexOf(".");return S===-1?"":w.slice(S)}static getParserIdForMimeType(w){let S;try{S=x(w)}catch{E(`Invalid HTTP Content-Type header value: ${w}`);return}const j=S.subtype.indexOf("x-")===0?S.subtype.substring(2):S.subtype;switch(S.type){case"audio":switch(j){case"mp3":case"mpeg":return"mpeg";case"aac":case"aacp":return"adts";case"flac":return"flac";case"ape":case"monkeys-audio":return"apev2";case"mp4":case"m4a":return"mp4";case"ogg":case"opus":case"speex":return"ogg";case"ms-wma":case"ms-wmv":case"ms-asf":return"asf";case"aiff":case"aif":case"aifc":return"aiff";case"vnd.wave":case"wav":case"wave":return"riff";case"wavpack":return"wavpack";case"musepack":return"musepack";case"matroska":case"webm":return"matroska";case"dsf":return"dsf"}break;case"video":switch(j){case"ms-asf":case"ms-wmv":return"asf";case"m4v":case"mp4":return"mp4";case"ogg":return"ogg";case"matroska":case"webm":return"matroska"}break;case"application":switch(j){case"vnd.ms-asf":return"asf";case"ogg":return"ogg"}break}}};return ParserFactory.ParserFactory=P,ParserFactory}var RandomUint8ArrayReader={},hasRequiredRandomUint8ArrayReader;function requireRandomUint8ArrayReader(){if(hasRequiredRandomUint8ArrayReader)return RandomUint8ArrayReader;hasRequiredRandomUint8ArrayReader=1,Object.defineProperty(RandomUint8ArrayReader,"__esModule",{value:!0}),RandomUint8ArrayReader.RandomUint8ArrayReader=void 0;let e=class{constructor(o){this.uint8Array=o,this.fileSize=o.length}async randomRead(o,t,c,h){return o.set(this.uint8Array.subarray(h,h+c),t),c}};return RandomUint8ArrayReader.RandomUint8ArrayReader=e,RandomUint8ArrayReader}var Lyrics3={},hasRequiredLyrics3;function requireLyrics3(){return hasRequiredLyrics3||(hasRequiredLyrics3=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getLyricsHeaderLength=e.endTag2=void 0,e.endTag2="LYRICS200";async function r(o){if(o.fileSize>=143){const t=Buffer.alloc(15);await o.randomRead(t,0,t.length,o.fileSize-143);const c=t.toString("binary");if(c.substr(6)===e.endTag2)return parseInt(c.substr(0,6),10)+15}return 0}e.getLyricsHeaderLength=r})(Lyrics3)),Lyrics3}var hasRequiredCore;function requireCore(){if(hasRequiredCore)return core$2;hasRequiredCore=1,Object.defineProperty(core$2,"__esModule",{value:!0}),core$2.scanAppendingHeaders=core$2.selectCover=core$2.ratingToStars=core$2.orderTags=core$2.parseFromTokenizer=core$2.parseBuffer=core$2.parseStream=void 0;const e=requireCore$2(),r=requireParserFactory(),o=requireRandomUint8ArrayReader(),t=requireAPEv2Parser(),c=requireID3v1Parser(),h=requireLyrics3();function l(a,g,b={}){return p(e.fromStream(a,typeof g=="string"?{mimeType:g}:g),b)}core$2.parseStream=l;async function i(a,g,b={}){const y=new o.RandomUint8ArrayReader(a);await u(y,b);const T=e.fromBuffer(a,typeof g=="string"?{mimeType:g}:g);return p(T,b)}core$2.parseBuffer=i;function p(a,g){return r.ParserFactory.parseOnContentType(a,g)}core$2.parseFromTokenizer=p;function s(a){const g={};for(const b of a)(g[b.id]=g[b.id]||[]).push(b.value);return g}core$2.orderTags=s;function d(a){return a===void 0?0:1+Math.round(a*4)}core$2.ratingToStars=d;function m(a){return a?a.reduce((g,b)=>b.name&&b.name.toLowerCase()in["front","cover","cover (front)"]?b:g):null}core$2.selectCover=m;async function u(a,g={}){let b=a.fileSize;if(await(0,c.hasID3v1Header)(a)){b-=128;const y=await(0,h.getLyricsHeaderLength)(a);b-=y}g.apeHeader=await t.APEv2Parser.findApeFooterOffset(a,b)}return core$2.scanAppendingHeaders=u,core$2}var lib={},browser$2={exports:{}},stream={exports:{}},buffer={},base64Js={},hasRequiredBase64Js;function requireBase64Js(){if(hasRequiredBase64Js)return base64Js;hasRequiredBase64Js=1,base64Js.byteLength=i,base64Js.toByteArray=s,base64Js.fromByteArray=u;for(var e=[],r=[],o=typeof Uint8Array<"u"?Uint8Array:Array,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,h=t.length;c<h;++c)e[c]=t[c],r[t.charCodeAt(c)]=c;r[45]=62,r[95]=63;function l(a){var g=a.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=a.indexOf("=");b===-1&&(b=g);var y=b===g?0:4-b%4;return[b,y]}function i(a){var g=l(a),b=g[0],y=g[1];return(b+y)*3/4-y}function p(a,g,b){return(g+b)*3/4-b}function s(a){var g,b=l(a),y=b[0],T=b[1],E=new o(p(a,y,T)),x=0,R=T>0?y-4:y,P;for(P=0;P<R;P+=4)g=r[a.charCodeAt(P)]<<18|r[a.charCodeAt(P+1)]<<12|r[a.charCodeAt(P+2)]<<6|r[a.charCodeAt(P+3)],E[x++]=g>>16&255,E[x++]=g>>8&255,E[x++]=g&255;return T===2&&(g=r[a.charCodeAt(P)]<<2|r[a.charCodeAt(P+1)]>>4,E[x++]=g&255),T===1&&(g=r[a.charCodeAt(P)]<<10|r[a.charCodeAt(P+1)]<<4|r[a.charCodeAt(P+2)]>>2,E[x++]=g>>8&255,E[x++]=g&255),E}function d(a){return e[a>>18&63]+e[a>>12&63]+e[a>>6&63]+e[a&63]}function m(a,g,b){for(var y,T=[],E=g;E<b;E+=3)y=(a[E]<<16&16711680)+(a[E+1]<<8&65280)+(a[E+2]&255),T.push(d(y));return T.join("")}function u(a){for(var g,b=a.length,y=b%3,T=[],E=16383,x=0,R=b-y;x<R;x+=E)T.push(m(a,x,x+E>R?R:x+E));return y===1?(g=a[b-1],T.push(e[g>>2]+e[g<<4&63]+"==")):y===2&&(g=(a[b-2]<<8)+a[b-1],T.push(e[g>>10]+e[g>>4&63]+e[g<<2&63]+"=")),T.join("")}return base64Js}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var hasRequiredBuffer;function requireBuffer(){return hasRequiredBuffer||(hasRequiredBuffer=1,(function(e){const r=requireBase64Js(),o=requireIeee754(),t=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=i,e.SlowBuffer=E,e.INSPECT_MAX_BYTES=50;const c=2147483647;e.kMaxLength=c,i.TYPED_ARRAY_SUPPORT=h(),!i.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{const _=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(_,n),_.foo()===42}catch{return!1}}Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}});function l(_){if(_>c)throw new RangeError('The value "'+_+'" is invalid for option "size"');const n=new Uint8Array(_);return Object.setPrototypeOf(n,i.prototype),n}function i(_,n,f){if(typeof _=="number"){if(typeof n=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(_)}return p(_,n,f)}i.poolSize=8192;function p(_,n,f){if(typeof _=="string")return u(_,n);if(ArrayBuffer.isView(_))return g(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(G(_,ArrayBuffer)||_&&G(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(G(_,SharedArrayBuffer)||_&&G(_.buffer,SharedArrayBuffer)))return b(_,n,f);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const k=_.valueOf&&_.valueOf();if(k!=null&&k!==_)return i.from(k,n,f);const B=y(_);if(B)return B;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return i.from(_[Symbol.toPrimitive]("string"),n,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}i.from=function(_,n,f){return p(_,n,f)},Object.setPrototypeOf(i.prototype,Uint8Array.prototype),Object.setPrototypeOf(i,Uint8Array);function s(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function d(_,n,f){return s(_),_<=0?l(_):n!==void 0?typeof f=="string"?l(_).fill(n,f):l(_).fill(n):l(_)}i.alloc=function(_,n,f){return d(_,n,f)};function m(_){return s(_),l(_<0?0:T(_)|0)}i.allocUnsafe=function(_){return m(_)},i.allocUnsafeSlow=function(_){return m(_)};function u(_,n){if((typeof n!="string"||n==="")&&(n="utf8"),!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n);const f=x(_,n)|0;let k=l(f);const B=k.write(_,n);return B!==f&&(k=k.slice(0,B)),k}function a(_){const n=_.length<0?0:T(_.length)|0,f=l(n);for(let k=0;k<n;k+=1)f[k]=_[k]&255;return f}function g(_){if(G(_,Uint8Array)){const n=new Uint8Array(_);return b(n.buffer,n.byteOffset,n.byteLength)}return a(_)}function b(_,n,f){if(n<0||_.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<n+(f||0))throw new RangeError('"length" is outside of buffer bounds');let k;return n===void 0&&f===void 0?k=new Uint8Array(_):f===void 0?k=new Uint8Array(_,n):k=new Uint8Array(_,n,f),Object.setPrototypeOf(k,i.prototype),k}function y(_){if(i.isBuffer(_)){const n=T(_.length)|0,f=l(n);return f.length===0||_.copy(f,0,0,n),f}if(_.length!==void 0)return typeof _.length!="number"||ye(_.length)?l(0):a(_);if(_.type==="Buffer"&&Array.isArray(_.data))return a(_.data)}function T(_){if(_>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return _|0}function E(_){return+_!=_&&(_=0),i.alloc(+_)}i.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==i.prototype},i.compare=function(n,f){if(G(n,Uint8Array)&&(n=i.from(n,n.offset,n.byteLength)),G(f,Uint8Array)&&(f=i.from(f,f.offset,f.byteLength)),!i.isBuffer(n)||!i.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===f)return 0;let k=n.length,B=f.length;for(let N=0,X=Math.min(k,B);N<X;++N)if(n[N]!==f[N]){k=n[N],B=f[N];break}return k<B?-1:B<k?1:0},i.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(n,f){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return i.alloc(0);let k;if(f===void 0)for(f=0,k=0;k<n.length;++k)f+=n[k].length;const B=i.allocUnsafe(f);let N=0;for(k=0;k<n.length;++k){let X=n[k];if(G(X,Uint8Array))N+X.length>B.length?(i.isBuffer(X)||(X=i.from(X)),X.copy(B,N)):Uint8Array.prototype.set.call(B,X,N);else if(i.isBuffer(X))X.copy(B,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=X.length}return B};function x(_,n){if(i.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||G(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);const f=_.length,k=arguments.length>2&&arguments[2]===!0;if(!k&&f===0)return 0;let B=!1;for(;;)switch(n){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return Q(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f*2;case"hex":return f>>>1;case"base64":return Z(_).length;default:if(B)return k?-1:Q(_).length;n=(""+n).toLowerCase(),B=!0}}i.byteLength=x;function R(_,n,f){let k=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((f===void 0||f>this.length)&&(f=this.length),f<=0)||(f>>>=0,n>>>=0,f<=n))return"";for(_||(_="utf8");;)switch(_){case"hex":return le(this,n,f);case"utf8":case"utf-8":return te(this,n,f);case"ascii":return me(this,n,f);case"latin1":case"binary":return $(this,n,f);case"base64":return O(this,n,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,n,f);default:if(k)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),k=!0}}i.prototype._isBuffer=!0;function P(_,n,f){const k=_[n];_[n]=_[f],_[f]=k}i.prototype.swap16=function(){const n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let f=0;f<n;f+=2)P(this,f,f+1);return this},i.prototype.swap32=function(){const n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let f=0;f<n;f+=4)P(this,f,f+3),P(this,f+1,f+2);return this},i.prototype.swap64=function(){const n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let f=0;f<n;f+=8)P(this,f,f+7),P(this,f+1,f+6),P(this,f+2,f+5),P(this,f+3,f+4);return this},i.prototype.toString=function(){const n=this.length;return n===0?"":arguments.length===0?te(this,0,n):R.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(n){if(!i.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:i.compare(this,n)===0},i.prototype.inspect=function(){let n="";const f=e.INSPECT_MAX_BYTES;return n=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(n+=" ... "),"<Buffer "+n+">"},t&&(i.prototype[t]=i.prototype.inspect),i.prototype.compare=function(n,f,k,B,N){if(G(n,Uint8Array)&&(n=i.from(n,n.offset,n.byteLength)),!i.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(f===void 0&&(f=0),k===void 0&&(k=n?n.length:0),B===void 0&&(B=0),N===void 0&&(N=this.length),f<0||k>n.length||B<0||N>this.length)throw new RangeError("out of range index");if(B>=N&&f>=k)return 0;if(B>=N)return-1;if(f>=k)return 1;if(f>>>=0,k>>>=0,B>>>=0,N>>>=0,this===n)return 0;let X=N-B,ge=k-f;const Ee=Math.min(X,ge),_e=this.slice(B,N),Se=n.slice(f,k);for(let we=0;we<Ee;++we)if(_e[we]!==Se[we]){X=_e[we],ge=Se[we];break}return X<ge?-1:ge<X?1:0};function A(_,n,f,k,B){if(_.length===0)return-1;if(typeof f=="string"?(k=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,ye(f)&&(f=B?0:_.length-1),f<0&&(f=_.length+f),f>=_.length){if(B)return-1;f=_.length-1}else if(f<0)if(B)f=0;else return-1;if(typeof n=="string"&&(n=i.from(n,k)),i.isBuffer(n))return n.length===0?-1:w(_,n,f,k,B);if(typeof n=="number")return n=n&255,typeof Uint8Array.prototype.indexOf=="function"?B?Uint8Array.prototype.indexOf.call(_,n,f):Uint8Array.prototype.lastIndexOf.call(_,n,f):w(_,[n],f,k,B);throw new TypeError("val must be string, number or Buffer")}function w(_,n,f,k,B){let N=1,X=_.length,ge=n.length;if(k!==void 0&&(k=String(k).toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(_.length<2||n.length<2)return-1;N=2,X/=2,ge/=2,f/=2}function Ee(Se,we){return N===1?Se[we]:Se.readUInt16BE(we*N)}let _e;if(B){let Se=-1;for(_e=f;_e<X;_e++)if(Ee(_,_e)===Ee(n,Se===-1?0:_e-Se)){if(Se===-1&&(Se=_e),_e-Se+1===ge)return Se*N}else Se!==-1&&(_e-=_e-Se),Se=-1}else for(f+ge>X&&(f=X-ge),_e=f;_e>=0;_e--){let Se=!0;for(let we=0;we<ge;we++)if(Ee(_,_e+we)!==Ee(n,we)){Se=!1;break}if(Se)return _e}return-1}i.prototype.includes=function(n,f,k){return this.indexOf(n,f,k)!==-1},i.prototype.indexOf=function(n,f,k){return A(this,n,f,k,!0)},i.prototype.lastIndexOf=function(n,f,k){return A(this,n,f,k,!1)};function S(_,n,f,k){f=Number(f)||0;const B=_.length-f;k?(k=Number(k),k>B&&(k=B)):k=B;const N=n.length;k>N/2&&(k=N/2);let X;for(X=0;X<k;++X){const ge=parseInt(n.substr(X*2,2),16);if(ye(ge))return X;_[f+X]=ge}return X}function j(_,n,f,k){return K(Q(n,_.length-f),_,f,k)}function M(_,n,f,k){return K(ee(n),_,f,k)}function q(_,n,f,k){return K(Z(n),_,f,k)}function U(_,n,f,k){return K(F(n,_.length-f),_,f,k)}i.prototype.write=function(n,f,k,B){if(f===void 0)B="utf8",k=this.length,f=0;else if(k===void 0&&typeof f=="string")B=f,k=this.length,f=0;else if(isFinite(f))f=f>>>0,isFinite(k)?(k=k>>>0,B===void 0&&(B="utf8")):(B=k,k=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-f;if((k===void 0||k>N)&&(k=N),n.length>0&&(k<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");B||(B="utf8");let X=!1;for(;;)switch(B){case"hex":return S(this,n,f,k);case"utf8":case"utf-8":return j(this,n,f,k);case"ascii":case"latin1":case"binary":return M(this,n,f,k);case"base64":return q(this,n,f,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,n,f,k);default:if(X)throw new TypeError("Unknown encoding: "+B);B=(""+B).toLowerCase(),X=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(_,n,f){return n===0&&f===_.length?r.fromByteArray(_):r.fromByteArray(_.slice(n,f))}function te(_,n,f){f=Math.min(_.length,f);const k=[];let B=n;for(;B<f;){const N=_[B];let X=null,ge=N>239?4:N>223?3:N>191?2:1;if(B+ge<=f){let Ee,_e,Se,we;switch(ge){case 1:N<128&&(X=N);break;case 2:Ee=_[B+1],(Ee&192)===128&&(we=(N&31)<<6|Ee&63,we>127&&(X=we));break;case 3:Ee=_[B+1],_e=_[B+2],(Ee&192)===128&&(_e&192)===128&&(we=(N&15)<<12|(Ee&63)<<6|_e&63,we>2047&&(we<55296||we>57343)&&(X=we));break;case 4:Ee=_[B+1],_e=_[B+2],Se=_[B+3],(Ee&192)===128&&(_e&192)===128&&(Se&192)===128&&(we=(N&15)<<18|(Ee&63)<<12|(_e&63)<<6|Se&63,we>65535&&we<1114112&&(X=we))}}X===null?(X=65533,ge=1):X>65535&&(X-=65536,k.push(X>>>10&1023|55296),X=56320|X&1023),k.push(X),B+=ge}return oe(k)}const se=4096;function oe(_){const n=_.length;if(n<=se)return String.fromCharCode.apply(String,_);let f="",k=0;for(;k<n;)f+=String.fromCharCode.apply(String,_.slice(k,k+=se));return f}function me(_,n,f){let k="";f=Math.min(_.length,f);for(let B=n;B<f;++B)k+=String.fromCharCode(_[B]&127);return k}function $(_,n,f){let k="";f=Math.min(_.length,f);for(let B=n;B<f;++B)k+=String.fromCharCode(_[B]);return k}function le(_,n,f){const k=_.length;(!n||n<0)&&(n=0),(!f||f<0||f>k)&&(f=k);let B="";for(let N=n;N<f;++N)B+=Ie[_[N]];return B}function C(_,n,f){const k=_.slice(n,f);let B="";for(let N=0;N<k.length-1;N+=2)B+=String.fromCharCode(k[N]+k[N+1]*256);return B}i.prototype.slice=function(n,f){const k=this.length;n=~~n,f=f===void 0?k:~~f,n<0?(n+=k,n<0&&(n=0)):n>k&&(n=k),f<0?(f+=k,f<0&&(f=0)):f>k&&(f=k),f<n&&(f=n);const B=this.subarray(n,f);return Object.setPrototypeOf(B,i.prototype),B};function W(_,n,f){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+n>f)throw new RangeError("Trying to access beyond buffer length")}i.prototype.readUintLE=i.prototype.readUIntLE=function(n,f,k){n=n>>>0,f=f>>>0,k||W(n,f,this.length);let B=this[n],N=1,X=0;for(;++X<f&&(N*=256);)B+=this[n+X]*N;return B},i.prototype.readUintBE=i.prototype.readUIntBE=function(n,f,k){n=n>>>0,f=f>>>0,k||W(n,f,this.length);let B=this[n+--f],N=1;for(;f>0&&(N*=256);)B+=this[n+--f]*N;return B},i.prototype.readUint8=i.prototype.readUInt8=function(n,f){return n=n>>>0,f||W(n,1,this.length),this[n]},i.prototype.readUint16LE=i.prototype.readUInt16LE=function(n,f){return n=n>>>0,f||W(n,2,this.length),this[n]|this[n+1]<<8},i.prototype.readUint16BE=i.prototype.readUInt16BE=function(n,f){return n=n>>>0,f||W(n,2,this.length),this[n]<<8|this[n+1]},i.prototype.readUint32LE=i.prototype.readUInt32LE=function(n,f){return n=n>>>0,f||W(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216},i.prototype.readUint32BE=i.prototype.readUInt32BE=function(n,f){return n=n>>>0,f||W(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])},i.prototype.readBigUInt64LE=Te(function(n){n=n>>>0,D(n,"offset");const f=this[n],k=this[n+7];(f===void 0||k===void 0)&&L(n,this.length-8);const B=f+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24,N=this[++n]+this[++n]*2**8+this[++n]*2**16+k*2**24;return BigInt(B)+(BigInt(N)<<BigInt(32))}),i.prototype.readBigUInt64BE=Te(function(n){n=n>>>0,D(n,"offset");const f=this[n],k=this[n+7];(f===void 0||k===void 0)&&L(n,this.length-8);const B=f*2**24+this[++n]*2**16+this[++n]*2**8+this[++n],N=this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+k;return(BigInt(B)<<BigInt(32))+BigInt(N)}),i.prototype.readIntLE=function(n,f,k){n=n>>>0,f=f>>>0,k||W(n,f,this.length);let B=this[n],N=1,X=0;for(;++X<f&&(N*=256);)B+=this[n+X]*N;return N*=128,B>=N&&(B-=Math.pow(2,8*f)),B},i.prototype.readIntBE=function(n,f,k){n=n>>>0,f=f>>>0,k||W(n,f,this.length);let B=f,N=1,X=this[n+--B];for(;B>0&&(N*=256);)X+=this[n+--B]*N;return N*=128,X>=N&&(X-=Math.pow(2,8*f)),X},i.prototype.readInt8=function(n,f){return n=n>>>0,f||W(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]},i.prototype.readInt16LE=function(n,f){n=n>>>0,f||W(n,2,this.length);const k=this[n]|this[n+1]<<8;return k&32768?k|4294901760:k},i.prototype.readInt16BE=function(n,f){n=n>>>0,f||W(n,2,this.length);const k=this[n+1]|this[n]<<8;return k&32768?k|4294901760:k},i.prototype.readInt32LE=function(n,f){return n=n>>>0,f||W(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},i.prototype.readInt32BE=function(n,f){return n=n>>>0,f||W(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},i.prototype.readBigInt64LE=Te(function(n){n=n>>>0,D(n,"offset");const f=this[n],k=this[n+7];(f===void 0||k===void 0)&&L(n,this.length-8);const B=this[n+4]+this[n+5]*2**8+this[n+6]*2**16+(k<<24);return(BigInt(B)<<BigInt(32))+BigInt(f+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24)}),i.prototype.readBigInt64BE=Te(function(n){n=n>>>0,D(n,"offset");const f=this[n],k=this[n+7];(f===void 0||k===void 0)&&L(n,this.length-8);const B=(f<<24)+this[++n]*2**16+this[++n]*2**8+this[++n];return(BigInt(B)<<BigInt(32))+BigInt(this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+k)}),i.prototype.readFloatLE=function(n,f){return n=n>>>0,f||W(n,4,this.length),o.read(this,n,!0,23,4)},i.prototype.readFloatBE=function(n,f){return n=n>>>0,f||W(n,4,this.length),o.read(this,n,!1,23,4)},i.prototype.readDoubleLE=function(n,f){return n=n>>>0,f||W(n,8,this.length),o.read(this,n,!0,52,8)},i.prototype.readDoubleBE=function(n,f){return n=n>>>0,f||W(n,8,this.length),o.read(this,n,!1,52,8)};function J(_,n,f,k,B,N){if(!i.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>B||n<N)throw new RangeError('"value" argument is out of bounds');if(f+k>_.length)throw new RangeError("Index out of range")}i.prototype.writeUintLE=i.prototype.writeUIntLE=function(n,f,k,B){if(n=+n,f=f>>>0,k=k>>>0,!B){const ge=Math.pow(2,8*k)-1;J(this,n,f,k,ge,0)}let N=1,X=0;for(this[f]=n&255;++X<k&&(N*=256);)this[f+X]=n/N&255;return f+k},i.prototype.writeUintBE=i.prototype.writeUIntBE=function(n,f,k,B){if(n=+n,f=f>>>0,k=k>>>0,!B){const ge=Math.pow(2,8*k)-1;J(this,n,f,k,ge,0)}let N=k-1,X=1;for(this[f+N]=n&255;--N>=0&&(X*=256);)this[f+N]=n/X&255;return f+k},i.prototype.writeUint8=i.prototype.writeUInt8=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,1,255,0),this[f]=n&255,f+1},i.prototype.writeUint16LE=i.prototype.writeUInt16LE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,2,65535,0),this[f]=n&255,this[f+1]=n>>>8,f+2},i.prototype.writeUint16BE=i.prototype.writeUInt16BE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,2,65535,0),this[f]=n>>>8,this[f+1]=n&255,f+2},i.prototype.writeUint32LE=i.prototype.writeUInt32LE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,4,4294967295,0),this[f+3]=n>>>24,this[f+2]=n>>>16,this[f+1]=n>>>8,this[f]=n&255,f+4},i.prototype.writeUint32BE=i.prototype.writeUInt32BE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,4,4294967295,0),this[f]=n>>>24,this[f+1]=n>>>16,this[f+2]=n>>>8,this[f+3]=n&255,f+4};function V(_,n,f,k,B){fe(n,k,B,_,f,7);let N=Number(n&BigInt(4294967295));_[f++]=N,N=N>>8,_[f++]=N,N=N>>8,_[f++]=N,N=N>>8,_[f++]=N;let X=Number(n>>BigInt(32)&BigInt(4294967295));return _[f++]=X,X=X>>8,_[f++]=X,X=X>>8,_[f++]=X,X=X>>8,_[f++]=X,f}function ue(_,n,f,k,B){fe(n,k,B,_,f,7);let N=Number(n&BigInt(4294967295));_[f+7]=N,N=N>>8,_[f+6]=N,N=N>>8,_[f+5]=N,N=N>>8,_[f+4]=N;let X=Number(n>>BigInt(32)&BigInt(4294967295));return _[f+3]=X,X=X>>8,_[f+2]=X,X=X>>8,_[f+1]=X,X=X>>8,_[f]=X,f+8}i.prototype.writeBigUInt64LE=Te(function(n,f=0){return V(this,n,f,BigInt(0),BigInt("0xffffffffffffffff"))}),i.prototype.writeBigUInt64BE=Te(function(n,f=0){return ue(this,n,f,BigInt(0),BigInt("0xffffffffffffffff"))}),i.prototype.writeIntLE=function(n,f,k,B){if(n=+n,f=f>>>0,!B){const Ee=Math.pow(2,8*k-1);J(this,n,f,k,Ee-1,-Ee)}let N=0,X=1,ge=0;for(this[f]=n&255;++N<k&&(X*=256);)n<0&&ge===0&&this[f+N-1]!==0&&(ge=1),this[f+N]=(n/X>>0)-ge&255;return f+k},i.prototype.writeIntBE=function(n,f,k,B){if(n=+n,f=f>>>0,!B){const Ee=Math.pow(2,8*k-1);J(this,n,f,k,Ee-1,-Ee)}let N=k-1,X=1,ge=0;for(this[f+N]=n&255;--N>=0&&(X*=256);)n<0&&ge===0&&this[f+N+1]!==0&&(ge=1),this[f+N]=(n/X>>0)-ge&255;return f+k},i.prototype.writeInt8=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,1,127,-128),n<0&&(n=255+n+1),this[f]=n&255,f+1},i.prototype.writeInt16LE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,2,32767,-32768),this[f]=n&255,this[f+1]=n>>>8,f+2},i.prototype.writeInt16BE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,2,32767,-32768),this[f]=n>>>8,this[f+1]=n&255,f+2},i.prototype.writeInt32LE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,4,2147483647,-2147483648),this[f]=n&255,this[f+1]=n>>>8,this[f+2]=n>>>16,this[f+3]=n>>>24,f+4},i.prototype.writeInt32BE=function(n,f,k){return n=+n,f=f>>>0,k||J(this,n,f,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[f]=n>>>24,this[f+1]=n>>>16,this[f+2]=n>>>8,this[f+3]=n&255,f+4},i.prototype.writeBigInt64LE=Te(function(n,f=0){return V(this,n,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),i.prototype.writeBigInt64BE=Te(function(n,f=0){return ue(this,n,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de(_,n,f,k,B,N){if(f+k>_.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function be(_,n,f,k,B){return n=+n,f=f>>>0,B||de(_,n,f,4),o.write(_,n,f,k,23,4),f+4}i.prototype.writeFloatLE=function(n,f,k){return be(this,n,f,!0,k)},i.prototype.writeFloatBE=function(n,f,k){return be(this,n,f,!1,k)};function he(_,n,f,k,B){return n=+n,f=f>>>0,B||de(_,n,f,8),o.write(_,n,f,k,52,8),f+8}i.prototype.writeDoubleLE=function(n,f,k){return he(this,n,f,!0,k)},i.prototype.writeDoubleBE=function(n,f,k){return he(this,n,f,!1,k)},i.prototype.copy=function(n,f,k,B){if(!i.isBuffer(n))throw new TypeError("argument should be a Buffer");if(k||(k=0),!B&&B!==0&&(B=this.length),f>=n.length&&(f=n.length),f||(f=0),B>0&&B<k&&(B=k),B===k||n.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(k<0||k>=this.length)throw new RangeError("Index out of range");if(B<0)throw new RangeError("sourceEnd out of bounds");B>this.length&&(B=this.length),n.length-f<B-k&&(B=n.length-f+k);const N=B-k;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(f,k,B):Uint8Array.prototype.set.call(n,this.subarray(k,B),f),N},i.prototype.fill=function(n,f,k,B){if(typeof n=="string"){if(typeof f=="string"?(B=f,f=0,k=this.length):typeof k=="string"&&(B=k,k=this.length),B!==void 0&&typeof B!="string")throw new TypeError("encoding must be a string");if(typeof B=="string"&&!i.isEncoding(B))throw new TypeError("Unknown encoding: "+B);if(n.length===1){const X=n.charCodeAt(0);(B==="utf8"&&X<128||B==="latin1")&&(n=X)}}else typeof n=="number"?n=n&255:typeof n=="boolean"&&(n=Number(n));if(f<0||this.length<f||this.length<k)throw new RangeError("Out of range index");if(k<=f)return this;f=f>>>0,k=k===void 0?this.length:k>>>0,n||(n=0);let N;if(typeof n=="number")for(N=f;N<k;++N)this[N]=n;else{const X=i.isBuffer(n)?n:i.from(n,B),ge=X.length;if(ge===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(N=0;N<k-f;++N)this[N+f]=X[N%ge]}return this};const H={};function Y(_,n,f){H[_]=class extends f{constructor(){super(),Object.defineProperty(this,"message",{value:n.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(B){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:B,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}Y("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Y("ERR_INVALID_ARG_TYPE",function(_,n){return`The "${_}" argument must be of type number. Received type ${typeof n}`},TypeError),Y("ERR_OUT_OF_RANGE",function(_,n,f){let k=`The value of "${_}" is out of range.`,B=f;return Number.isInteger(f)&&Math.abs(f)>2**32?B=ne(String(f)):typeof f=="bigint"&&(B=String(f),(f>BigInt(2)**BigInt(32)||f<-(BigInt(2)**BigInt(32)))&&(B=ne(B)),B+="n"),k+=` It must be ${n}. Received ${B}`,k},RangeError);function ne(_){let n="",f=_.length;const k=_[0]==="-"?1:0;for(;f>=k+4;f-=3)n=`_${_.slice(f-3,f)}${n}`;return`${_.slice(0,f)}${n}`}function pe(_,n,f){D(n,"offset"),(_[n]===void 0||_[n+f]===void 0)&&L(n,_.length-(f+1))}function fe(_,n,f,k,B,N){if(_>f||_<n){const X=typeof n=="bigint"?"n":"";let ge;throw n===0||n===BigInt(0)?ge=`>= 0${X} and < 2${X} ** ${(N+1)*8}${X}`:ge=`>= -(2${X} ** ${(N+1)*8-1}${X}) and < 2 ** ${(N+1)*8-1}${X}`,new H.ERR_OUT_OF_RANGE("value",ge,_)}pe(k,B,N)}function D(_,n){if(typeof _!="number")throw new H.ERR_INVALID_ARG_TYPE(n,"number",_)}function L(_,n,f){throw Math.floor(_)!==_?(D(_,f),new H.ERR_OUT_OF_RANGE("offset","an integer",_)):n<0?new H.ERR_BUFFER_OUT_OF_BOUNDS:new H.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${n}`,_)}const z=/[^+/0-9A-Za-z-_]/g;function re(_){if(_=_.split("=")[0],_=_.trim().replace(z,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function Q(_,n){n=n||1/0;let f;const k=_.length;let B=null;const N=[];for(let X=0;X<k;++X){if(f=_.charCodeAt(X),f>55295&&f<57344){if(!B){if(f>56319){(n-=3)>-1&&N.push(239,191,189);continue}else if(X+1===k){(n-=3)>-1&&N.push(239,191,189);continue}B=f;continue}if(f<56320){(n-=3)>-1&&N.push(239,191,189),B=f;continue}f=(B-55296<<10|f-56320)+65536}else B&&(n-=3)>-1&&N.push(239,191,189);if(B=null,f<128){if((n-=1)<0)break;N.push(f)}else if(f<2048){if((n-=2)<0)break;N.push(f>>6|192,f&63|128)}else if(f<65536){if((n-=3)<0)break;N.push(f>>12|224,f>>6&63|128,f&63|128)}else if(f<1114112){if((n-=4)<0)break;N.push(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}else throw new Error("Invalid code point")}return N}function ee(_){const n=[];for(let f=0;f<_.length;++f)n.push(_.charCodeAt(f)&255);return n}function F(_,n){let f,k,B;const N=[];for(let X=0;X<_.length&&!((n-=2)<0);++X)f=_.charCodeAt(X),k=f>>8,B=f%256,N.push(B),N.push(k);return N}function Z(_){return r.toByteArray(re(_))}function K(_,n,f,k){let B;for(B=0;B<k&&!(B+f>=n.length||B>=_.length);++B)n[B+f]=_[B];return B}function G(_,n){return _ instanceof n||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===n.name}function ye(_){return _!==_}const Ie=(function(){const _="0123456789abcdef",n=new Array(256);for(let f=0;f<16;++f){const k=f*16;for(let B=0;B<16;++B)n[k+B]=_[f]+_[B]}return n})();function Te(_){return typeof BigInt>"u"?xe:_}function xe(){throw new Error("BigInt not supported")}})(buffer)),buffer}var primordials,hasRequiredPrimordials;function requirePrimordials(){if(hasRequiredPrimordials)return primordials;hasRequiredPrimordials=1;class e extends Error{constructor(o){if(!Array.isArray(o))throw new TypeError(`Expected input to be an Array, got ${typeof o}`);let t="";for(let c=0;c<o.length;c++)t+=`    ${o[c].stack}
`;super(t),this.name="AggregateError",this.errors=o}}return primordials={AggregateError:e,ArrayIsArray(r){return Array.isArray(r)},ArrayPrototypeIncludes(r,o){return r.includes(o)},ArrayPrototypeIndexOf(r,o){return r.indexOf(o)},ArrayPrototypeJoin(r,o){return r.join(o)},ArrayPrototypeMap(r,o){return r.map(o)},ArrayPrototypePop(r,o){return r.pop(o)},ArrayPrototypePush(r,o){return r.push(o)},ArrayPrototypeSlice(r,o,t){return r.slice(o,t)},Error,FunctionPrototypeCall(r,o,...t){return r.call(o,...t)},FunctionPrototypeSymbolHasInstance(r,o){return Function.prototype[Symbol.hasInstance].call(r,o)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(r,o){return Object.defineProperties(r,o)},ObjectDefineProperty(r,o,t){return Object.defineProperty(r,o,t)},ObjectGetOwnPropertyDescriptor(r,o){return Object.getOwnPropertyDescriptor(r,o)},ObjectKeys(r){return Object.keys(r)},ObjectSetPrototypeOf(r,o){return Object.setPrototypeOf(r,o)},Promise,PromisePrototypeCatch(r,o){return r.catch(o)},PromisePrototypeThen(r,o,t){return r.then(o,t)},PromiseReject(r){return Promise.reject(r)},PromiseResolve(r){return Promise.resolve(r)},ReflectApply:Reflect.apply,RegExpPrototypeTest(r,o){return r.test(o)},SafeSet:Set,String,StringPrototypeSlice(r,o,t){return r.slice(o,t)},StringPrototypeToLowerCase(r){return r.toLowerCase()},StringPrototypeToUpperCase(r){return r.toUpperCase()},StringPrototypeTrim(r){return r.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(r,o,t){return r.set(o,t)},Boolean,Uint8Array},primordials}var util={exports:{}},inspect,hasRequiredInspect;function requireInspect(){return hasRequiredInspect||(hasRequiredInspect=1,inspect={format(e,...r){return e.replace(/%([sdifj])/g,function(...[o,t]){const c=r.shift();return t==="f"?c.toFixed(6):t==="j"?JSON.stringify(c):t==="s"&&typeof c=="object"?`${c.constructor!==Object?c.constructor.name:""} {}`.trim():c.toString()})},inspect(e){switch(typeof e){case"string":if(e.includes("'"))if(e.includes('"')){if(!e.includes("`")&&!e.includes("${"))return`\`${e}\``}else return`"${e}"`;return`'${e}'`;case"number":return isNaN(e)?"NaN":Object.is(e,-0)?String(e):e;case"bigint":return`${String(e)}n`;case"boolean":case"undefined":return String(e);case"object":return"{}"}}}),inspect}var errors,hasRequiredErrors;function requireErrors(){if(hasRequiredErrors)return errors;hasRequiredErrors=1;const{format:e,inspect:r}=requireInspect(),{AggregateError:o}=requirePrimordials(),t=globalThis.AggregateError||o,c=Symbol("kIsNodeError"),h=["string","function","number","object","Function","Object","boolean","bigint","symbol"],l=/^([A-Z][a-z0-9]*)+$/,i="__node_internal_",p={};function s(y,T){if(!y)throw new p.ERR_INTERNAL_ASSERTION(T)}function d(y){let T="",E=y.length;const x=y[0]==="-"?1:0;for(;E>=x+4;E-=3)T=`_${y.slice(E-3,E)}${T}`;return`${y.slice(0,E)}${T}`}function m(y,T,E){if(typeof T=="function")return s(T.length<=E.length,`Code: ${y}; The provided arguments length (${E.length}) does not match the required ones (${T.length}).`),T(...E);const x=(T.match(/%[dfijoOs]/g)||[]).length;return s(x===E.length,`Code: ${y}; The provided arguments length (${E.length}) does not match the required ones (${x}).`),E.length===0?T:e(T,...E)}function u(y,T,E){E||(E=Error);class x extends E{constructor(...P){super(m(y,T,P))}toString(){return`${this.name} [${y}]: ${this.message}`}}Object.defineProperties(x.prototype,{name:{value:E.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${y}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),x.prototype.code=y,x.prototype[c]=!0,p[y]=x}function a(y){const T=i+y.name;return Object.defineProperty(y,"name",{value:T}),y}function g(y,T){if(y&&T&&y!==T){if(Array.isArray(T.errors))return T.errors.push(y),T;const E=new t([T,y],T.message);return E.code=T.code,E}return y||T}class b extends Error{constructor(T="The operation was aborted",E=void 0){if(E!==void 0&&typeof E!="object")throw new p.ERR_INVALID_ARG_TYPE("options","Object",E);super(T,E),this.code="ABORT_ERR",this.name="AbortError"}}return u("ERR_ASSERTION","%s",Error),u("ERR_INVALID_ARG_TYPE",(y,T,E)=>{s(typeof y=="string","'name' must be a string"),Array.isArray(T)||(T=[T]);let x="The ";y.endsWith(" argument")?x+=`${y} `:x+=`"${y}" ${y.includes(".")?"property":"argument"} `,x+="must be ";const R=[],P=[],A=[];for(const S of T)s(typeof S=="string","All expected entries have to be of type string"),h.includes(S)?R.push(S.toLowerCase()):l.test(S)?P.push(S):(s(S!=="object",'The value "object" should be written as "Object"'),A.push(S));if(P.length>0){const S=R.indexOf("object");S!==-1&&(R.splice(R,S,1),P.push("Object"))}if(R.length>0){switch(R.length){case 1:x+=`of type ${R[0]}`;break;case 2:x+=`one of type ${R[0]} or ${R[1]}`;break;default:{const S=R.pop();x+=`one of type ${R.join(", ")}, or ${S}`}}(P.length>0||A.length>0)&&(x+=" or ")}if(P.length>0){switch(P.length){case 1:x+=`an instance of ${P[0]}`;break;case 2:x+=`an instance of ${P[0]} or ${P[1]}`;break;default:{const S=P.pop();x+=`an instance of ${P.join(", ")}, or ${S}`}}A.length>0&&(x+=" or ")}switch(A.length){case 0:break;case 1:A[0].toLowerCase()!==A[0]&&(x+="an "),x+=`${A[0]}`;break;case 2:x+=`one of ${A[0]} or ${A[1]}`;break;default:{const S=A.pop();x+=`one of ${A.join(", ")}, or ${S}`}}if(E==null)x+=`. Received ${E}`;else if(typeof E=="function"&&E.name)x+=`. Received function ${E.name}`;else if(typeof E=="object"){var w;if((w=E.constructor)!==null&&w!==void 0&&w.name)x+=`. Received an instance of ${E.constructor.name}`;else{const S=r(E,{depth:-1});x+=`. Received ${S}`}}else{let S=r(E,{colors:!1});S.length>25&&(S=`${S.slice(0,25)}...`),x+=`. Received type ${typeof E} (${S})`}return x},TypeError),u("ERR_INVALID_ARG_VALUE",(y,T,E="is invalid")=>{let x=r(T);return x.length>128&&(x=x.slice(0,128)+"..."),`The ${y.includes(".")?"property":"argument"} '${y}' ${E}. Received ${x}`},TypeError),u("ERR_INVALID_RETURN_VALUE",(y,T,E)=>{var x;const R=E!=null&&(x=E.constructor)!==null&&x!==void 0&&x.name?`instance of ${E.constructor.name}`:`type ${typeof E}`;return`Expected ${y} to be returned from the "${T}" function but got ${R}.`},TypeError),u("ERR_MISSING_ARGS",(...y)=>{s(y.length>0,"At least one arg needs to be specified");let T;const E=y.length;switch(y=(Array.isArray(y)?y:[y]).map(x=>`"${x}"`).join(" or "),E){case 1:T+=`The ${y[0]} argument`;break;case 2:T+=`The ${y[0]} and ${y[1]} arguments`;break;default:{const x=y.pop();T+=`The ${y.join(", ")}, and ${x} arguments`}break}return`${T} must be specified`},TypeError),u("ERR_OUT_OF_RANGE",(y,T,E)=>{s(T,'Missing "range" argument');let x;if(Number.isInteger(E)&&Math.abs(E)>2**32)x=d(String(E));else if(typeof E=="bigint"){x=String(E);const R=BigInt(2)**BigInt(32);(E>R||E<-R)&&(x=d(x)),x+="n"}else x=r(E);return`The value of "${y}" is out of range. It must be ${T}. Received ${x}`},RangeError),u("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),u("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),u("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),u("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),u("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),u("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),u("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),u("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),u("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),u("ERR_STREAM_WRITE_AFTER_END","write after end",Error),u("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),errors={AbortError:b,aggregateTwoErrors:a(g),hideStackFrames:a,codes:p},errors}var browser$1={exports:{}},hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$1.exports;hasRequiredBrowser$2=1;const{AbortController:e,AbortSignal:r}=typeof self<"u"?self:typeof window<"u"?window:void 0;return browser$1.exports=e,browser$1.exports.AbortSignal=r,browser$1.exports.default=e,browser$1.exports}var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(P,A,w){return Function.prototype.apply.call(P,A,w)},o;e&&typeof e.ownKeys=="function"?o=e.ownKeys:Object.getOwnPropertySymbols?o=function(P){return Object.getOwnPropertyNames(P).concat(Object.getOwnPropertySymbols(P))}:o=function(P){return Object.getOwnPropertyNames(P)};function t(R){console&&console.warn&&console.warn(R)}var c=Number.isNaN||function(P){return P!==P};function h(){h.init.call(this)}events.exports=h,events.exports.once=T,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var l=10;function i(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(R){if(typeof R!="number"||R<0||c(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");l=R}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(P){if(typeof P!="number"||P<0||c(P))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+P+".");return this._maxListeners=P,this};function p(R){return R._maxListeners===void 0?h.defaultMaxListeners:R._maxListeners}h.prototype.getMaxListeners=function(){return p(this)},h.prototype.emit=function(P){for(var A=[],w=1;w<arguments.length;w++)A.push(arguments[w]);var S=P==="error",j=this._events;if(j!==void 0)S=S&&j.error===void 0;else if(!S)return!1;if(S){var M;if(A.length>0&&(M=A[0]),M instanceof Error)throw M;var q=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw q.context=M,q}var U=j[P];if(U===void 0)return!1;if(typeof U=="function")r(U,this,A);else for(var O=U.length,te=g(U,O),w=0;w<O;++w)r(te[w],this,A);return!0};function s(R,P,A,w){var S,j,M;if(i(A),j=R._events,j===void 0?(j=R._events=Object.create(null),R._eventsCount=0):(j.newListener!==void 0&&(R.emit("newListener",P,A.listener?A.listener:A),j=R._events),M=j[P]),M===void 0)M=j[P]=A,++R._eventsCount;else if(typeof M=="function"?M=j[P]=w?[A,M]:[M,A]:w?M.unshift(A):M.push(A),S=p(R),S>0&&M.length>S&&!M.warned){M.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.emitter=R,q.type=P,q.count=M.length,t(q)}return R}h.prototype.addListener=function(P,A){return s(this,P,A,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(P,A){return s(this,P,A,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(R,P,A){var w={fired:!1,wrapFn:void 0,target:R,type:P,listener:A},S=d.bind(w);return S.listener=A,w.wrapFn=S,S}h.prototype.once=function(P,A){return i(A),this.on(P,m(this,P,A)),this},h.prototype.prependOnceListener=function(P,A){return i(A),this.prependListener(P,m(this,P,A)),this},h.prototype.removeListener=function(P,A){var w,S,j,M,q;if(i(A),S=this._events,S===void 0)return this;if(w=S[P],w===void 0)return this;if(w===A||w.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete S[P],S.removeListener&&this.emit("removeListener",P,w.listener||A));else if(typeof w!="function"){for(j=-1,M=w.length-1;M>=0;M--)if(w[M]===A||w[M].listener===A){q=w[M].listener,j=M;break}if(j<0)return this;j===0?w.shift():b(w,j),w.length===1&&(S[P]=w[0]),S.removeListener!==void 0&&this.emit("removeListener",P,q||A)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(P){var A,w,S;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[P]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[P]),this;if(arguments.length===0){var j=Object.keys(w),M;for(S=0;S<j.length;++S)M=j[S],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=w[P],typeof A=="function")this.removeListener(P,A);else if(A!==void 0)for(S=A.length-1;S>=0;S--)this.removeListener(P,A[S]);return this};function u(R,P,A){var w=R._events;if(w===void 0)return[];var S=w[P];return S===void 0?[]:typeof S=="function"?A?[S.listener||S]:[S]:A?y(S):g(S,S.length)}h.prototype.listeners=function(P){return u(this,P,!0)},h.prototype.rawListeners=function(P){return u(this,P,!1)},h.listenerCount=function(R,P){return typeof R.listenerCount=="function"?R.listenerCount(P):a.call(R,P)},h.prototype.listenerCount=a;function a(R){var P=this._events;if(P!==void 0){var A=P[R];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};function g(R,P){for(var A=new Array(P),w=0;w<P;++w)A[w]=R[w];return A}function b(R,P){for(;P+1<R.length;P++)R[P]=R[P+1];R.pop()}function y(R){for(var P=new Array(R.length),A=0;A<P.length;++A)P[A]=R[A].listener||R[A];return P}function T(R,P){return new Promise(function(A,w){function S(M){R.removeListener(P,j),w(M)}function j(){typeof R.removeListener=="function"&&R.removeListener("error",S),A([].slice.call(arguments))}x(R,P,j,{once:!0}),P!=="error"&&E(R,S,{once:!0})})}function E(R,P,A){typeof R.on=="function"&&x(R,"error",P,A)}function x(R,P,A,w){if(typeof R.on=="function")w.once?R.once(P,A):R.on(P,A);else if(typeof R.addEventListener=="function")R.addEventListener(P,function S(j){w.once&&R.removeEventListener(P,S),A(j)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R)}return events.exports}var hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,(function(e){const r=requireBuffer(),{format:o,inspect:t}=requireInspect(),{codes:{ERR_INVALID_ARG_TYPE:c}}=requireErrors(),{kResistStopPropagation:h,AggregateError:l,SymbolDispose:i}=requirePrimordials(),p=globalThis.AbortSignal||requireBrowser$2().AbortSignal,s=globalThis.AbortController||requireBrowser$2().AbortController,d=Object.getPrototypeOf(async function(){}).constructor,m=globalThis.Blob||r.Blob,u=typeof m<"u"?function(y){return y instanceof m}:function(y){return!1},a=(b,y)=>{if(b!==void 0&&(b===null||typeof b!="object"||!("aborted"in b)))throw new c(y,"AbortSignal",b)},g=(b,y)=>{if(typeof b!="function")throw new c(y,"Function",b)};e.exports={AggregateError:l,kEmptyObject:Object.freeze({}),once(b){let y=!1;return function(...T){y||(y=!0,b.apply(this,T))}},createDeferredPromise:function(){let b,y;return{promise:new Promise((E,x)=>{b=E,y=x}),resolve:b,reject:y}},promisify(b){return new Promise((y,T)=>{b((E,...x)=>E?T(E):y(...x))})},debuglog(){return function(){}},format:o,inspect:t,types:{isAsyncFunction(b){return b instanceof d},isArrayBufferView(b){return ArrayBuffer.isView(b)}},isBlob:u,deprecate(b,y){return b},addAbortListener:requireEvents().addAbortListener||function(y,T){if(y===void 0)throw new c("signal","AbortSignal",y);a(y,"signal"),g(T,"listener");let E;return y.aborted?queueMicrotask(()=>T()):(y.addEventListener("abort",T,{__proto__:null,once:!0,[h]:!0}),E=()=>{y.removeEventListener("abort",T)}),{__proto__:null,[i](){var x;(x=E)===null||x===void 0||x()}}},AbortSignalAny:p.any||function(y){if(y.length===1)return y[0];const T=new s,E=()=>T.abort();return y.forEach(x=>{a(x,"signals"),x.addEventListener("abort",E,{once:!0})}),T.signal.addEventListener("abort",()=>{y.forEach(x=>x.removeEventListener("abort",E))},{once:!0}),T.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util)),util.exports}var operators={},validators,hasRequiredValidators;function requireValidators(){if(hasRequiredValidators)return validators;hasRequiredValidators=1;const{ArrayIsArray:e,ArrayPrototypeIncludes:r,ArrayPrototypeJoin:o,ArrayPrototypeMap:t,NumberIsInteger:c,NumberIsNaN:h,NumberMAX_SAFE_INTEGER:l,NumberMIN_SAFE_INTEGER:i,NumberParseInt:p,ObjectPrototypeHasOwnProperty:s,RegExpPrototypeExec:d,String:m,StringPrototypeToUpperCase:u,StringPrototypeTrim:a}=requirePrimordials(),{hideStackFrames:g,codes:{ERR_SOCKET_BAD_PORT:b,ERR_INVALID_ARG_TYPE:y,ERR_INVALID_ARG_VALUE:T,ERR_OUT_OF_RANGE:E,ERR_UNKNOWN_SIGNAL:x}}=requireErrors(),{normalizeEncoding:R}=requireUtil(),{isAsyncFunction:P,isArrayBufferView:A}=requireUtil().types,w={};function S(F){return F===(F|0)}function j(F){return F===F>>>0}const M=/^[0-7]+$/,q="must be a 32-bit unsigned integer or an octal string";function U(F,Z,K){if(typeof F>"u"&&(F=K),typeof F=="string"){if(d(M,F)===null)throw new T(Z,F,q);F=p(F,8)}return se(F,Z),F}const O=g((F,Z,K=i,G=l)=>{if(typeof F!="number")throw new y(Z,"number",F);if(!c(F))throw new E(Z,"an integer",F);if(F<K||F>G)throw new E(Z,`>= ${K} && <= ${G}`,F)}),te=g((F,Z,K=-2147483648,G=2147483647)=>{if(typeof F!="number")throw new y(Z,"number",F);if(!c(F))throw new E(Z,"an integer",F);if(F<K||F>G)throw new E(Z,`>= ${K} && <= ${G}`,F)}),se=g((F,Z,K=!1)=>{if(typeof F!="number")throw new y(Z,"number",F);if(!c(F))throw new E(Z,"an integer",F);const G=K?1:0,ye=4294967295;if(F<G||F>ye)throw new E(Z,`>= ${G} && <= ${ye}`,F)});function oe(F,Z){if(typeof F!="string")throw new y(Z,"string",F)}function me(F,Z,K=void 0,G){if(typeof F!="number")throw new y(Z,"number",F);if(K!=null&&F<K||G!=null&&F>G||(K!=null||G!=null)&&h(F))throw new E(Z,`${K!=null?`>= ${K}`:""}${K!=null&&G!=null?" && ":""}${G!=null?`<= ${G}`:""}`,F)}const $=g((F,Z,K)=>{if(!r(K,F)){const ye="must be one of: "+o(t(K,Ie=>typeof Ie=="string"?`'${Ie}'`:m(Ie)),", ");throw new T(Z,F,ye)}});function le(F,Z){if(typeof F!="boolean")throw new y(Z,"boolean",F)}function C(F,Z,K){return F==null||!s(F,Z)?K:F[Z]}const W=g((F,Z,K=null)=>{const G=C(K,"allowArray",!1),ye=C(K,"allowFunction",!1);if(!C(K,"nullable",!1)&&F===null||!G&&e(F)||typeof F!="object"&&(!ye||typeof F!="function"))throw new y(Z,"Object",F)}),J=g((F,Z)=>{if(F!=null&&typeof F!="object"&&typeof F!="function")throw new y(Z,"a dictionary",F)}),V=g((F,Z,K=0)=>{if(!e(F))throw new y(Z,"Array",F);if(F.length<K){const G=`must be longer than ${K}`;throw new T(Z,F,G)}});function ue(F,Z){V(F,Z);for(let K=0;K<F.length;K++)oe(F[K],`${Z}[${K}]`)}function de(F,Z){V(F,Z);for(let K=0;K<F.length;K++)le(F[K],`${Z}[${K}]`)}function be(F,Z){V(F,Z);for(let K=0;K<F.length;K++){const G=F[K],ye=`${Z}[${K}]`;if(G==null)throw new y(ye,"AbortSignal",G);pe(G,ye)}}function he(F,Z="signal"){if(oe(F,Z),w[F]===void 0)throw w[u(F)]!==void 0?new x(F+" (signals must use all capital letters)"):new x(F)}const H=g((F,Z="buffer")=>{if(!A(F))throw new y(Z,["Buffer","TypedArray","DataView"],F)});function Y(F,Z){const K=R(Z),G=F.length;if(K==="hex"&&G%2!==0)throw new T("encoding",Z,`is invalid for data of length ${G}`)}function ne(F,Z="Port",K=!0){if(typeof F!="number"&&typeof F!="string"||typeof F=="string"&&a(F).length===0||+F!==+F>>>0||F>65535||F===0&&!K)throw new b(Z,F,K);return F|0}const pe=g((F,Z)=>{if(F!==void 0&&(F===null||typeof F!="object"||!("aborted"in F)))throw new y(Z,"AbortSignal",F)}),fe=g((F,Z)=>{if(typeof F!="function")throw new y(Z,"Function",F)}),D=g((F,Z)=>{if(typeof F!="function"||P(F))throw new y(Z,"Function",F)}),L=g((F,Z)=>{if(F!==void 0)throw new y(Z,"undefined",F)});function z(F,Z,K){if(!r(K,F))throw new y(Z,`('${o(K,"|")}')`,F)}const re=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function Q(F,Z){if(typeof F>"u"||!d(re,F))throw new T(Z,F,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function ee(F){if(typeof F=="string")return Q(F,"hints"),F;if(e(F)){const Z=F.length;let K="";if(Z===0)return K;for(let G=0;G<Z;G++){const ye=F[G];Q(ye,"hints"),K+=ye,G!==Z-1&&(K+=", ")}return K}throw new T("hints",F,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}return validators={isInt32:S,isUint32:j,parseFileMode:U,validateArray:V,validateStringArray:ue,validateBooleanArray:de,validateAbortSignalArray:be,validateBoolean:le,validateBuffer:H,validateDictionary:J,validateEncoding:Y,validateFunction:fe,validateInt32:te,validateInteger:O,validateNumber:me,validateObject:W,validateOneOf:$,validatePlainFunction:D,validatePort:ne,validateSignalName:he,validateString:oe,validateUint32:se,validateUndefined:L,validateUnion:z,validateAbortSignal:pe,validateLinkHeaderValue:ee},validators}var endOfStream={exports:{}},browser={exports:{}},hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser.exports;hasRequiredBrowser$1=1;var e=browser.exports={},r,o;function t(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?r=setTimeout:r=t}catch{r=t}try{typeof clearTimeout=="function"?o=clearTimeout:o=c}catch{o=c}})();function h(b){if(r===setTimeout)return setTimeout(b,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(b,0);try{return r(b,0)}catch{try{return r.call(null,b,0)}catch{return r.call(this,b,0)}}}function l(b){if(o===clearTimeout)return clearTimeout(b);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(b);try{return o(b)}catch{try{return o.call(null,b)}catch{return o.call(this,b)}}}var i=[],p=!1,s,d=-1;function m(){!p||!s||(p=!1,s.length?i=s.concat(i):d=-1,i.length&&u())}function u(){if(!p){var b=h(m);p=!0;for(var y=i.length;y;){for(s=i,i=[];++d<y;)s&&s[d].run();d=-1,y=i.length}s=null,p=!1,l(b)}}e.nextTick=function(b){var y=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)y[T-1]=arguments[T];i.push(new a(b,y)),i.length===1&&!p&&h(u)};function a(b,y){this.fun=b,this.array=y}a.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function g(){}return e.on=g,e.addListener=g,e.once=g,e.off=g,e.removeListener=g,e.removeAllListeners=g,e.emit=g,e.prependListener=g,e.prependOnceListener=g,e.listeners=function(b){return[]},e.binding=function(b){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(b){throw new Error("process.chdir is not supported")},e.umask=function(){return 0},browser.exports}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const{SymbolAsyncIterator:e,SymbolIterator:r,SymbolFor:o}=requirePrimordials(),t=o("nodejs.stream.destroyed"),c=o("nodejs.stream.errored"),h=o("nodejs.stream.readable"),l=o("nodejs.stream.writable"),i=o("nodejs.stream.disturbed"),p=o("nodejs.webstream.isClosedPromise"),s=o("nodejs.webstream.controllerErrorFunction");function d(C,W=!1){var J;return!!(C&&typeof C.pipe=="function"&&typeof C.on=="function"&&(!W||typeof C.pause=="function"&&typeof C.resume=="function")&&(!C._writableState||((J=C._readableState)===null||J===void 0?void 0:J.readable)!==!1)&&(!C._writableState||C._readableState))}function m(C){var W;return!!(C&&typeof C.write=="function"&&typeof C.on=="function"&&(!C._readableState||((W=C._writableState)===null||W===void 0?void 0:W.writable)!==!1))}function u(C){return!!(C&&typeof C.pipe=="function"&&C._readableState&&typeof C.on=="function"&&typeof C.write=="function")}function a(C){return C&&(C._readableState||C._writableState||typeof C.write=="function"&&typeof C.on=="function"||typeof C.pipe=="function"&&typeof C.on=="function")}function g(C){return!!(C&&!a(C)&&typeof C.pipeThrough=="function"&&typeof C.getReader=="function"&&typeof C.cancel=="function")}function b(C){return!!(C&&!a(C)&&typeof C.getWriter=="function"&&typeof C.abort=="function")}function y(C){return!!(C&&!a(C)&&typeof C.readable=="object"&&typeof C.writable=="object")}function T(C){return g(C)||b(C)||y(C)}function E(C,W){return C==null?!1:W===!0?typeof C[e]=="function":W===!1?typeof C[r]=="function":typeof C[e]=="function"||typeof C[r]=="function"}function x(C){if(!a(C))return null;const W=C._writableState,J=C._readableState,V=W||J;return!!(C.destroyed||C[t]||V!=null&&V.destroyed)}function R(C){if(!m(C))return null;if(C.writableEnded===!0)return!0;const W=C._writableState;return W!=null&&W.errored?!1:typeof(W==null?void 0:W.ended)!="boolean"?null:W.ended}function P(C,W){if(!m(C))return null;if(C.writableFinished===!0)return!0;const J=C._writableState;return J!=null&&J.errored?!1:typeof(J==null?void 0:J.finished)!="boolean"?null:!!(J.finished||W===!1&&J.ended===!0&&J.length===0)}function A(C){if(!d(C))return null;if(C.readableEnded===!0)return!0;const W=C._readableState;return!W||W.errored?!1:typeof(W==null?void 0:W.ended)!="boolean"?null:W.ended}function w(C,W){if(!d(C))return null;const J=C._readableState;return J!=null&&J.errored?!1:typeof(J==null?void 0:J.endEmitted)!="boolean"?null:!!(J.endEmitted||W===!1&&J.ended===!0&&J.length===0)}function S(C){return C&&C[h]!=null?C[h]:typeof(C==null?void 0:C.readable)!="boolean"?null:x(C)?!1:d(C)&&C.readable&&!w(C)}function j(C){return C&&C[l]!=null?C[l]:typeof(C==null?void 0:C.writable)!="boolean"?null:x(C)?!1:m(C)&&C.writable&&!R(C)}function M(C,W){return a(C)?x(C)?!0:!((W==null?void 0:W.readable)!==!1&&S(C)||(W==null?void 0:W.writable)!==!1&&j(C)):null}function q(C){var W,J;return a(C)?C.writableErrored?C.writableErrored:(W=(J=C._writableState)===null||J===void 0?void 0:J.errored)!==null&&W!==void 0?W:null:null}function U(C){var W,J;return a(C)?C.readableErrored?C.readableErrored:(W=(J=C._readableState)===null||J===void 0?void 0:J.errored)!==null&&W!==void 0?W:null:null}function O(C){if(!a(C))return null;if(typeof C.closed=="boolean")return C.closed;const W=C._writableState,J=C._readableState;return typeof(W==null?void 0:W.closed)=="boolean"||typeof(J==null?void 0:J.closed)=="boolean"?(W==null?void 0:W.closed)||(J==null?void 0:J.closed):typeof C._closed=="boolean"&&te(C)?C._closed:null}function te(C){return typeof C._closed=="boolean"&&typeof C._defaultKeepAlive=="boolean"&&typeof C._removedConnection=="boolean"&&typeof C._removedContLen=="boolean"}function se(C){return typeof C._sent100=="boolean"&&te(C)}function oe(C){var W;return typeof C._consuming=="boolean"&&typeof C._dumped=="boolean"&&((W=C.req)===null||W===void 0?void 0:W.upgradeOrConnect)===void 0}function me(C){if(!a(C))return null;const W=C._writableState,J=C._readableState,V=W||J;return!V&&se(C)||!!(V&&V.autoDestroy&&V.emitClose&&V.closed===!1)}function $(C){var W;return!!(C&&((W=C[i])!==null&&W!==void 0?W:C.readableDidRead||C.readableAborted))}function le(C){var W,J,V,ue,de,be,he,H,Y,ne;return!!(C&&((W=(J=(V=(ue=(de=(be=C[c])!==null&&be!==void 0?be:C.readableErrored)!==null&&de!==void 0?de:C.writableErrored)!==null&&ue!==void 0?ue:(he=C._readableState)===null||he===void 0?void 0:he.errorEmitted)!==null&&V!==void 0?V:(H=C._writableState)===null||H===void 0?void 0:H.errorEmitted)!==null&&J!==void 0?J:(Y=C._readableState)===null||Y===void 0?void 0:Y.errored)!==null&&W!==void 0?W:!((ne=C._writableState)===null||ne===void 0)&&ne.errored))}return utils={isDestroyed:x,kIsDestroyed:t,isDisturbed:$,kIsDisturbed:i,isErrored:le,kIsErrored:c,isReadable:S,kIsReadable:h,kIsClosedPromise:p,kControllerErrorFunction:s,kIsWritable:l,isClosed:O,isDuplexNodeStream:u,isFinished:M,isIterable:E,isReadableNodeStream:d,isReadableStream:g,isReadableEnded:A,isReadableFinished:w,isReadableErrored:U,isNodeStream:a,isWebStream:T,isWritable:j,isWritableNodeStream:m,isWritableStream:b,isWritableEnded:R,isWritableFinished:P,isWritableErrored:q,isServerRequest:oe,isServerResponse:se,willEmitClose:me,isTransformStream:y},utils}var hasRequiredEndOfStream;function requireEndOfStream(){if(hasRequiredEndOfStream)return endOfStream.exports;hasRequiredEndOfStream=1;const e=requireBrowser$1(),{AbortError:r,codes:o}=requireErrors(),{ERR_INVALID_ARG_TYPE:t,ERR_STREAM_PREMATURE_CLOSE:c}=o,{kEmptyObject:h,once:l}=requireUtil(),{validateAbortSignal:i,validateFunction:p,validateObject:s,validateBoolean:d}=requireValidators(),{Promise:m,PromisePrototypeThen:u,SymbolDispose:a}=requirePrimordials(),{isClosed:g,isReadable:b,isReadableNodeStream:y,isReadableStream:T,isReadableFinished:E,isReadableErrored:x,isWritable:R,isWritableNodeStream:P,isWritableStream:A,isWritableFinished:w,isWritableErrored:S,isNodeStream:j,willEmitClose:M,kIsClosedPromise:q}=requireUtils();let U;function O($){return $.setHeader&&typeof $.abort=="function"}const te=()=>{};function se($,le,C){var W,J;if(arguments.length===2?(C=le,le=h):le==null?le=h:s(le,"options"),p(C,"callback"),i(le.signal,"options.signal"),C=l(C),T($)||A($))return oe($,le,C);if(!j($))throw new t("stream",["ReadableStream","WritableStream","Stream"],$);const V=(W=le.readable)!==null&&W!==void 0?W:y($),ue=(J=le.writable)!==null&&J!==void 0?J:P($),de=$._writableState,be=$._readableState,he=()=>{$.writable||ne()};let H=M($)&&y($)===V&&P($)===ue,Y=w($,!1);const ne=()=>{Y=!0,$.destroyed&&(H=!1),!(H&&(!$.readable||V))&&(!V||pe)&&C.call($)};let pe=E($,!1);const fe=()=>{pe=!0,$.destroyed&&(H=!1),!(H&&(!$.writable||ue))&&(!ue||Y)&&C.call($)},D=F=>{C.call($,F)};let L=g($);const z=()=>{L=!0;const F=S($)||x($);if(F&&typeof F!="boolean")return C.call($,F);if(V&&!pe&&y($,!0)&&!E($,!1))return C.call($,new c);if(ue&&!Y&&!w($,!1))return C.call($,new c);C.call($)},re=()=>{L=!0;const F=S($)||x($);if(F&&typeof F!="boolean")return C.call($,F);C.call($)},Q=()=>{$.req.on("finish",ne)};O($)?($.on("complete",ne),H||$.on("abort",z),$.req?Q():$.on("request",Q)):ue&&!de&&($.on("end",he),$.on("close",he)),!H&&typeof $.aborted=="boolean"&&$.on("aborted",z),$.on("end",fe),$.on("finish",ne),le.error!==!1&&$.on("error",D),$.on("close",z),L?e.nextTick(z):de!=null&&de.errorEmitted||be!=null&&be.errorEmitted?H||e.nextTick(re):(!V&&(!H||b($))&&(Y||R($)===!1)||!ue&&(!H||R($))&&(pe||b($)===!1)||be&&$.req&&$.aborted)&&e.nextTick(re);const ee=()=>{C=te,$.removeListener("aborted",z),$.removeListener("complete",ne),$.removeListener("abort",z),$.removeListener("request",Q),$.req&&$.req.removeListener("finish",ne),$.removeListener("end",he),$.removeListener("close",he),$.removeListener("finish",ne),$.removeListener("end",fe),$.removeListener("error",D),$.removeListener("close",z)};if(le.signal&&!L){const F=()=>{const Z=C;ee(),Z.call($,new r(void 0,{cause:le.signal.reason}))};if(le.signal.aborted)e.nextTick(F);else{U=U||requireUtil().addAbortListener;const Z=U(le.signal,F),K=C;C=l((...G)=>{Z[a](),K.apply($,G)})}}return ee}function oe($,le,C){let W=!1,J=te;if(le.signal)if(J=()=>{W=!0,C.call($,new r(void 0,{cause:le.signal.reason}))},le.signal.aborted)e.nextTick(J);else{U=U||requireUtil().addAbortListener;const ue=U(le.signal,J),de=C;C=l((...be)=>{ue[a](),de.apply($,be)})}const V=(...ue)=>{W||e.nextTick(()=>C.apply($,ue))};return u($[q].promise,V,V),te}function me($,le){var C;let W=!1;return le===null&&(le=h),(C=le)!==null&&C!==void 0&&C.cleanup&&(d(le.cleanup,"cleanup"),W=le.cleanup),new m((J,V)=>{const ue=se($,le,de=>{W&&ue(),de?V(de):J()})})}return endOfStream.exports=se,endOfStream.exports.finished=me,endOfStream.exports}var destroy_1,hasRequiredDestroy;function requireDestroy(){if(hasRequiredDestroy)return destroy_1;hasRequiredDestroy=1;const e=requireBrowser$1(),{aggregateTwoErrors:r,codes:{ERR_MULTIPLE_CALLBACK:o},AbortError:t}=requireErrors(),{Symbol:c}=requirePrimordials(),{kIsDestroyed:h,isDestroyed:l,isFinished:i,isServerRequest:p}=requireUtils(),s=c("kDestroy"),d=c("kConstruct");function m(M,q,U){M&&(M.stack,q&&!q.errored&&(q.errored=M),U&&!U.errored&&(U.errored=M))}function u(M,q){const U=this._readableState,O=this._writableState,te=O||U;return O!=null&&O.destroyed||U!=null&&U.destroyed?(typeof q=="function"&&q(),this):(m(M,O,U),O&&(O.destroyed=!0),U&&(U.destroyed=!0),te.constructed?a(this,M,q):this.once(s,function(se){a(this,r(se,M),q)}),this)}function a(M,q,U){let O=!1;function te(se){if(O)return;O=!0;const oe=M._readableState,me=M._writableState;m(se,me,oe),me&&(me.closed=!0),oe&&(oe.closed=!0),typeof U=="function"&&U(se),se?e.nextTick(g,M,se):e.nextTick(b,M)}try{M._destroy(q||null,te)}catch(se){te(se)}}function g(M,q){y(M,q),b(M)}function b(M){const q=M._readableState,U=M._writableState;U&&(U.closeEmitted=!0),q&&(q.closeEmitted=!0),(U!=null&&U.emitClose||q!=null&&q.emitClose)&&M.emit("close")}function y(M,q){const U=M._readableState,O=M._writableState;O!=null&&O.errorEmitted||U!=null&&U.errorEmitted||(O&&(O.errorEmitted=!0),U&&(U.errorEmitted=!0),M.emit("error",q))}function T(){const M=this._readableState,q=this._writableState;M&&(M.constructed=!0,M.closed=!1,M.closeEmitted=!1,M.destroyed=!1,M.errored=null,M.errorEmitted=!1,M.reading=!1,M.ended=M.readable===!1,M.endEmitted=M.readable===!1),q&&(q.constructed=!0,q.destroyed=!1,q.closed=!1,q.closeEmitted=!1,q.errored=null,q.errorEmitted=!1,q.finalCalled=!1,q.prefinished=!1,q.ended=q.writable===!1,q.ending=q.writable===!1,q.finished=q.writable===!1)}function E(M,q,U){const O=M._readableState,te=M._writableState;if(te!=null&&te.destroyed||O!=null&&O.destroyed)return this;O!=null&&O.autoDestroy||te!=null&&te.autoDestroy?M.destroy(q):q&&(q.stack,te&&!te.errored&&(te.errored=q),O&&!O.errored&&(O.errored=q),U?e.nextTick(y,M,q):y(M,q))}function x(M,q){if(typeof M._construct!="function")return;const U=M._readableState,O=M._writableState;U&&(U.constructed=!1),O&&(O.constructed=!1),M.once(d,q),!(M.listenerCount(d)>1)&&e.nextTick(R,M)}function R(M){let q=!1;function U(O){if(q){E(M,O??new o);return}q=!0;const te=M._readableState,se=M._writableState,oe=se||te;te&&(te.constructed=!0),se&&(se.constructed=!0),oe.destroyed?M.emit(s,O):O?E(M,O,!0):e.nextTick(P,M)}try{M._construct(O=>{e.nextTick(U,O)})}catch(O){e.nextTick(U,O)}}function P(M){M.emit(d)}function A(M){return(M==null?void 0:M.setHeader)&&typeof M.abort=="function"}function w(M){M.emit("close")}function S(M,q){M.emit("error",q),e.nextTick(w,M)}function j(M,q){!M||l(M)||(!q&&!i(M)&&(q=new t),p(M)?(M.socket=null,M.destroy(q)):A(M)?M.abort():A(M.req)?M.req.abort():typeof M.destroy=="function"?M.destroy(q):typeof M.close=="function"?M.close():q?e.nextTick(S,M,q):e.nextTick(w,M),M.destroyed||(M[h]=!0))}return destroy_1={construct:x,destroyer:j,destroy:u,undestroy:T,errorOrDestroy:E},destroy_1}var legacy,hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1;const{ArrayIsArray:e,ObjectSetPrototypeOf:r}=requirePrimordials(),{EventEmitter:o}=requireEvents();function t(h){o.call(this,h)}r(t.prototype,o.prototype),r(t,o),t.prototype.pipe=function(h,l){const i=this;function p(b){h.writable&&h.write(b)===!1&&i.pause&&i.pause()}i.on("data",p);function s(){i.readable&&i.resume&&i.resume()}h.on("drain",s),!h._isStdio&&(!l||l.end!==!1)&&(i.on("end",m),i.on("close",u));let d=!1;function m(){d||(d=!0,h.end())}function u(){d||(d=!0,typeof h.destroy=="function"&&h.destroy())}function a(b){g(),o.listenerCount(this,"error")===0&&this.emit("error",b)}c(i,"error",a),c(h,"error",a);function g(){i.removeListener("data",p),h.removeListener("drain",s),i.removeListener("end",m),i.removeListener("close",u),i.removeListener("error",a),h.removeListener("error",a),i.removeListener("end",g),i.removeListener("close",g),h.removeListener("close",g)}return i.on("end",g),i.on("close",g),h.on("close",g),h.emit("pipe",i),h};function c(h,l,i){if(typeof h.prependListener=="function")return h.prependListener(l,i);!h._events||!h._events[l]?h.on(l,i):e(h._events[l])?h._events[l].unshift(i):h._events[l]=[i,h._events[l]]}return legacy={Stream:t,prependListener:c},legacy}var addAbortSignal={exports:{}},hasRequiredAddAbortSignal;function requireAddAbortSignal(){return hasRequiredAddAbortSignal||(hasRequiredAddAbortSignal=1,(function(e){const{SymbolDispose:r}=requirePrimordials(),{AbortError:o,codes:t}=requireErrors(),{isNodeStream:c,isWebStream:h,kControllerErrorFunction:l}=requireUtils(),i=requireEndOfStream(),{ERR_INVALID_ARG_TYPE:p}=t;let s;const d=(m,u)=>{if(typeof m!="object"||!("aborted"in m))throw new p(u,"AbortSignal",m)};e.exports.addAbortSignal=function(u,a){if(d(u,"signal"),!c(a)&&!h(a))throw new p("stream",["ReadableStream","WritableStream","Stream"],a);return e.exports.addAbortSignalNoValidate(u,a)},e.exports.addAbortSignalNoValidate=function(m,u){if(typeof m!="object"||!("aborted"in m))return u;const a=c(u)?()=>{u.destroy(new o(void 0,{cause:m.reason}))}:()=>{u[l](new o(void 0,{cause:m.reason}))};if(m.aborted)a();else{s=s||requireUtil().addAbortListener;const g=s(m,a);i(u,g[r])}return u}})(addAbortSignal)),addAbortSignal.exports}var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;const{StringPrototypeSlice:e,SymbolIterator:r,TypedArrayPrototypeSet:o,Uint8Array:t}=requirePrimordials(),{Buffer:c}=requireBuffer(),{inspect:h}=requireUtil();return buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(i){const p={data:i,next:null};this.length>0?this.tail.next=p:this.head=p,this.tail=p,++this.length}unshift(i){const p={data:i,next:this.head};this.length===0&&(this.tail=p),this.head=p,++this.length}shift(){if(this.length===0)return;const i=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,i}clear(){this.head=this.tail=null,this.length=0}join(i){if(this.length===0)return"";let p=this.head,s=""+p.data;for(;(p=p.next)!==null;)s+=i+p.data;return s}concat(i){if(this.length===0)return c.alloc(0);const p=c.allocUnsafe(i>>>0);let s=this.head,d=0;for(;s;)o(p,s.data,d),d+=s.data.length,s=s.next;return p}consume(i,p){const s=this.head.data;if(i<s.length){const d=s.slice(0,i);return this.head.data=s.slice(i),d}return i===s.length?this.shift():p?this._getString(i):this._getBuffer(i)}first(){return this.head.data}*[r](){for(let i=this.head;i;i=i.next)yield i.data}_getString(i){let p="",s=this.head,d=0;do{const m=s.data;if(i>m.length)p+=m,i-=m.length;else{i===m.length?(p+=m,++d,s.next?this.head=s.next:this.head=this.tail=null):(p+=e(m,0,i),this.head=s,s.data=e(m,i));break}++d}while((s=s.next)!==null);return this.length-=d,p}_getBuffer(i){const p=c.allocUnsafe(i),s=i;let d=this.head,m=0;do{const u=d.data;if(i>u.length)o(p,u,s-i),i-=u.length;else{i===u.length?(o(p,u,s-i),++m,d.next?this.head=d.next:this.head=this.tail=null):(o(p,new t(u.buffer,u.byteOffset,i),s-i),this.head=d,d.data=u.slice(i));break}++m}while((d=d.next)!==null);return this.length-=m,p}[Symbol.for("nodejs.util.inspect.custom")](i,p){return h(this,{...p,depth:0,customInspect:!1})}},buffer_list}var state,hasRequiredState;function requireState(){if(hasRequiredState)return state;hasRequiredState=1;const{MathFloor:e,NumberIsInteger:r}=requirePrimordials(),{validateInteger:o}=requireValidators(),{ERR_INVALID_ARG_VALUE:t}=requireErrors().codes;let c=16*1024,h=16;function l(d,m,u){return d.highWaterMark!=null?d.highWaterMark:m?d[u]:null}function i(d){return d?h:c}function p(d,m){o(m,"value",0),d?h=m:c=m}function s(d,m,u,a){const g=l(m,a,u);if(g!=null){if(!r(g)||g<0){const b=a?`options.${u}`:"options.highWaterMark";throw new t(b,g)}return e(g)}return i(d.objectMode)}return state={getHighWaterMark:s,getDefaultHighWaterMark:i,setDefaultHighWaterMark:p},state}var string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredSafeBuffer;function requireSafeBuffer(){return hasRequiredSafeBuffer||(hasRequiredSafeBuffer=1,(function(e,r){var o=requireBuffer(),t=o.Buffer;function c(l,i){for(var p in l)i[p]=l[p]}t.from&&t.alloc&&t.allocUnsafe&&t.allocUnsafeSlow?e.exports=o:(c(o,r),r.Buffer=h);function h(l,i,p){return t(l,i,p)}h.prototype=Object.create(t.prototype),c(t,h),h.from=function(l,i,p){if(typeof l=="number")throw new TypeError("Argument must not be a number");return t(l,i,p)},h.alloc=function(l,i,p){if(typeof l!="number")throw new TypeError("Argument must be a number");var s=t(l);return i!==void 0?typeof p=="string"?s.fill(i,p):s.fill(i):s.fill(0),s},h.allocUnsafe=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return t(l)},h.allocUnsafeSlow=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return o.SlowBuffer(l)}})(safeBuffer,safeBuffer.exports)),safeBuffer.exports}var hasRequiredString_decoder;function requireString_decoder(){if(hasRequiredString_decoder)return string_decoder;hasRequiredString_decoder=1;var e=requireSafeBuffer().Buffer,r=e.isEncoding||function(T){switch(T=""+T,T&&T.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(T){if(!T)return"utf8";for(var E;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(E)return;T=(""+T).toLowerCase(),E=!0}}function t(T){var E=o(T);if(typeof E!="string"&&(e.isEncoding===r||!r(T)))throw new Error("Unknown encoding: "+T);return E||T}string_decoder.StringDecoder=c;function c(T){this.encoding=t(T);var E;switch(this.encoding){case"utf16le":this.text=m,this.end=u,E=4;break;case"utf8":this.fillLast=p,E=4;break;case"base64":this.text=a,this.end=g,E=3;break;default:this.write=b,this.end=y;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(E)}c.prototype.write=function(T){if(T.length===0)return"";var E,x;if(this.lastNeed){if(E=this.fillLast(T),E===void 0)return"";x=this.lastNeed,this.lastNeed=0}else x=0;return x<T.length?E?E+this.text(T,x):this.text(T,x):E||""},c.prototype.end=d,c.prototype.text=s,c.prototype.fillLast=function(T){if(this.lastNeed<=T.length)return T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,T.length),this.lastNeed-=T.length};function h(T){return T<=127?0:T>>5===6?2:T>>4===14?3:T>>3===30?4:T>>6===2?-1:-2}function l(T,E,x){var R=E.length-1;if(R<x)return 0;var P=h(E[R]);return P>=0?(P>0&&(T.lastNeed=P-1),P):--R<x||P===-2?0:(P=h(E[R]),P>=0?(P>0&&(T.lastNeed=P-2),P):--R<x||P===-2?0:(P=h(E[R]),P>=0?(P>0&&(P===2?P=0:T.lastNeed=P-3),P):0))}function i(T,E,x){if((E[0]&192)!==128)return T.lastNeed=0,"";if(T.lastNeed>1&&E.length>1){if((E[1]&192)!==128)return T.lastNeed=1,"";if(T.lastNeed>2&&E.length>2&&(E[2]&192)!==128)return T.lastNeed=2,""}}function p(T){var E=this.lastTotal-this.lastNeed,x=i(this,T);if(x!==void 0)return x;if(this.lastNeed<=T.length)return T.copy(this.lastChar,E,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,E,0,T.length),this.lastNeed-=T.length}function s(T,E){var x=l(this,T,E);if(!this.lastNeed)return T.toString("utf8",E);this.lastTotal=x;var R=T.length-(x-this.lastNeed);return T.copy(this.lastChar,0,R),T.toString("utf8",E,R)}function d(T){var E=T&&T.length?this.write(T):"";return this.lastNeed?E+"":E}function m(T,E){if((T.length-E)%2===0){var x=T.toString("utf16le",E);if(x){var R=x.charCodeAt(x.length-1);if(R>=55296&&R<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1],x.slice(0,-1)}return x}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=T[T.length-1],T.toString("utf16le",E,T.length-1)}function u(T){var E=T&&T.length?this.write(T):"";if(this.lastNeed){var x=this.lastTotal-this.lastNeed;return E+this.lastChar.toString("utf16le",0,x)}return E}function a(T,E){var x=(T.length-E)%3;return x===0?T.toString("base64",E):(this.lastNeed=3-x,this.lastTotal=3,x===1?this.lastChar[0]=T[T.length-1]:(this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1]),T.toString("base64",E,T.length-x))}function g(T){var E=T&&T.length?this.write(T):"";return this.lastNeed?E+this.lastChar.toString("base64",0,3-this.lastNeed):E}function b(T){return T.toString(this.encoding)}function y(T){return T&&T.length?this.write(T):""}return string_decoder}var from_1,hasRequiredFrom;function requireFrom(){if(hasRequiredFrom)return from_1;hasRequiredFrom=1;const e=requireBrowser$1(),{PromisePrototypeThen:r,SymbolAsyncIterator:o,SymbolIterator:t}=requirePrimordials(),{Buffer:c}=requireBuffer(),{ERR_INVALID_ARG_TYPE:h,ERR_STREAM_NULL_VALUES:l}=requireErrors().codes;function i(p,s,d){let m;if(typeof s=="string"||s instanceof c)return new p({objectMode:!0,...d,read(){this.push(s),this.push(null)}});let u;if(s&&s[o])u=!0,m=s[o]();else if(s&&s[t])u=!1,m=s[t]();else throw new h("iterable",["Iterable"],s);const a=new p({objectMode:!0,highWaterMark:1,...d});let g=!1;a._read=function(){g||(g=!0,y())},a._destroy=function(T,E){r(b(T),()=>e.nextTick(E,T),x=>e.nextTick(E,x||T))};async function b(T){const E=T!=null,x=typeof m.throw=="function";if(E&&x){const{value:R,done:P}=await m.throw(T);if(await R,P)return}if(typeof m.return=="function"){const{value:R}=await m.return();await R}}async function y(){for(;;){try{const{value:T,done:E}=u?await m.next():m.next();if(E)a.push(null);else{const x=T&&typeof T.then=="function"?await T:T;if(x===null)throw g=!1,new l;if(a.push(x))continue;g=!1}}catch(T){a.destroy(T)}break}}return a}return from_1=i,from_1}var readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const e=requireBrowser$1(),{ArrayPrototypeIndexOf:r,NumberIsInteger:o,NumberIsNaN:t,NumberParseInt:c,ObjectDefineProperties:h,ObjectKeys:l,ObjectSetPrototypeOf:i,Promise:p,SafeSet:s,SymbolAsyncDispose:d,SymbolAsyncIterator:m,Symbol:u}=requirePrimordials();readable=G,G.ReadableState=K;const{EventEmitter:a}=requireEvents(),{Stream:g,prependListener:b}=requireLegacy(),{Buffer:y}=requireBuffer(),{addAbortSignal:T}=requireAddAbortSignal(),E=requireEndOfStream();let x=requireUtil().debuglog("stream",I=>{x=I});const R=requireBuffer_list(),P=requireDestroy(),{getHighWaterMark:A,getDefaultHighWaterMark:w}=requireState(),{aggregateTwoErrors:S,codes:{ERR_INVALID_ARG_TYPE:j,ERR_METHOD_NOT_IMPLEMENTED:M,ERR_OUT_OF_RANGE:q,ERR_STREAM_PUSH_AFTER_EOF:U,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:O},AbortError:te}=requireErrors(),{validateObject:se}=requireValidators(),oe=u("kPaused"),{StringDecoder:me}=requireString_decoder(),$=requireFrom();i(G.prototype,g.prototype),i(G,g);const le=()=>{},{errorOrDestroy:C}=P,W=1,J=2,V=4,ue=8,de=16,be=32,he=64,H=128,Y=256,ne=512,pe=1024,fe=2048,D=4096,L=8192,z=16384,re=32768,Q=65536,ee=1<<17,F=1<<18;function Z(I){return{enumerable:!1,get(){return(this.state&I)!==0},set(v){v?this.state|=I:this.state&=~I}}}h(K.prototype,{objectMode:Z(W),ended:Z(J),endEmitted:Z(V),reading:Z(ue),constructed:Z(de),sync:Z(be),needReadable:Z(he),emittedReadable:Z(H),readableListening:Z(Y),resumeScheduled:Z(ne),errorEmitted:Z(pe),emitClose:Z(fe),autoDestroy:Z(D),destroyed:Z(L),closed:Z(z),closeEmitted:Z(re),multiAwaitDrain:Z(Q),readingMore:Z(ee),dataEmitted:Z(F)});function K(I,v,ie){typeof ie!="boolean"&&(ie=v instanceof requireDuplex()),this.state=fe|D|de|be,I&&I.objectMode&&(this.state|=W),ie&&I&&I.readableObjectMode&&(this.state|=W),this.highWaterMark=I?A(this,I,"readableHighWaterMark",ie):w(!1),this.buffer=new R,this.length=0,this.pipes=[],this.flowing=null,this[oe]=null,I&&I.emitClose===!1&&(this.state&=~fe),I&&I.autoDestroy===!1&&(this.state&=~D),this.errored=null,this.defaultEncoding=I&&I.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,I&&I.encoding&&(this.decoder=new me(I.encoding),this.encoding=I.encoding)}function G(I){if(!(this instanceof G))return new G(I);const v=this instanceof requireDuplex();this._readableState=new K(I,this,v),I&&(typeof I.read=="function"&&(this._read=I.read),typeof I.destroy=="function"&&(this._destroy=I.destroy),typeof I.construct=="function"&&(this._construct=I.construct),I.signal&&!v&&T(I.signal,this)),g.call(this,I),P.construct(this,()=>{this._readableState.needReadable&&B(this,this._readableState)})}G.prototype.destroy=P.destroy,G.prototype._undestroy=P.undestroy,G.prototype._destroy=function(I,v){v(I)},G.prototype[a.captureRejectionSymbol]=function(I){this.destroy(I)},G.prototype[d]=function(){let I;return this.destroyed||(I=this.readableEnded?null:new te,this.destroy(I)),new p((v,ie)=>E(this,ae=>ae&&ae!==I?ie(ae):v(null)))},G.prototype.push=function(I,v){return ye(this,I,v,!1)},G.prototype.unshift=function(I,v){return ye(this,I,v,!0)};function ye(I,v,ie,ae){x("readableAddChunk",v);const ce=I._readableState;let ke;if((ce.state&W)===0&&(typeof v=="string"?(ie=ie||ce.defaultEncoding,ce.encoding!==ie&&(ae&&ce.encoding?v=y.from(v,ie).toString(ce.encoding):(v=y.from(v,ie),ie=""))):v instanceof y?ie="":g._isUint8Array(v)?(v=g._uint8ArrayToBuffer(v),ie=""):v!=null&&(ke=new j("chunk",["string","Buffer","Uint8Array"],v))),ke)C(I,ke);else if(v===null)ce.state&=~ue,n(I,ce);else if((ce.state&W)!==0||v&&v.length>0)if(ae)if((ce.state&V)!==0)C(I,new O);else{if(ce.destroyed||ce.errored)return!1;Ie(I,ce,v,!0)}else if(ce.ended)C(I,new U);else{if(ce.destroyed||ce.errored)return!1;ce.state&=~ue,ce.decoder&&!ie?(v=ce.decoder.write(v),ce.objectMode||v.length!==0?Ie(I,ce,v,!1):B(I,ce)):Ie(I,ce,v,!1)}else ae||(ce.state&=~ue,B(I,ce));return!ce.ended&&(ce.length<ce.highWaterMark||ce.length===0)}function Ie(I,v,ie,ae){v.flowing&&v.length===0&&!v.sync&&I.listenerCount("data")>0?((v.state&Q)!==0?v.awaitDrainWriters.clear():v.awaitDrainWriters=null,v.dataEmitted=!0,I.emit("data",ie)):(v.length+=v.objectMode?1:ie.length,ae?v.buffer.unshift(ie):v.buffer.push(ie),(v.state&he)!==0&&f(I)),B(I,v)}G.prototype.isPaused=function(){const I=this._readableState;return I[oe]===!0||I.flowing===!1},G.prototype.setEncoding=function(I){const v=new me(I);this._readableState.decoder=v,this._readableState.encoding=this._readableState.decoder.encoding;const ie=this._readableState.buffer;let ae="";for(const ce of ie)ae+=v.write(ce);return ie.clear(),ae!==""&&ie.push(ae),this._readableState.length=ae.length,this};const Te=1073741824;function xe(I){if(I>Te)throw new q("size","<= 1GiB",I);return I--,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,I|=I>>>16,I++,I}function _(I,v){return I<=0||v.length===0&&v.ended?0:(v.state&W)!==0?1:t(I)?v.flowing&&v.length?v.buffer.first().length:v.length:I<=v.length?I:v.ended?v.length:0}G.prototype.read=function(I){x("read",I),I===void 0?I=NaN:o(I)||(I=c(I,10));const v=this._readableState,ie=I;if(I>v.highWaterMark&&(v.highWaterMark=xe(I)),I!==0&&(v.state&=~H),I===0&&v.needReadable&&((v.highWaterMark!==0?v.length>=v.highWaterMark:v.length>0)||v.ended))return x("read: emitReadable",v.length,v.ended),v.length===0&&v.ended?Le(this):f(this),null;if(I=_(I,v),I===0&&v.ended)return v.length===0&&Le(this),null;let ae=(v.state&he)!==0;if(x("need readable",ae),(v.length===0||v.length-I<v.highWaterMark)&&(ae=!0,x("length less than watermark",ae)),v.ended||v.reading||v.destroyed||v.errored||!v.constructed)ae=!1,x("reading, ended or constructing",ae);else if(ae){x("do read"),v.state|=ue|be,v.length===0&&(v.state|=he);try{this._read(v.highWaterMark)}catch(ke){C(this,ke)}v.state&=~be,v.reading||(I=_(ie,v))}let ce;return I>0?ce=$e(I,v):ce=null,ce===null?(v.needReadable=v.length<=v.highWaterMark,I=0):(v.length-=I,v.multiAwaitDrain?v.awaitDrainWriters.clear():v.awaitDrainWriters=null),v.length===0&&(v.ended||(v.needReadable=!0),ie!==I&&v.ended&&Le(this)),ce!==null&&!v.errorEmitted&&!v.closeEmitted&&(v.dataEmitted=!0,this.emit("data",ce)),ce};function n(I,v){if(x("onEofChunk"),!v.ended){if(v.decoder){const ie=v.decoder.end();ie&&ie.length&&(v.buffer.push(ie),v.length+=v.objectMode?1:ie.length)}v.ended=!0,v.sync?f(I):(v.needReadable=!1,v.emittedReadable=!0,k(I))}}function f(I){const v=I._readableState;x("emitReadable",v.needReadable,v.emittedReadable),v.needReadable=!1,v.emittedReadable||(x("emitReadable",v.flowing),v.emittedReadable=!0,e.nextTick(k,I))}function k(I){const v=I._readableState;x("emitReadable_",v.destroyed,v.length,v.ended),!v.destroyed&&!v.errored&&(v.length||v.ended)&&(I.emit("readable"),v.emittedReadable=!1),v.needReadable=!v.flowing&&!v.ended&&v.length<=v.highWaterMark,we(I)}function B(I,v){!v.readingMore&&v.constructed&&(v.readingMore=!0,e.nextTick(N,I,v))}function N(I,v){for(;!v.reading&&!v.ended&&(v.length<v.highWaterMark||v.flowing&&v.length===0);){const ie=v.length;if(x("maybeReadMore read 0"),I.read(0),ie===v.length)break}v.readingMore=!1}G.prototype._read=function(I){throw new M("_read()")},G.prototype.pipe=function(I,v){const ie=this,ae=this._readableState;ae.pipes.length===1&&(ae.multiAwaitDrain||(ae.multiAwaitDrain=!0,ae.awaitDrainWriters=new s(ae.awaitDrainWriters?[ae.awaitDrainWriters]:[]))),ae.pipes.push(I),x("pipe count=%d opts=%j",ae.pipes.length,v);const ke=(!v||v.end!==!1)&&I!==e.stdout&&I!==e.stderr?Ye:De;ae.endEmitted?e.nextTick(ke):ie.once("end",ke),I.on("unpipe",ve);function ve(Me,Ae){x("onunpipe"),Me===ie&&Ae&&Ae.hasUnpiped===!1&&(Ae.hasUnpiped=!0,nt())}function Ye(){x("onend"),I.end()}let Be,Ze=!1;function nt(){x("cleanup"),I.removeListener("close",Ue),I.removeListener("finish",ze),Be&&I.removeListener("drain",Be),I.removeListener("error",Ne),I.removeListener("unpipe",ve),ie.removeListener("end",Ye),ie.removeListener("end",De),ie.removeListener("data",Je),Ze=!0,Be&&ae.awaitDrainWriters&&(!I._writableState||I._writableState.needDrain)&&Be()}function Ke(){Ze||(ae.pipes.length===1&&ae.pipes[0]===I?(x("false write response, pause",0),ae.awaitDrainWriters=I,ae.multiAwaitDrain=!1):ae.pipes.length>1&&ae.pipes.includes(I)&&(x("false write response, pause",ae.awaitDrainWriters.size),ae.awaitDrainWriters.add(I)),ie.pause()),Be||(Be=X(ie,I),I.on("drain",Be))}ie.on("data",Je);function Je(Me){x("ondata");const Ae=I.write(Me);x("dest.write",Ae),Ae===!1&&Ke()}function Ne(Me){if(x("onerror",Me),De(),I.removeListener("error",Ne),I.listenerCount("error")===0){const Ae=I._writableState||I._readableState;Ae&&!Ae.errorEmitted?C(I,Me):I.emit("error",Me)}}b(I,"error",Ne);function Ue(){I.removeListener("finish",ze),De()}I.once("close",Ue);function ze(){x("onfinish"),I.removeListener("close",Ue),De()}I.once("finish",ze);function De(){x("unpipe"),ie.unpipe(I)}return I.emit("pipe",ie),I.writableNeedDrain===!0?Ke():ae.flowing||(x("pipe resume"),ie.resume()),I};function X(I,v){return function(){const ae=I._readableState;ae.awaitDrainWriters===v?(x("pipeOnDrain",1),ae.awaitDrainWriters=null):ae.multiAwaitDrain&&(x("pipeOnDrain",ae.awaitDrainWriters.size),ae.awaitDrainWriters.delete(v)),(!ae.awaitDrainWriters||ae.awaitDrainWriters.size===0)&&I.listenerCount("data")&&I.resume()}}G.prototype.unpipe=function(I){const v=this._readableState,ie={hasUnpiped:!1};if(v.pipes.length===0)return this;if(!I){const ce=v.pipes;v.pipes=[],this.pause();for(let ke=0;ke<ce.length;ke++)ce[ke].emit("unpipe",this,{hasUnpiped:!1});return this}const ae=r(v.pipes,I);return ae===-1?this:(v.pipes.splice(ae,1),v.pipes.length===0&&this.pause(),I.emit("unpipe",this,ie),this)},G.prototype.on=function(I,v){const ie=g.prototype.on.call(this,I,v),ae=this._readableState;return I==="data"?(ae.readableListening=this.listenerCount("readable")>0,ae.flowing!==!1&&this.resume()):I==="readable"&&!ae.endEmitted&&!ae.readableListening&&(ae.readableListening=ae.needReadable=!0,ae.flowing=!1,ae.emittedReadable=!1,x("on readable",ae.length,ae.reading),ae.length?f(this):ae.reading||e.nextTick(Ee,this)),ie},G.prototype.addListener=G.prototype.on,G.prototype.removeListener=function(I,v){const ie=g.prototype.removeListener.call(this,I,v);return I==="readable"&&e.nextTick(ge,this),ie},G.prototype.off=G.prototype.removeListener,G.prototype.removeAllListeners=function(I){const v=g.prototype.removeAllListeners.apply(this,arguments);return(I==="readable"||I===void 0)&&e.nextTick(ge,this),v};function ge(I){const v=I._readableState;v.readableListening=I.listenerCount("readable")>0,v.resumeScheduled&&v[oe]===!1?v.flowing=!0:I.listenerCount("data")>0?I.resume():v.readableListening||(v.flowing=null)}function Ee(I){x("readable nexttick read 0"),I.read(0)}G.prototype.resume=function(){const I=this._readableState;return I.flowing||(x("resume"),I.flowing=!I.readableListening,_e(this,I)),I[oe]=!1,this};function _e(I,v){v.resumeScheduled||(v.resumeScheduled=!0,e.nextTick(Se,I,v))}function Se(I,v){x("resume",v.reading),v.reading||I.read(0),v.resumeScheduled=!1,I.emit("resume"),we(I),v.flowing&&!v.reading&&I.read(0)}G.prototype.pause=function(){return x("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(x("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[oe]=!0,this};function we(I){const v=I._readableState;for(x("flow",v.flowing);v.flowing&&I.read()!==null;);}G.prototype.wrap=function(I){let v=!1;I.on("data",ae=>{!this.push(ae)&&I.pause&&(v=!0,I.pause())}),I.on("end",()=>{this.push(null)}),I.on("error",ae=>{C(this,ae)}),I.on("close",()=>{this.destroy()}),I.on("destroy",()=>{this.destroy()}),this._read=()=>{v&&I.resume&&(v=!1,I.resume())};const ie=l(I);for(let ae=1;ae<ie.length;ae++){const ce=ie[ae];this[ce]===void 0&&typeof I[ce]=="function"&&(this[ce]=I[ce].bind(I))}return this},G.prototype[m]=function(){return Ve(this)},G.prototype.iterator=function(I){return I!==void 0&&se(I,"options"),Ve(this,I)};function Ve(I,v){typeof I.read!="function"&&(I=G.wrap(I,{objectMode:!0}));const ie=rt(I,v);return ie.stream=I,ie}async function*rt(I,v){let ie=le;function ae(ve){this===I?(ie(),ie=le):ie=ve}I.on("readable",ae);let ce;const ke=E(I,{writable:!1},ve=>{ce=ve?S(ce,ve):null,ie(),ie=le});try{for(;;){const ve=I.destroyed?null:I.read();if(ve!==null)yield ve;else{if(ce)throw ce;if(ce===null)return;await new p(ae)}}}catch(ve){throw ce=S(ce,ve),ce}finally{(ce||(v==null?void 0:v.destroyOnReturn)!==!1)&&(ce===void 0||I._readableState.autoDestroy)?P.destroyer(I,null):(I.off("readable",ae),ke())}}h(G.prototype,{readable:{__proto__:null,get(){const I=this._readableState;return!!I&&I.readable!==!1&&!I.destroyed&&!I.errorEmitted&&!I.endEmitted},set(I){this._readableState&&(this._readableState.readable=!!I)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(I){this._readableState&&(this._readableState.flowing=I)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(I){this._readableState&&(this._readableState.destroyed=I)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),h(K.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[oe]!==!1},set(I){this[oe]=!!I}}}),G._fromList=$e;function $e(I,v){if(v.length===0)return null;let ie;return v.objectMode?ie=v.buffer.shift():!I||I>=v.length?(v.decoder?ie=v.buffer.join(""):v.buffer.length===1?ie=v.buffer.first():ie=v.buffer.concat(v.length),v.buffer.clear()):ie=v.buffer.consume(I,v.decoder),ie}function Le(I){const v=I._readableState;x("endReadable",v.endEmitted),v.endEmitted||(v.ended=!0,e.nextTick(it,v,I))}function it(I,v){if(x("endReadableNT",I.endEmitted,I.length),!I.errored&&!I.closeEmitted&&!I.endEmitted&&I.length===0){if(I.endEmitted=!0,v.emit("end"),v.writable&&v.allowHalfOpen===!1)e.nextTick(at,v);else if(I.autoDestroy){const ie=v._writableState;(!ie||ie.autoDestroy&&(ie.finished||ie.writable===!1))&&v.destroy()}}}function at(I){I.writable&&!I.writableEnded&&!I.destroyed&&I.end()}G.from=function(I,v){return $(G,I,v)};let Oe;function Xe(){return Oe===void 0&&(Oe={}),Oe}return G.fromWeb=function(I,v){return Xe().newStreamReadableFromReadableStream(I,v)},G.toWeb=function(I,v){return Xe().newReadableStreamFromStreamReadable(I,v)},G.wrap=function(I,v){var ie,ae;return new G({objectMode:(ie=(ae=I.readableObjectMode)!==null&&ae!==void 0?ae:I.objectMode)!==null&&ie!==void 0?ie:!0,...v,destroy(ce,ke){P.destroyer(I,ce),ke(ce)}}).wrap(I)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const e=requireBrowser$1(),{ArrayPrototypeSlice:r,Error:o,FunctionPrototypeSymbolHasInstance:t,ObjectDefineProperty:c,ObjectDefineProperties:h,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:i,Symbol:p,SymbolHasInstance:s}=requirePrimordials();writable=se,se.WritableState=O;const{EventEmitter:d}=requireEvents(),m=requireLegacy().Stream,{Buffer:u}=requireBuffer(),a=requireDestroy(),{addAbortSignal:g}=requireAddAbortSignal(),{getHighWaterMark:b,getDefaultHighWaterMark:y}=requireState(),{ERR_INVALID_ARG_TYPE:T,ERR_METHOD_NOT_IMPLEMENTED:E,ERR_MULTIPLE_CALLBACK:x,ERR_STREAM_CANNOT_PIPE:R,ERR_STREAM_DESTROYED:P,ERR_STREAM_ALREADY_FINISHED:A,ERR_STREAM_NULL_VALUES:w,ERR_STREAM_WRITE_AFTER_END:S,ERR_UNKNOWN_ENCODING:j}=requireErrors().codes,{errorOrDestroy:M}=a;l(se.prototype,m.prototype),l(se,m);function q(){}const U=p("kOnFinished");function O(D,L,z){typeof z!="boolean"&&(z=L instanceof requireDuplex()),this.objectMode=!!(D&&D.objectMode),z&&(this.objectMode=this.objectMode||!!(D&&D.writableObjectMode)),this.highWaterMark=D?b(this,D,"writableHighWaterMark",z):y(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const re=!!(D&&D.decodeStrings===!1);this.decodeStrings=!re,this.defaultEncoding=D&&D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=C.bind(void 0,L),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,te(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!D||D.emitClose!==!1,this.autoDestroy=!D||D.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[U]=[]}function te(D){D.buffered=[],D.bufferedIndex=0,D.allBuffers=!0,D.allNoop=!0}O.prototype.getBuffer=function(){return r(this.buffered,this.bufferedIndex)},c(O.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function se(D){const L=this instanceof requireDuplex();if(!L&&!t(se,this))return new se(D);this._writableState=new O(D,this,L),D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final),typeof D.construct=="function"&&(this._construct=D.construct),D.signal&&g(D.signal,this)),m.call(this,D),a.construct(this,()=>{const z=this._writableState;z.writing||ue(this,z),H(this,z)})}c(se,s,{__proto__:null,value:function(D){return t(this,D)?!0:this!==se?!1:D&&D._writableState instanceof O}}),se.prototype.pipe=function(){M(this,new R)};function oe(D,L,z,re){const Q=D._writableState;if(typeof z=="function")re=z,z=Q.defaultEncoding;else{if(!z)z=Q.defaultEncoding;else if(z!=="buffer"&&!u.isEncoding(z))throw new j(z);typeof re!="function"&&(re=q)}if(L===null)throw new w;if(!Q.objectMode)if(typeof L=="string")Q.decodeStrings!==!1&&(L=u.from(L,z),z="buffer");else if(L instanceof u)z="buffer";else if(m._isUint8Array(L))L=m._uint8ArrayToBuffer(L),z="buffer";else throw new T("chunk",["string","Buffer","Uint8Array"],L);let ee;return Q.ending?ee=new S:Q.destroyed&&(ee=new P("write")),ee?(e.nextTick(re,ee),M(D,ee,!0),ee):(Q.pendingcb++,me(D,Q,L,z,re))}se.prototype.write=function(D,L,z){return oe(this,D,L,z)===!0},se.prototype.cork=function(){this._writableState.corked++},se.prototype.uncork=function(){const D=this._writableState;D.corked&&(D.corked--,D.writing||ue(this,D))},se.prototype.setDefaultEncoding=function(L){if(typeof L=="string"&&(L=i(L)),!u.isEncoding(L))throw new j(L);return this._writableState.defaultEncoding=L,this};function me(D,L,z,re,Q){const ee=L.objectMode?1:z.length;L.length+=ee;const F=L.length<L.highWaterMark;return F||(L.needDrain=!0),L.writing||L.corked||L.errored||!L.constructed?(L.buffered.push({chunk:z,encoding:re,callback:Q}),L.allBuffers&&re!=="buffer"&&(L.allBuffers=!1),L.allNoop&&Q!==q&&(L.allNoop=!1)):(L.writelen=ee,L.writecb=Q,L.writing=!0,L.sync=!0,D._write(z,re,L.onwrite),L.sync=!1),F&&!L.errored&&!L.destroyed}function $(D,L,z,re,Q,ee,F){L.writelen=re,L.writecb=F,L.writing=!0,L.sync=!0,L.destroyed?L.onwrite(new P("write")):z?D._writev(Q,L.onwrite):D._write(Q,ee,L.onwrite),L.sync=!1}function le(D,L,z,re){--L.pendingcb,re(z),V(L),M(D,z)}function C(D,L){const z=D._writableState,re=z.sync,Q=z.writecb;if(typeof Q!="function"){M(D,new x);return}z.writing=!1,z.writecb=null,z.length-=z.writelen,z.writelen=0,L?(L.stack,z.errored||(z.errored=L),D._readableState&&!D._readableState.errored&&(D._readableState.errored=L),re?e.nextTick(le,D,z,L,Q):le(D,z,L,Q)):(z.buffered.length>z.bufferedIndex&&ue(D,z),re?z.afterWriteTickInfo!==null&&z.afterWriteTickInfo.cb===Q?z.afterWriteTickInfo.count++:(z.afterWriteTickInfo={count:1,cb:Q,stream:D,state:z},e.nextTick(W,z.afterWriteTickInfo)):J(D,z,1,Q))}function W({stream:D,state:L,count:z,cb:re}){return L.afterWriteTickInfo=null,J(D,L,z,re)}function J(D,L,z,re){for(!L.ending&&!D.destroyed&&L.length===0&&L.needDrain&&(L.needDrain=!1,D.emit("drain"));z-- >0;)L.pendingcb--,re();L.destroyed&&V(L),H(D,L)}function V(D){if(D.writing)return;for(let Q=D.bufferedIndex;Q<D.buffered.length;++Q){var L;const{chunk:ee,callback:F}=D.buffered[Q],Z=D.objectMode?1:ee.length;D.length-=Z,F((L=D.errored)!==null&&L!==void 0?L:new P("write"))}const z=D[U].splice(0);for(let Q=0;Q<z.length;Q++){var re;z[Q]((re=D.errored)!==null&&re!==void 0?re:new P("end"))}te(D)}function ue(D,L){if(L.corked||L.bufferProcessing||L.destroyed||!L.constructed)return;const{buffered:z,bufferedIndex:re,objectMode:Q}=L,ee=z.length-re;if(!ee)return;let F=re;if(L.bufferProcessing=!0,ee>1&&D._writev){L.pendingcb-=ee-1;const Z=L.allNoop?q:G=>{for(let ye=F;ye<z.length;++ye)z[ye].callback(G)},K=L.allNoop&&F===0?z:r(z,F);K.allBuffers=L.allBuffers,$(D,L,!0,L.length,K,"",Z),te(L)}else{do{const{chunk:Z,encoding:K,callback:G}=z[F];z[F++]=null;const ye=Q?1:Z.length;$(D,L,!1,ye,Z,K,G)}while(F<z.length&&!L.writing);F===z.length?te(L):F>256?(z.splice(0,F),L.bufferedIndex=0):L.bufferedIndex=F}L.bufferProcessing=!1}se.prototype._write=function(D,L,z){if(this._writev)this._writev([{chunk:D,encoding:L}],z);else throw new E("_write()")},se.prototype._writev=null,se.prototype.end=function(D,L,z){const re=this._writableState;typeof D=="function"?(z=D,D=null,L=null):typeof L=="function"&&(z=L,L=null);let Q;if(D!=null){const ee=oe(this,D,L);ee instanceof o&&(Q=ee)}return re.corked&&(re.corked=1,this.uncork()),Q||(!re.errored&&!re.ending?(re.ending=!0,H(this,re,!0),re.ended=!0):re.finished?Q=new A("end"):re.destroyed&&(Q=new P("end"))),typeof z=="function"&&(Q||re.finished?e.nextTick(z,Q):re[U].push(z)),this};function de(D){return D.ending&&!D.destroyed&&D.constructed&&D.length===0&&!D.errored&&D.buffered.length===0&&!D.finished&&!D.writing&&!D.errorEmitted&&!D.closeEmitted}function be(D,L){let z=!1;function re(Q){if(z){M(D,Q??x());return}if(z=!0,L.pendingcb--,Q){const ee=L[U].splice(0);for(let F=0;F<ee.length;F++)ee[F](Q);M(D,Q,L.sync)}else de(L)&&(L.prefinished=!0,D.emit("prefinish"),L.pendingcb++,e.nextTick(Y,D,L))}L.sync=!0,L.pendingcb++;try{D._final(re)}catch(Q){re(Q)}L.sync=!1}function he(D,L){!L.prefinished&&!L.finalCalled&&(typeof D._final=="function"&&!L.destroyed?(L.finalCalled=!0,be(D,L)):(L.prefinished=!0,D.emit("prefinish")))}function H(D,L,z){de(L)&&(he(D,L),L.pendingcb===0&&(z?(L.pendingcb++,e.nextTick((re,Q)=>{de(Q)?Y(re,Q):Q.pendingcb--},D,L)):de(L)&&(L.pendingcb++,Y(D,L))))}function Y(D,L){L.pendingcb--,L.finished=!0;const z=L[U].splice(0);for(let re=0;re<z.length;re++)z[re]();if(D.emit("finish"),L.autoDestroy){const re=D._readableState;(!re||re.autoDestroy&&(re.endEmitted||re.readable===!1))&&D.destroy()}}h(se.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(D){this._writableState&&(this._writableState.destroyed=D)}},writable:{__proto__:null,get(){const D=this._writableState;return!!D&&D.writable!==!1&&!D.destroyed&&!D.errored&&!D.ending&&!D.ended},set(D){this._writableState&&(this._writableState.writable=!!D)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const D=this._writableState;return D?!D.destroyed&&!D.ending&&D.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const ne=a.destroy;se.prototype.destroy=function(D,L){const z=this._writableState;return!z.destroyed&&(z.bufferedIndex<z.buffered.length||z[U].length)&&e.nextTick(V,z),ne.call(this,D,L),this},se.prototype._undestroy=a.undestroy,se.prototype._destroy=function(D,L){L(D)},se.prototype[d.captureRejectionSymbol]=function(D){this.destroy(D)};let pe;function fe(){return pe===void 0&&(pe={}),pe}return se.fromWeb=function(D,L){return fe().newStreamWritableFromWritableStream(D,L)},se.toWeb=function(D){return fe().newWritableStreamFromStreamWritable(D)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const e=requireBrowser$1(),r=requireBuffer(),{isReadable:o,isWritable:t,isIterable:c,isNodeStream:h,isReadableNodeStream:l,isWritableNodeStream:i,isDuplexNodeStream:p,isReadableStream:s,isWritableStream:d}=requireUtils(),m=requireEndOfStream(),{AbortError:u,codes:{ERR_INVALID_ARG_TYPE:a,ERR_INVALID_RETURN_VALUE:g}}=requireErrors(),{destroyer:b}=requireDestroy(),y=requireDuplex(),T=requireReadable(),E=requireWritable(),{createDeferredPromise:x}=requireUtil(),R=requireFrom(),P=globalThis.Blob||r.Blob,A=typeof P<"u"?function(O){return O instanceof P}:function(O){return!1},w=globalThis.AbortController||requireBrowser$2().AbortController,{FunctionPrototypeCall:S}=requirePrimordials();class j extends y{constructor(O){super(O),(O==null?void 0:O.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(O==null?void 0:O.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function U(O,te){if(p(O))return O;if(l(O))return q({readable:O});if(i(O))return q({writable:O});if(h(O))return q({writable:!1,readable:!1});if(s(O))return q({readable:T.fromWeb(O)});if(d(O))return q({writable:E.fromWeb(O)});if(typeof O=="function"){const{value:oe,write:me,final:$,destroy:le}=M(O);if(c(oe))return R(j,oe,{objectMode:!0,write:me,final:$,destroy:le});const C=oe==null?void 0:oe.then;if(typeof C=="function"){let W;const J=S(C,oe,V=>{if(V!=null)throw new g("nully","body",V)},V=>{b(W,V)});return W=new j({objectMode:!0,readable:!1,write:me,final(V){$(async()=>{try{await J,e.nextTick(V,null)}catch(ue){e.nextTick(V,ue)}})},destroy:le})}throw new g("Iterable, AsyncIterable or AsyncFunction",te,oe)}if(A(O))return U(O.arrayBuffer());if(c(O))return R(j,O,{objectMode:!0,writable:!1});if(s(O==null?void 0:O.readable)&&d(O==null?void 0:O.writable))return j.fromWeb(O);if(typeof(O==null?void 0:O.writable)=="object"||typeof(O==null?void 0:O.readable)=="object"){const oe=O!=null&&O.readable?l(O==null?void 0:O.readable)?O==null?void 0:O.readable:U(O.readable):void 0,me=O!=null&&O.writable?i(O==null?void 0:O.writable)?O==null?void 0:O.writable:U(O.writable):void 0;return q({readable:oe,writable:me})}const se=O==null?void 0:O.then;if(typeof se=="function"){let oe;return S(se,O,me=>{me!=null&&oe.push(me),oe.push(null)},me=>{b(oe,me)}),oe=new j({objectMode:!0,writable:!1,read(){}})}throw new a(te,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],O)};function M(U){let{promise:O,resolve:te}=x();const se=new w,oe=se.signal;return{value:U((async function*(){for(;;){const $=O;O=null;const{chunk:le,done:C,cb:W}=await $;if(e.nextTick(W),C)return;if(oe.aborted)throw new u(void 0,{cause:oe.reason});({promise:O,resolve:te}=x()),yield le}})(),{signal:oe}),write($,le,C){const W=te;te=null,W({chunk:$,done:!1,cb:C})},final($){const le=te;te=null,le({done:!0,cb:$})},destroy($,le){se.abort(),le($)}}}function q(U){const O=U.readable&&typeof U.readable.read!="function"?T.wrap(U.readable):U.readable,te=U.writable;let se=!!o(O),oe=!!t(te),me,$,le,C,W;function J(V){const ue=C;C=null,ue?ue(V):V&&W.destroy(V)}return W=new j({readableObjectMode:!!(O!=null&&O.readableObjectMode),writableObjectMode:!!(te!=null&&te.writableObjectMode),readable:se,writable:oe}),oe&&(m(te,V=>{oe=!1,V&&b(O,V),J(V)}),W._write=function(V,ue,de){te.write(V,ue)?de():me=de},W._final=function(V){te.end(),$=V},te.on("drain",function(){if(me){const V=me;me=null,V()}}),te.on("finish",function(){if($){const V=$;$=null,V()}})),se&&(m(O,V=>{se=!1,V&&b(O,V),J(V)}),O.on("readable",function(){if(le){const V=le;le=null,V()}}),O.on("end",function(){W.push(null)}),W._read=function(){for(;;){const V=O.read();if(V===null){le=W._read;return}if(!W.push(V))return}}),W._destroy=function(V,ue){!V&&C!==null&&(V=new u),le=null,me=null,$=null,C===null?ue(V):(C=ue,b(te,V),b(O,V))},W}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:e,ObjectGetOwnPropertyDescriptor:r,ObjectKeys:o,ObjectSetPrototypeOf:t}=requirePrimordials();duplex=l;const c=requireReadable(),h=requireWritable();t(l.prototype,c.prototype),t(l,c);{const d=o(h.prototype);for(let m=0;m<d.length;m++){const u=d[m];l.prototype[u]||(l.prototype[u]=h.prototype[u])}}function l(d){if(!(this instanceof l))return new l(d);c.call(this,d),h.call(this,d),d?(this.allowHalfOpen=d.allowHalfOpen!==!1,d.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),d.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}e(l.prototype,{writable:{__proto__:null,...r(h.prototype,"writable")},writableHighWaterMark:{__proto__:null,...r(h.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...r(h.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...r(h.prototype,"writableBuffer")},writableLength:{__proto__:null,...r(h.prototype,"writableLength")},writableFinished:{__proto__:null,...r(h.prototype,"writableFinished")},writableCorked:{__proto__:null,...r(h.prototype,"writableCorked")},writableEnded:{__proto__:null,...r(h.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...r(h.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(d){this._readableState&&this._writableState&&(this._readableState.destroyed=d,this._writableState.destroyed=d)}}});let i;function p(){return i===void 0&&(i={}),i}l.fromWeb=function(d,m){return p().newStreamDuplexFromReadableWritablePair(d,m)},l.toWeb=function(d){return p().newReadableWritablePairFromDuplex(d)};let s;return l.from=function(d){return s||(s=requireDuplexify()),s(d,"body")},duplex}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1;const{ObjectSetPrototypeOf:e,Symbol:r}=requirePrimordials();transform=l;const{ERR_METHOD_NOT_IMPLEMENTED:o}=requireErrors().codes,t=requireDuplex(),{getHighWaterMark:c}=requireState();e(l.prototype,t.prototype),e(l,t);const h=r("kCallback");function l(s){if(!(this instanceof l))return new l(s);const d=s?c(this,s,"readableHighWaterMark",!0):null;d===0&&(s={...s,highWaterMark:null,readableHighWaterMark:d,writableHighWaterMark:s.writableHighWaterMark||0}),t.call(this,s),this._readableState.sync=!1,this[h]=null,s&&(typeof s.transform=="function"&&(this._transform=s.transform),typeof s.flush=="function"&&(this._flush=s.flush)),this.on("prefinish",p)}function i(s){typeof this._flush=="function"&&!this.destroyed?this._flush((d,m)=>{if(d){s?s(d):this.destroy(d);return}m!=null&&this.push(m),this.push(null),s&&s()}):(this.push(null),s&&s())}function p(){this._final!==i&&i.call(this)}return l.prototype._final=i,l.prototype._transform=function(s,d,m){throw new o("_transform()")},l.prototype._write=function(s,d,m){const u=this._readableState,a=this._writableState,g=u.length;this._transform(s,d,(b,y)=>{if(b){m(b);return}y!=null&&this.push(y),a.ended||g===u.length||u.length<u.highWaterMark?m():this[h]=m})},l.prototype._read=function(){if(this[h]){const s=this[h];this[h]=null,s()}},transform}var passthrough,hasRequiredPassthrough;function requirePassthrough(){if(hasRequiredPassthrough)return passthrough;hasRequiredPassthrough=1;const{ObjectSetPrototypeOf:e}=requirePrimordials();passthrough=o;const r=requireTransform();e(o.prototype,r.prototype),e(o,r);function o(t){if(!(this instanceof o))return new o(t);r.call(this,t)}return o.prototype._transform=function(t,c,h){h(null,t)},passthrough}var pipeline_1,hasRequiredPipeline;function requirePipeline(){if(hasRequiredPipeline)return pipeline_1;hasRequiredPipeline=1;const e=requireBrowser$1(),{ArrayIsArray:r,Promise:o,SymbolAsyncIterator:t,SymbolDispose:c}=requirePrimordials(),h=requireEndOfStream(),{once:l}=requireUtil(),i=requireDestroy(),p=requireDuplex(),{aggregateTwoErrors:s,codes:{ERR_INVALID_ARG_TYPE:d,ERR_INVALID_RETURN_VALUE:m,ERR_MISSING_ARGS:u,ERR_STREAM_DESTROYED:a,ERR_STREAM_PREMATURE_CLOSE:g},AbortError:b}=requireErrors(),{validateFunction:y,validateAbortSignal:T}=requireValidators(),{isIterable:E,isReadable:x,isReadableNodeStream:R,isNodeStream:P,isTransformStream:A,isWebStream:w,isReadableStream:S,isReadableFinished:j}=requireUtils(),M=globalThis.AbortController||requireBrowser$2().AbortController;let q,U,O;function te(V,ue,de){let be=!1;V.on("close",()=>{be=!0});const he=h(V,{readable:ue,writable:de},H=>{be=!H});return{destroy:H=>{be||(be=!0,i.destroyer(V,H||new a("pipe")))},cleanup:he}}function se(V){return y(V[V.length-1],"streams[stream.length - 1]"),V.pop()}function oe(V){if(E(V))return V;if(R(V))return me(V);throw new d("val",["Readable","Iterable","AsyncIterable"],V)}async function*me(V){U||(U=requireReadable()),yield*U.prototype[t].call(V)}async function $(V,ue,de,{end:be}){let he,H=null;const Y=fe=>{if(fe&&(he=fe),H){const D=H;H=null,D()}},ne=()=>new o((fe,D)=>{he?D(he):H=()=>{he?D(he):fe()}});ue.on("drain",Y);const pe=h(ue,{readable:!1},Y);try{ue.writableNeedDrain&&await ne();for await(const fe of V)ue.write(fe)||await ne();be&&(ue.end(),await ne()),de()}catch(fe){de(he!==fe?s(he,fe):fe)}finally{pe(),ue.off("drain",Y)}}async function le(V,ue,de,{end:be}){A(ue)&&(ue=ue.writable);const he=ue.getWriter();try{for await(const H of V)await he.ready,he.write(H).catch(()=>{});await he.ready,be&&await he.close(),de()}catch(H){try{await he.abort(H),de(H)}catch(Y){de(Y)}}}function C(...V){return W(V,l(se(V)))}function W(V,ue,de){if(V.length===1&&r(V[0])&&(V=V[0]),V.length<2)throw new u("streams");const be=new M,he=be.signal,H=de==null?void 0:de.signal,Y=[];T(H,"options.signal");function ne(){Q(new b)}O=O||requireUtil().addAbortListener;let pe;H&&(pe=O(H,ne));let fe,D;const L=[];let z=0;function re(K){Q(K,--z===0)}function Q(K,G){var ye;if(K&&(!fe||fe.code==="ERR_STREAM_PREMATURE_CLOSE")&&(fe=K),!(!fe&&!G)){for(;L.length;)L.shift()(fe);(ye=pe)===null||ye===void 0||ye[c](),be.abort(),G&&(fe||Y.forEach(Ie=>Ie()),e.nextTick(ue,fe,D))}}let ee;for(let K=0;K<V.length;K++){const G=V[K],ye=K<V.length-1,Ie=K>0,Te=ye||(de==null?void 0:de.end)!==!1,xe=K===V.length-1;if(P(G)){let _=function(n){n&&n.name!=="AbortError"&&n.code!=="ERR_STREAM_PREMATURE_CLOSE"&&re(n)};if(Te){const{destroy:n,cleanup:f}=te(G,ye,Ie);L.push(n),x(G)&&xe&&Y.push(f)}G.on("error",_),x(G)&&xe&&Y.push(()=>{G.removeListener("error",_)})}if(K===0)if(typeof G=="function"){if(ee=G({signal:he}),!E(ee))throw new m("Iterable, AsyncIterable or Stream","source",ee)}else E(G)||R(G)||A(G)?ee=G:ee=p.from(G);else if(typeof G=="function"){if(A(ee)){var F;ee=oe((F=ee)===null||F===void 0?void 0:F.readable)}else ee=oe(ee);if(ee=G(ee,{signal:he}),ye){if(!E(ee,!0))throw new m("AsyncIterable",`transform[${K-1}]`,ee)}else{var Z;q||(q=requirePassthrough());const _=new q({objectMode:!0}),n=(Z=ee)===null||Z===void 0?void 0:Z.then;if(typeof n=="function")z++,n.call(ee,B=>{D=B,B!=null&&_.write(B),Te&&_.end(),e.nextTick(re)},B=>{_.destroy(B),e.nextTick(re,B)});else if(E(ee,!0))z++,$(ee,_,re,{end:Te});else if(S(ee)||A(ee)){const B=ee.readable||ee;z++,$(B,_,re,{end:Te})}else throw new m("AsyncIterable or Promise","destination",ee);ee=_;const{destroy:f,cleanup:k}=te(ee,!1,!0);L.push(f),xe&&Y.push(k)}}else if(P(G)){if(R(ee)){z+=2;const _=J(ee,G,re,{end:Te});x(G)&&xe&&Y.push(_)}else if(A(ee)||S(ee)){const _=ee.readable||ee;z++,$(_,G,re,{end:Te})}else if(E(ee))z++,$(ee,G,re,{end:Te});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],ee);ee=G}else if(w(G)){if(R(ee))z++,le(oe(ee),G,re,{end:Te});else if(S(ee)||E(ee))z++,le(ee,G,re,{end:Te});else if(A(ee))z++,le(ee.readable,G,re,{end:Te});else throw new d("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],ee);ee=G}else ee=p.from(G)}return(he!=null&&he.aborted||H!=null&&H.aborted)&&e.nextTick(ne),ee}function J(V,ue,de,{end:be}){let he=!1;if(ue.on("close",()=>{he||de(new g)}),V.pipe(ue,{end:!1}),be){let H=function(){he=!0,ue.end()};j(V)?e.nextTick(H):V.once("end",H)}else de();return h(V,{readable:!0,writable:!1},H=>{const Y=V._readableState;H&&H.code==="ERR_STREAM_PREMATURE_CLOSE"&&Y&&Y.ended&&!Y.errored&&!Y.errorEmitted?V.once("end",de).once("error",de):de(H)}),h(ue,{readable:!1,writable:!0},de)}return pipeline_1={pipelineImpl:W,pipeline:C},pipeline_1}var compose,hasRequiredCompose;function requireCompose(){if(hasRequiredCompose)return compose;hasRequiredCompose=1;const{pipeline:e}=requirePipeline(),r=requireDuplex(),{destroyer:o}=requireDestroy(),{isNodeStream:t,isReadable:c,isWritable:h,isWebStream:l,isTransformStream:i,isWritableStream:p,isReadableStream:s}=requireUtils(),{AbortError:d,codes:{ERR_INVALID_ARG_VALUE:m,ERR_MISSING_ARGS:u}}=requireErrors(),a=requireEndOfStream();return compose=function(...b){if(b.length===0)throw new u("streams");if(b.length===1)return r.from(b[0]);const y=[...b];if(typeof b[0]=="function"&&(b[0]=r.from(b[0])),typeof b[b.length-1]=="function"){const q=b.length-1;b[q]=r.from(b[q])}for(let q=0;q<b.length;++q)if(!(!t(b[q])&&!l(b[q]))){if(q<b.length-1&&!(c(b[q])||s(b[q])||i(b[q])))throw new m(`streams[${q}]`,y[q],"must be readable");if(q>0&&!(h(b[q])||p(b[q])||i(b[q])))throw new m(`streams[${q}]`,y[q],"must be writable")}let T,E,x,R,P;function A(q){const U=R;R=null,U?U(q):q?P.destroy(q):!M&&!j&&P.destroy()}const w=b[0],S=e(b,A),j=!!(h(w)||p(w)||i(w)),M=!!(c(S)||s(S)||i(S));if(P=new r({writableObjectMode:!!(w!=null&&w.writableObjectMode),readableObjectMode:!!(S!=null&&S.readableObjectMode),writable:j,readable:M}),j){if(t(w))P._write=function(U,O,te){w.write(U,O)?te():T=te},P._final=function(U){w.end(),E=U},w.on("drain",function(){if(T){const U=T;T=null,U()}});else if(l(w)){const O=(i(w)?w.writable:w).getWriter();P._write=async function(te,se,oe){try{await O.ready,O.write(te).catch(()=>{}),oe()}catch(me){oe(me)}},P._final=async function(te){try{await O.ready,O.close().catch(()=>{}),E=te}catch(se){te(se)}}}const q=i(S)?S.readable:S;a(q,()=>{if(E){const U=E;E=null,U()}})}if(M){if(t(S))S.on("readable",function(){if(x){const q=x;x=null,q()}}),S.on("end",function(){P.push(null)}),P._read=function(){for(;;){const q=S.read();if(q===null){x=P._read;return}if(!P.push(q))return}};else if(l(S)){const U=(i(S)?S.readable:S).getReader();P._read=async function(){for(;;)try{const{value:O,done:te}=await U.read();if(!P.push(O))return;if(te){P.push(null);return}}catch{return}}}}return P._destroy=function(q,U){!q&&R!==null&&(q=new d),x=null,T=null,E=null,R===null?U(q):(R=U,t(S)&&o(S,q))},P},compose}var hasRequiredOperators;function requireOperators(){if(hasRequiredOperators)return operators;hasRequiredOperators=1;const e=globalThis.AbortController||requireBrowser$2().AbortController,{codes:{ERR_INVALID_ARG_VALUE:r,ERR_INVALID_ARG_TYPE:o,ERR_MISSING_ARGS:t,ERR_OUT_OF_RANGE:c},AbortError:h}=requireErrors(),{validateAbortSignal:l,validateInteger:i,validateObject:p}=requireValidators(),s=requirePrimordials().Symbol("kWeak"),d=requirePrimordials().Symbol("kResistStopPropagation"),{finished:m}=requireEndOfStream(),u=requireCompose(),{addAbortSignalNoValidate:a}=requireAddAbortSignal(),{isWritable:g,isNodeStream:b}=requireUtils(),{deprecate:y}=requireUtil(),{ArrayPrototypePush:T,Boolean:E,MathFloor:x,Number:R,NumberIsNaN:P,Promise:A,PromiseReject:w,PromiseResolve:S,PromisePrototypeThen:j,Symbol:M}=requirePrimordials(),q=M("kEmpty"),U=M("kEof");function O(H,Y){if(Y!=null&&p(Y,"options"),(Y==null?void 0:Y.signal)!=null&&l(Y.signal,"options.signal"),b(H)&&!g(H))throw new r("stream",H,"must be writable");const ne=u(this,H);return Y!=null&&Y.signal&&a(Y.signal,ne),ne}function te(H,Y){if(typeof H!="function")throw new o("fn",["Function","AsyncFunction"],H);Y!=null&&p(Y,"options"),(Y==null?void 0:Y.signal)!=null&&l(Y.signal,"options.signal");let ne=1;(Y==null?void 0:Y.concurrency)!=null&&(ne=x(Y.concurrency));let pe=ne-1;return(Y==null?void 0:Y.highWaterMark)!=null&&(pe=x(Y.highWaterMark)),i(ne,"options.concurrency",1),i(pe,"options.highWaterMark",0),pe+=ne,(async function*(){const D=requireUtil().AbortSignalAny([Y==null?void 0:Y.signal].filter(E)),L=this,z=[],re={signal:D};let Q,ee,F=!1,Z=0;function K(){F=!0,G()}function G(){Z-=1,ye()}function ye(){ee&&!F&&Z<ne&&z.length<pe&&(ee(),ee=null)}async function Ie(){try{for await(let Te of L){if(F)return;if(D.aborted)throw new h;try{if(Te=H(Te,re),Te===q)continue;Te=S(Te)}catch(xe){Te=w(xe)}Z+=1,j(Te,G,K),z.push(Te),Q&&(Q(),Q=null),!F&&(z.length>=pe||Z>=ne)&&await new A(xe=>{ee=xe})}z.push(U)}catch(Te){const xe=w(Te);j(xe,G,K),z.push(xe)}finally{F=!0,Q&&(Q(),Q=null)}}Ie();try{for(;;){for(;z.length>0;){const Te=await z[0];if(Te===U)return;if(D.aborted)throw new h;Te!==q&&(yield Te),z.shift(),ye()}await new A(Te=>{Q=Te})}}finally{F=!0,ee&&(ee(),ee=null)}}).call(this)}function se(H=void 0){return H!=null&&p(H,"options"),(H==null?void 0:H.signal)!=null&&l(H.signal,"options.signal"),(async function*(){let ne=0;for await(const fe of this){var pe;if(H!=null&&(pe=H.signal)!==null&&pe!==void 0&&pe.aborted)throw new h({cause:H.signal.reason});yield[ne++,fe]}}).call(this)}async function oe(H,Y=void 0){for await(const ne of C.call(this,H,Y))return!0;return!1}async function me(H,Y=void 0){if(typeof H!="function")throw new o("fn",["Function","AsyncFunction"],H);return!await oe.call(this,async(...ne)=>!await H(...ne),Y)}async function $(H,Y){for await(const ne of C.call(this,H,Y))return ne}async function le(H,Y){if(typeof H!="function")throw new o("fn",["Function","AsyncFunction"],H);async function ne(pe,fe){return await H(pe,fe),q}for await(const pe of te.call(this,ne,Y));}function C(H,Y){if(typeof H!="function")throw new o("fn",["Function","AsyncFunction"],H);async function ne(pe,fe){return await H(pe,fe)?pe:q}return te.call(this,ne,Y)}class W extends t{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function J(H,Y,ne){var pe;if(typeof H!="function")throw new o("reducer",["Function","AsyncFunction"],H);ne!=null&&p(ne,"options"),(ne==null?void 0:ne.signal)!=null&&l(ne.signal,"options.signal");let fe=arguments.length>1;if(ne!=null&&(pe=ne.signal)!==null&&pe!==void 0&&pe.aborted){const Q=new h(void 0,{cause:ne.signal.reason});throw this.once("error",()=>{}),await m(this.destroy(Q)),Q}const D=new e,L=D.signal;if(ne!=null&&ne.signal){const Q={once:!0,[s]:this,[d]:!0};ne.signal.addEventListener("abort",()=>D.abort(),Q)}let z=!1;try{for await(const Q of this){var re;if(z=!0,ne!=null&&(re=ne.signal)!==null&&re!==void 0&&re.aborted)throw new h;fe?Y=await H(Y,Q,{signal:L}):(Y=Q,fe=!0)}if(!z&&!fe)throw new W}finally{D.abort()}return Y}async function V(H){H!=null&&p(H,"options"),(H==null?void 0:H.signal)!=null&&l(H.signal,"options.signal");const Y=[];for await(const pe of this){var ne;if(H!=null&&(ne=H.signal)!==null&&ne!==void 0&&ne.aborted)throw new h(void 0,{cause:H.signal.reason});T(Y,pe)}return Y}function ue(H,Y){const ne=te.call(this,H,Y);return(async function*(){for await(const fe of ne)yield*fe}).call(this)}function de(H){if(H=R(H),P(H))return 0;if(H<0)throw new c("number",">= 0",H);return H}function be(H,Y=void 0){return Y!=null&&p(Y,"options"),(Y==null?void 0:Y.signal)!=null&&l(Y.signal,"options.signal"),H=de(H),(async function*(){var pe;if(Y!=null&&(pe=Y.signal)!==null&&pe!==void 0&&pe.aborted)throw new h;for await(const D of this){var fe;if(Y!=null&&(fe=Y.signal)!==null&&fe!==void 0&&fe.aborted)throw new h;H--<=0&&(yield D)}}).call(this)}function he(H,Y=void 0){return Y!=null&&p(Y,"options"),(Y==null?void 0:Y.signal)!=null&&l(Y.signal,"options.signal"),H=de(H),(async function*(){var pe;if(Y!=null&&(pe=Y.signal)!==null&&pe!==void 0&&pe.aborted)throw new h;for await(const D of this){var fe;if(Y!=null&&(fe=Y.signal)!==null&&fe!==void 0&&fe.aborted)throw new h;if(H-- >0&&(yield D),H<=0)return}}).call(this)}return operators.streamReturningOperators={asIndexedPairs:y(se,"readable.asIndexedPairs will be removed in a future version."),drop:be,filter:C,flatMap:ue,map:te,take:he,compose:O},operators.promiseReturningOperators={every:me,forEach:le,reduce:J,toArray:V,some:oe,find:$},operators}var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:e,Promise:r}=requirePrimordials(),{isIterable:o,isNodeStream:t,isWebStream:c}=requireUtils(),{pipelineImpl:h}=requirePipeline(),{finished:l}=requireEndOfStream();requireStream();function i(...p){return new r((s,d)=>{let m,u;const a=p[p.length-1];if(a&&typeof a=="object"&&!t(a)&&!o(a)&&!c(a)){const g=e(p);m=g.signal,u=g.end}h(p,(g,b)=>{g?d(g):s(b)},{signal:m,end:u})})}return promises={finished:l,pipeline:i},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:e}=requireBuffer(),{ObjectDefineProperty:r,ObjectKeys:o,ReflectApply:t}=requirePrimordials(),{promisify:{custom:c}}=requireUtil(),{streamReturningOperators:h,promiseReturningOperators:l}=requireOperators(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:i}}=requireErrors(),p=requireCompose(),{setDefaultHighWaterMark:s,getDefaultHighWaterMark:d}=requireState(),{pipeline:m}=requirePipeline(),{destroyer:u}=requireDestroy(),a=requireEndOfStream(),g=requirePromises(),b=requireUtils(),y=stream.exports=requireLegacy().Stream;y.isDestroyed=b.isDestroyed,y.isDisturbed=b.isDisturbed,y.isErrored=b.isErrored,y.isReadable=b.isReadable,y.isWritable=b.isWritable,y.Readable=requireReadable();for(const E of o(h)){let R=function(...P){if(new.target)throw i();return y.Readable.from(t(x,this,P))};const x=h[E];r(R,"name",{__proto__:null,value:x.name}),r(R,"length",{__proto__:null,value:x.length}),r(y.Readable.prototype,E,{__proto__:null,value:R,enumerable:!1,configurable:!0,writable:!0})}for(const E of o(l)){let R=function(...P){if(new.target)throw i();return t(x,this,P)};const x=l[E];r(R,"name",{__proto__:null,value:x.name}),r(R,"length",{__proto__:null,value:x.length}),r(y.Readable.prototype,E,{__proto__:null,value:R,enumerable:!1,configurable:!0,writable:!0})}y.Writable=requireWritable(),y.Duplex=requireDuplex(),y.Transform=requireTransform(),y.PassThrough=requirePassthrough(),y.pipeline=m;const{addAbortSignal:T}=requireAddAbortSignal();return y.addAbortSignal=T,y.finished=a,y.destroy=u,y.compose=p,y.setDefaultHighWaterMark=s,y.getDefaultHighWaterMark=d,r(y,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return g}}),r(m,c,{__proto__:null,enumerable:!0,get(){return g.pipeline}}),r(a,c,{__proto__:null,enumerable:!0,get(){return g.finished}}),y.Stream=y,y._isUint8Array=function(x){return x instanceof Uint8Array},y._uint8ArrayToBuffer=function(x){return e.from(x.buffer,x.byteOffset,x.byteLength)},stream.exports}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,(function(e){const r=requireStream(),o=requirePromises(),t=r.Readable.destroy;e.exports=r.Readable,e.exports._uint8ArrayToBuffer=r._uint8ArrayToBuffer,e.exports._isUint8Array=r._isUint8Array,e.exports.isDisturbed=r.isDisturbed,e.exports.isErrored=r.isErrored,e.exports.isReadable=r.isReadable,e.exports.Readable=r.Readable,e.exports.Writable=r.Writable,e.exports.Duplex=r.Duplex,e.exports.Transform=r.Transform,e.exports.PassThrough=r.PassThrough,e.exports.addAbortSignal=r.addAbortSignal,e.exports.finished=r.finished,e.exports.destroy=r.destroy,e.exports.destroy=t,e.exports.pipeline=r.pipeline,e.exports.compose=r.compose,Object.defineProperty(r,"promises",{configurable:!0,enumerable:!0,get(){return o}}),e.exports.Stream=r.Stream,e.exports.default=e.exports})(browser$2)),browser$2.exports}var hasRequiredLib$1;function requireLib$1(){if(hasRequiredLib$1)return lib;hasRequiredLib$1=1,Object.defineProperty(lib,"__esModule",{value:!0}),lib.ReadableWebToNodeStream=void 0;const e=requireBrowser();class r extends e.Readable{constructor(t){super(),this.bytesRead=0,this.released=!1,this.reader=t.getReader()}_read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read().then(t=>{delete this.pendingRead,t.done||this.released?this.push(null):(this.bytesRead+=t.value.length,this.push(t.value))}).catch(t=>{this.destroy(t)})}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}return lib.ReadableWebToNodeStream=r,lib}var hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fetchFromUrl=e.parseBlob=e.parseReadableStream=e.parseNodeStream=e.selectCover=e.ratingToStars=e.orderTags=e.parseFromTokenizer=e.parseBuffer=void 0;const r=requireBrowser$3(),o=requireCore(),t=requireLib$1(),c=r("music-metadata-browser:main");var h=requireCore();Object.defineProperty(e,"parseBuffer",{enumerable:!0,get:function(){return h.parseBuffer}}),Object.defineProperty(e,"parseFromTokenizer",{enumerable:!0,get:function(){return h.parseFromTokenizer}}),Object.defineProperty(e,"orderTags",{enumerable:!0,get:function(){return h.orderTags}}),Object.defineProperty(e,"ratingToStars",{enumerable:!0,get:function(){return h.ratingToStars}}),Object.defineProperty(e,"selectCover",{enumerable:!0,get:function(){return h.selectCover}}),e.parseNodeStream=o.parseStream;async function l(d,m,u){const a=new t.ReadableWebToNodeStream(d),g=await(0,e.parseNodeStream)(a,typeof m=="string"?{mimeType:m}:m,u);return await a.close(),g}e.parseReadableStream=l;async function i(d,m){d.type,d.size,d instanceof File&&d.name;const u=d.stream?d.stream():p(d);return l(u,{mimeType:d.type,size:d.size},m)}e.parseBlob=i;function p(d){const m=new FileReader;return new ReadableStream({start(u){m.onloadend=a=>{let g=a.target.result;g instanceof ArrayBuffer&&(g=new Uint8Array(g)),u.enqueue(g),u.close()},m.onerror=a=>{u.close()},m.onabort=a=>{u.close()},m.readAsArrayBuffer(d)}})}async function s(d,m){const u=await fetch(d),a={size:parseInt(u.headers.get("Content-Length"),10),mimeType:u.headers.get("Content-Type")};if(u.ok)if(u.body){const g=await l(u.body,a,m);return c("Closing HTTP-readable-stream..."),u.body.locked||await u.body.cancel(),c("HTTP-readable-stream closed."),g}else return i(await u.blob(),m);else throw new Error(`HTTP error status=${u.status}: ${u.statusText}`)}e.fetchFromUrl=s})(lib$3)),lib$3}var libExports=requireLib(),bufferExports=requireBuffer();typeof self<"u"&&(self.Buffer=bufferExports.Buffer),self.onmessage=async e=>{var o;const{file:r}=e.data;try{const t=await r.arrayBuffer(),c=await crypto.subtle.digest("SHA-256",t),l=Array.from(new Uint8Array(c)).map(u=>u.toString(16).padStart(2,"0")).join(""),i=await libExports.parseBlob(r,{duration:!0,skipCovers:!1}),{common:p,format:s}=i,d=(o=p.picture)==null?void 0:o[0],m={id:l,title:p.title||r.name.replace(/\.[^/.]+$/,""),artist:p.artist||"Unknown Artist",album:p.album||"Unknown Album",duration:s.duration||0,picture:d!=null&&d.data?d.data:void 0,pictureType:d==null?void 0:d.format,addedAt:Date.now()};self.postMessage({type:"SUCCESS",payload:m})}catch(t){console.error("Worker Error:",t),self.postMessage({type:"ERROR",error:t.message,fileName:r.name})}}})();
